import{_ as P,ay as _,u as w,A as i,m as k,n as l,a0 as u,d as a,q as m,$ as c,F as p,a2 as f,X as Q,Y as g,p as h,as as b,Z as E,ap as y,ac as $,at as q,az as A}from"./index.f6661a24.js";import{Q as T}from"./QToolbarTitle.0f4dda99.js";import{Q as U}from"./QToolbar.7bb603c7.js";import{Q as B}from"./QHeader.ba9c2ff9.js";import{Q as M}from"./QInnerLoading.c6ed50f8.js";import{Q as C}from"./QImg.b7890c8b.js";import{Q as z}from"./QSpace.7af5fd36.js";import{Q as D}from"./QSelect.4e3956e1.js";import{Q as O}from"./QFooter.4f4f9530.js";import{Q as F}from"./QForm.4e86ee71.js";import{Q as j}from"./QPage.78315ab4.js";import{u as L}from"./MenuStore.420c66e5.js";import{A as I}from"./AppCamera.4fe7ee93.js";import{u as N}from"./AccessStore.ca0ffc27.js";import"./QResizeObserver.dc10e4c2.js";import"./QChip.5b52e54d.js";import"./QItemLabel.0d3c2221.js";import"./QMenu.c4f03f28.js";import"./selection.ef67fb9c.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";const x={name:"ManageAddonItems",components:{ConfirmDialog:_(()=>A(()=>import("./ConfirmDialog.5cba1a11.js"),["assets/ConfirmDialog.5cba1a11.js","assets/QToolbarTitle.0f4dda99.js","assets/index.f6661a24.js","assets/index.1593f83d.css","assets/QToolbar.7bb603c7.js"])),UploaderFile:_(()=>A(()=>import("./UploaderFile.36c0f73c.js"),["assets/UploaderFile.36c0f73c.js","assets/QUploader.d12c38b5.js","assets/index.f6661a24.js","assets/index.1593f83d.css","assets/QCircularProgress.24399868.js","assets/format.de7e9769.js"])),ItemTranslation:_(()=>A(()=>import("./ItemTranslation.1087e138.js"),["assets/ItemTranslation.1087e138.js","assets/index.f6661a24.js","assets/index.1593f83d.css","assets/QSpace.7af5fd36.js","assets/QExpansionItem.f7624880.js","assets/QItemLabel.0d3c2221.js","assets/QSlideTransition.07e7f5c6.js","assets/QList.16ddb51a.js"]))},data(){return{loading_get:!1,loading:!1,id:0,name:"",description:"",category:[],price:0,status:"publish",upload_enabled:!1,featured_filename:"",featured_url:"",upload_path:"",photo_data:"",fields:[{name:"name",title:this.$t("Enter name"),type:"text"},{name:"description",title:this.$t("Enter description"),type:"textarea"}],translation_data:[],translation:[]}},setup(e){const t=w(),d=L(),n=N();return{DataStore:t,MenuStore:d,AccessStore:n}},computed:{isEdit(){return this.id>0},hasPhoto(){return!i.empty(this.featured_filename)},hasData(){return Object.keys(this.photo_data).length>0}},created(){this.MenuStore.getAddonCategoryList(),this.id=this.$route.query.id,this.id>0&&this.getAddonItem()},methods:{getAddonItem(){this.loading_get=!0,i.fetchDataByTokenPost("getAddonItem","id="+this.id).then(e=>{this.name=e.details.sub_item_name,this.description=e.details.item_description,this.price=e.details.price,this.status=e.details.status,this.featured_filename=e.details.photo,this.featured_url=e.details.photo_url,this.upload_path=e.details.path,this.translation=e.details.translation;const t=e.details.category;i.empty(e.details.category)||Object.keys(e.details.category).length>0&&Object.entries(this.MenuStore.addon_category_list).forEach(([d,n])=>{t.includes(n.value)&&this.category.push(n)})}).catch(e=>{i.notify("dark",e,"error",this.$q)}).then(e=>{this.loading_get=!1})},takePhoto(){this.$q.capacitor?I.isCameraEnabled().then(e=>{I.isFileAccessEnabled().then(t=>{I.getPhoto(1).then(d=>{this.photo_data=d}).catch(d=>{this.photo_data=[]})}).catch(t=>{i.notify("dark",t,"error",this.$q)})}).catch(e=>{i.notify("dark",e,"error",this.$q)}):this.upload_enabled=!this.upload_enabled},afterUploadfile(e){this.featured_filename=e.filename,this.featured_url=e.url_image,this.upload_path=e.upload_path},afterInput(e){this.translation_data=e},onSubmit(){this.loading=!0;const e=[];Object.keys(this.category).length>0&&Object.entries(this.category).forEach(([t,d])=>{e.push(d.value)}),i.fetchDataByToken("addAddonItem",{id:this.id,name:this.name,description:this.description,category:e,price:this.price,status:this.status.value?this.status.value:this.status,featured_filename:this.featured_filename,upload_path:this.upload_path,file_data:this.hadData()?this.photo_data.data:"",image_type:this.hadData()?this.photo_data.format:"",translation_data:this.translation_data}).then(t=>{i.notify(this.$q.dark.mode?"grey600":"light-green",t.msg,"check_circle",this.$q),this.$router.push("/menu?refresh=1")}).catch(t=>{i.notify("dark",t,"error",this.$q)}).then(t=>{this.loading=!1})},hadData(){return Object.keys(this.photo_data).length>0},confirmDelete(){this.$refs.confirm_dialog.dialog=!0},afterConfirm(){this.$refs.confirm_dialog.dialog=!1,i.showLoadingBox("",this.$q),i.fetchDataByTokenPost("deleteAddonItem","id="+this.id).then(e=>{i.notify("light-green",e.msg,"check_circle",this.$q),this.$router.push("/menu?refresh=1")}).catch(e=>{i.notify("dark",e,"error",this.$q)}).then(e=>{i.hideLoadingBox(this.$q)})}}},R={class:"row q-gutter-sm"},G={class:"col"},H={class:"font12 line-normal"},J={class:"q-gutter-md"};function X(e,t,d,n,o,s){const S=k("UploaderFile"),V=k("ItemTranslation"),v=k("ConfirmDialog");return l(),u(p,null,[a(B,{class:c({"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode})},{default:m(()=>[a(U,null,{default:m(()=>[a(f,{onClick:t[0]||(t[0]=r=>e.$router.back()),flat:"",round:"",dense:"",icon:"las la-angle-left",color:e.$q.dark.mode?"white":"dark"},null,8,["color"]),a(T,{class:"text-weight-bold"},{default:m(()=>[s.isEdit?(l(),u(p,{key:0},[Q(g(e.$t("Edit Addon Item")),1)],64)):(l(),u(p,{key:1},[Q(g(e.$t("Add Addon Items")),1)],64))]),_:1}),n.AccessStore.hasAccess("food.addonitem_delete")?(l(),u(p,{key:0},[s.isEdit&&!o.loading_get?(l(),h(f,{key:0,round:"",color:e.$q.dark.mode?"grey600":"mygrey","text-color":e.$q.dark.mode?"grey300":"dark",icon:"las la-trash",size:"sm",unelevated:"",onClick:s.confirmDelete},null,8,["color","text-color","onClick"])):b("",!0)],64)):b("",!0)]),_:1}),a(E)]),_:1},8,["class"]),a(j,{class:c([{"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode},"q-pa-md"])},{default:m(()=>[o.loading_get?(l(),h(M,{key:0,showing:!0,color:"primary",size:"md"})):(l(),h(F,{key:1,onSubmit:s.onSubmit},{default:m(()=>[y("div",R,[s.hasData?(l(),h(C,{key:0,src:o.photo_data.path,"spinner-color":"primary","spinner-size":"sm",fit:"cover",style:{height:"70px"},class:"col-3 radius8"},null,8,["src"])):s.hasPhoto?(l(),h(C,{key:1,src:this.featured_url,"spinner-color":"primary",fit:"cover",style:{height:"70px"},class:"col-3 radius8"},null,8,["src"])):(l(),u("div",{key:2,class:c(["col-3 row items-center justify-center radius8",{"bg-grey600 ":e.$q.dark.mode,"bg-mygrey ":!e.$q.dark.mode}]),style:{height:"70px"}},[a($,{name:"las la-image",class:"text-grey",size:"xl"})],2)),y("div",G,[y("div",H,g(e.$t("Items with quality photos are often more popular. Maximum 2 MB"))+". "+g(e.$t("Accepted types: PNG. JPG")),1),a(f,{label:s.hasPhoto?this.$t("Change Photo"):s.hasData?this.$t("Change Photo"):this.$t("Add Photo"),flat:"",color:"primary","no-caps":"",class:"q-pl-none q-pr-none",onClick:s.takePhoto},null,8,["label","onClick"])])]),o.upload_enabled?(l(),h(S,{key:0,ref:"uploader_file",onAfterUploadfile:s.afterUploadfile},null,8,["onAfterUploadfile"])):b("",!0),a(z,{class:"q-pa-xs"}),y("div",J,[a(q,{outlined:"",modelValue:o.name,"onUpdate:modelValue":t[1]||(t[1]=r=>o.name=r),label:e.$t("Name"),"stack-label":"",color:"grey-5","lazy-rules":"",rules:[r=>r&&r.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"]),a(q,{outlined:"",modelValue:o.description,"onUpdate:modelValue":t[2]||(t[2]=r=>o.description=r),label:e.$t("Description"),"stack-label":"",color:"grey-5",autogrow:""},null,8,["modelValue","label"]),a(q,{outlined:"",type:"number",modelValue:o.price,"onUpdate:modelValue":t[3]||(t[3]=r=>o.price=r),label:e.$t("Price"),"stack-label":"",color:"grey-5","lazy-rules":""},null,8,["modelValue","label"]),a(D,{outlined:"",modelValue:o.category,"onUpdate:modelValue":t[4]||(t[4]=r=>o.category=r),label:e.$t("Addon Category"),color:"grey-5",options:n.MenuStore.addon_category_list,"stack-label":"",multiple:"",behavior:"dialog","transition-show":"fade","transition-hide":"fade",loading:n.MenuStore.loading_addoncategory,rules:[r=>r&&r.length>0||this.$t("This field is required")]},null,8,["modelValue","label","options","loading","rules"]),a(D,{outlined:"",modelValue:o.status,"onUpdate:modelValue":t[5]||(t[5]=r=>o.status=r),label:e.$t("Status"),color:"grey-5",options:n.DataStore.status_list,"stack-label":"",behavior:"dialog","transition-show":"fade","transition-hide":"fade"},null,8,["modelValue","label","options"]),a(V,{ref:"item_translation",fields:o.fields,update:s.isEdit,data:o.translation,onAfterInput:s.afterInput},null,8,["fields","update","data","onAfterInput"])]),a(O,{class:c(["q-pl-md q-pr-md q-pb-xs",{"bg-mydark ":e.$q.dark.mode,"bg-white ":!e.$q.dark.mode}])},{default:m(()=>[a(f,{type:"submit",color:"primary","text-color":"white",label:e.$t("Submit"),unelevated:"",class:"full-width radius8",size:"lg","no-caps":"",loading:o.loading},null,8,["label","loading"])]),_:1},8,["class"])]),_:1},8,["onSubmit"])),a(v,{ref:"confirm_dialog",data:n.DataStore.data_dialog,onAfterConfirm:s.afterConfirm},null,8,["data","onAfterConfirm"])]),_:1},8,["class"])],64)}var ye=P(x,[["render",X]]);export{ye as default};
