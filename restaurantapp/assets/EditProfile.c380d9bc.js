import{_,dd as k,aq as i,A as d,n,a0 as y,d as l,q as s,$ as h,F as q,a2 as p,X as Q,Y as V,Z as $,ap as c,a6 as v,p as f,as as w,at as m}from"./index.f6661a24.js";import{Q as U}from"./QToolbarTitle.0f4dda99.js";import{Q as T}from"./QToolbar.7bb603c7.js";import{Q as z}from"./QHeader.ba9c2ff9.js";import{Q as g}from"./QImg.b7890c8b.js";import{Q as C}from"./QUploader.d12c38b5.js";import{Q as A}from"./QFooter.4f4f9530.js";import{Q as P}from"./QForm.4e86ee71.js";import{Q as j}from"./QPage.78315ab4.js";import{A as b}from"./AppCamera.4fe7ee93.js";import"./QResizeObserver.dc10e4c2.js";import"./QCircularProgress.24399868.js";import"./format.de7e9769.js";const D={data(){return{first_name:"",last_name:"",email_address:"",contact_number:"",avatar:"",loading:!1,upload_enabled:!1,upload_api:k.api_base_url+"/updateAvatar",filename:"",upload_path:"",photo_data:""}},created(){const e=i.getUser();e||(i.logout(),this.$router.push("/login")),this.first_name=e.first_name,this.last_name=e.last_name,this.email_address=e.email_address,this.contact_number=e.contact_number,this.avatar=e.avatar},computed:{hasData(){return Object.keys(this.photo_data).length>0}},methods:{takePhoto(){this.$q.capacitor?b.isCameraEnabled().then(e=>{b.isFileAccessEnabled().then(t=>{b.getPhoto(1).then(u=>{this.photo_data=u}).catch(u=>{this.photo_data=[]})}).catch(t=>{})}).catch(e=>{}):this.upload_enabled=!this.upload_enabled},getToken(){return i.getToken()},afterUploaded(e){const t=JSON.parse(e.xhr.responseText);t.code===1?(this.avatar=t.details.url_image,this.filename=t.details.filename,this.upload_path=t.details.upload_path):(this.avatar="",this.filename="",this.upload_path="",d.notify("dark",t.msg,"error",this.$q))},onSubmit(){this.loading=!0,d.fetchDataByToken("UpdateProfile",{first_name:this.first_name,last_name:this.last_name,email_address:this.email_address,contact_number:this.contact_number,filename:this.filename,upload_path:this.upload_path,file_data:this.hadData()?this.photo_data.data:"",image_type:this.hadData()?this.photo_data.format:""}).then(e=>{i.setUser(e.details.user_data),d.notify("light-green",e.msg,"check_circle",this.$q)}).catch(e=>{d.notify("dark",e,"error",this.$q)}).then(e=>{this.loading=!1})},hadData(){return Object.keys(this.photo_data).length>0}}},F={class:"q-pa-md q-gutter-sm"},S={class:"row items-center justify-center q-mb-md"},B={class:"col-3 relative-position text-center"};function E(e,t,u,x,r,o){return n(),y(q,null,[l(z,{class:h({"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode})},{default:s(()=>[l(T,null,{default:s(()=>[l(p,{onClick:t[0]||(t[0]=a=>e.$router.back()),flat:"",round:"",dense:"",icon:"las la-angle-left",color:e.$q.dark.mode?"white":"dark"},null,8,["color"]),l(U,{class:"text-weight-bold"},{default:s(()=>[Q(V(e.$t("Edit Profile")),1)]),_:1})]),_:1}),l($)]),_:1},8,["class"]),l(j,{class:h({"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode})},{default:s(()=>[l(P,{onSubmit:o.onSubmit},{default:s(()=>[c("div",F,[c("div",S,[c("div",B,[l(v,{size:"70px"},{default:s(()=>[o.hasData?(n(),f(g,{key:0,src:r.photo_data.path,"spinner-color":"primary","spinner-size":"sm",fit:"cover"},null,8,["src"])):(n(),f(g,{key:1,src:r.avatar,"spinner-color":"primary","spinner-size":"sm",fit:"cover"},null,8,["src"]))]),_:1}),l(p,{round:"",color:"primary","text-color":"white",icon:"las la-camera",unelevated:"",size:"sm",class:"absolute-bottom-right",onClick:o.takePhoto},null,8,["onClick"])])]),r.upload_enabled?(n(),f(C,{key:0,url:r.upload_api,label:e.$t("Upload files"),color:e.$q.dark.mode?"grey600":"primary","text-color":e.$q.dark.mode?"grey300":"white","no-thumbnails":"",class:"full-width q-mb-md",flat:"",accept:".jpg, image/*",bordered:"","max-files":1,"auto-upload":"","max-total-size":"1048576",onRejected:e.onRejectedFiles,headers:[{name:"Authorization",value:`token ${this.getToken()}`}],"field-name":"file",onUploaded:o.afterUploaded},null,8,["url","label","color","text-color","onRejected","headers","onUploaded"])):w("",!0),l(m,{outlined:"",modelValue:r.first_name,"onUpdate:modelValue":t[1]||(t[1]=a=>r.first_name=a),label:e.$t("First name"),"stack-label":"",color:"grey-5","lazy-rules":"",rules:[a=>a&&a.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"]),l(m,{outlined:"",modelValue:r.last_name,"onUpdate:modelValue":t[2]||(t[2]=a=>r.last_name=a),label:e.$t("Last name"),"stack-label":"",color:"grey-5","lazy-rules":"",rules:[a=>a&&a.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"]),l(m,{outlined:"",modelValue:r.email_address,"onUpdate:modelValue":t[3]||(t[3]=a=>r.email_address=a),label:e.$t("Email address"),"stack-label":"",color:"grey-5","lazy-rules":"",rules:[a=>a&&a.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"]),l(m,{outlined:"",modelValue:r.contact_number,"onUpdate:modelValue":t[4]||(t[4]=a=>r.contact_number=a),label:e.$t("Contact number"),"stack-label":"",color:"grey-5","lazy-rules":"",rules:[a=>a&&a.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"])]),l(A,{class:h(["q-pl-md q-pr-md q-pb-xs",{"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode}])},{default:s(()=>[l(p,{type:"submit",color:"primary","text-color":"white",label:e.$t("Update"),unelevated:"",class:"full-width radius8",size:"lg","no-caps":"",loading:r.loading},null,8,["label","loading"])]),_:1},8,["class"])]),_:1},8,["onSubmit"])]),_:1},8,["class"])],64)}var W=_(D,[["render",E]]);export{W as default};
