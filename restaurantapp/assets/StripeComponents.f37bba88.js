import{Q as g}from"./QToolbarTitle.0f4dda99.js";import{Q as _}from"./QSpace.7af5fd36.js";import{_ as f,A as a,n as l,p as h,q as o,d as i,b7 as y,$ as u,X as b,Y as k,a2 as p,ap as d,at as q,a0 as $,U as S,aQ as w}from"./index.f6661a24.js";import{Q as x}from"./QToolbar.7bb603c7.js";import{Q}from"./QForm.4e86ee71.js";import{l as v}from"./index.4f152a18.js";const C={name:"StripeComponents",data(){return{loading:!1,data:[],customer_id:"",client_secret:"",dialog:!1,render_loading:!0,publish_key:"",return_url:location.host,stripe:void 0,elements:void 0,cardElement:void 0,full_name:""}},setup(){return{}},created(){},methods:{PaymentRender(e){this.data=e,this.createAccount()},createAccount(){a.showLoadingBox(this.$t("Creating accont"),this.$q),a.PaymentPost("createMerchantAccount",this.data).then(e=>{this.customer_id=e.details.customer_id,this.subscribeAccount()}).catch(e=>{a.notify("dark",e,"error",this.$q)}).then(e=>{a.hideLoadingBox(this.$q)})},subscribeAccount(){a.showLoadingBox(this.$t("Subscribing"),this.$q),a.PaymentPost("Stripeubscribeaccount",{customer_id:this.customer_id,merchant_uuid:this.data.merchant_uuid,payment_code:this.data.payment_code,package_uuid:this.data.package_uuid}).then(e=>{this.client_secret=e.details.client_secret,this.publish_key=e.details.publish_key,this.return_url=e.details.origin+"/#/signup/validate-payment",this.dialog=!0}).catch(e=>{a.notify("dark",e,"error",this.$q)}).then(e=>{a.hideLoadingBox(this.$q)})},whenShow(){this.initStripe()},initStripe(){v("https://js.stripe.com/v3/").then(()=>{this.renderCard()}).catch(()=>{})},renderCard(){console.log("renderCard"),this.render_loading=!0,this.stripe=Stripe(this.publish_key),this.elements=this.stripe.elements();let e={},t=this.elements.create("card",{style:e});this.cardElement=t,setTimeout(()=>{t.mount(this.$refs.card_element)},100),setTimeout(()=>{this.render_loading=!1},500)},Subscribe(){this.loading=!0,this.elements,console.log(this.client_secret),this.stripe.confirmCardPayment(this.client_secret,{payment_method:{card:this.cardElement,billing_details:{name:this.full_name}}}).then(e=>{this.loading=!1,console.log(e),e.error?a.notify("dark",e.error.message,"error",this.$q):this.validatePayment(e.paymentIntent.id)})},validatePayment(e){a.showLoadingBox(this.$t("Validating payment"),this.$q),a.PaymentPost("Stripevalidatepayment",{payment_intent:e,merchant_uuid:this.data.merchant_uuid,payment_code:this.data.payment_code,package_uuid:this.data.package_uuid}).then(t=>{let n=t.details.status,c=t.details.message;n=="succeeded"?this.$router.push("/signup/thankyou"):n=="processing"?this.$router.push("/signup/payment-processing"):n=="requires_payment_method"&&a.notify("dark",c,"error",this.$q)}).catch(t=>{a.notify("dark",t,"error",this.$q)}).then(t=>{a.hideLoadingBox(this.$q)})}}},B={class:"q-pl-md q-pr-md q-mb-sm"},P={ref:"card_element",id:"card-element"},V={key:0,class:"flex flex-center text-center"};function A(e,t,n,c,s,m){return l(),h(w,{modelValue:s.dialog,"onUpdate:modelValue":t[2]||(t[2]=r=>s.dialog=r),position:"bottom",onShow:m.whenShow},{default:o(()=>[i(y,{class:"rounded-borders-top"},{default:o(()=>[i(x,{class:"text-primary top-toolbar q-pl-md",dense:""},{default:o(()=>[i(g,{class:u(["text-darkx text-weight-bold",{"text-white":e.$q.dark.mode,"text-dark":!e.$q.dark.mode}]),style:{overflow:"inherit"}},{default:o(()=>[b(k(e.$t("Enter your card details")),1)]),_:1},8,["class"]),i(_),i(p,{onClick:t[0]||(t[0]=r=>s.dialog=!1),color:"white",square:"",unelevated:"","text-color":"grey",icon:"las la-times",dense:"","no-caps":"",size:"sm",class:"border-grey radius8"})]),_:1}),i(Q,{onSubmit:m.Subscribe},{default:o(()=>[d("div",B,[i(q,{modelValue:s.full_name,"onUpdate:modelValue":t[1]||(t[1]=r=>s.full_name=r),label:e.$t("Card name"),outlined:"","stack-label":"",color:"grey-5",rules:[r=>r&&r.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"]),d("div",{class:u(["q-mb-lg q-pt-sm q-pa-md",{"bg-mygrey text-dark":e.$q.dark.mode,"bg-white text-black":!e.$q.dark.mode}])},[d("div",P,null,512)],2),s.render_loading?(l(),$("div",V,[i(S,{color:"primary",size:"2em"})])):(l(),h(p,{key:1,type:"submit",color:"primary","text-color":"white",label:e.$t("Subscribe"),unelevated:"",class:"full-width",size:"lg","no-caps":"",loading:s.loading},null,8,["label","loading"]))])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue","onShow"])}var U=f(C,[["render",A]]);export{U as default};
