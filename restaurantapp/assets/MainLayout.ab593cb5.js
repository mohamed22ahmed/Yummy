import{_ as v,b4 as b,ay as c,u as $,A as a,aq as u,b5 as l,b6 as D,m as d,n as S,p as k,q as r,d as i,ar as y,a2 as A,$ as h,az as p}from"./index.f6661a24.js";import{Q as q}from"./QToolbarTitle.0f4dda99.js";import{Q as C}from"./QToolbar.7bb603c7.js";import{Q as w}from"./QHeader.ba9c2ff9.js";import{Q}from"./QFooter.4f4f9530.js";import{Q as T,a as I}from"./QLayout.76694082.js";import{u as O}from"./UserStore.3896d23d.js";import{u as V}from"./AccessStore.ca0ffc27.js";import"./QResizeObserver.dc10e4c2.js";const P=b({name:"MainLayout",components:{TabsMenu:c(()=>p(()=>import("./TabsMenu.ad86b050.js"),["assets/TabsMenu.ad86b050.js","assets/QRouteTab.d83b202f.js","assets/index.f6661a24.js","assets/index.1593f83d.css","assets/QTabs.dbf6b89c.js","assets/QResizeObserver.dc10e4c2.js","assets/rtl.276c3f1b.js","assets/AccessStore.ca0ffc27.js"])),NotiButton:c(()=>p(()=>import("./NotiButton.02050c44.js"),["assets/NotiButton.02050c44.js","assets/index.f6661a24.js","assets/index.1593f83d.css","assets/QBadge.04d2c306.js","assets/index.9e157228.js","assets/UserStore.3896d23d.js"]))},setup(){const e=$(),t=O(),o=V();return{DataStore:e,UserStore:t,AccessStore:o}},data(){return{online:!1,tab:"home",loading:!1}},created(){this.DataStore.storeAvailable(this.$q.capacitor),this.AccessStore.getRefreshAccess(),this.$q.capacitor&&this.DeviceInit(),this.$q.dark.set(this.DataStore.dark_mode)},watch:{DataStore:{immediate:!0,deep:!0,handler(e,t){e.loading_available||(this.online=this.DataStore.store_available),e.loading||this.checkAppVersion()}}},methods:{searchPage(){this.$route.path=="/menu"?(this.DataStore.search_item="",this.$router.push("/search/food")):this.$router.push("/search")},setOnline(){let e=this.online?"Confirm Going Online":"Confirm Going Offline",t=this.online?this.$t("Are you sure you want to take your business online and start accepting orders again?"):this.$t("Are you sure you want to take your business offline temporarily? This will prevent new orders from coming in. Your current orders will still be processed.");this.$q.dialog({title:this.$t(e),message:t,cancel:!0,persistent:!0,ok:{color:"dark",flat:!0,"no-caps":!0,label:this.$t("Confirm")},cancel:{color:"primary",flat:!0,"no-caps":!0,label:this.$t("Cancel")}}).onOk(()=>{this.DataStore.setStoreAvailable(this.online)}).onCancel(()=>{this.online=!this.online}).onDismiss(()=>{})},DeviceInit(){const e=a.getSession("mt_device_token"),t=a.getSession("mt_device_registered"),o=a.getSession("mt_device_registered_auth");u.authenticated()?o!==1&&l.getId().then(s=>{l.getInfo().then(n=>{this.UserStore.device_uuid=s.identifier,this.updateDevice(e,s.identifier,n.platform)})}):t!==1&&l.getId().then(s=>{l.getInfo().then(n=>{this.UserStore.device_uuid=s.identifier,this.registerDevice(e,s.identifier,n.platform)})}),this.subsribeDevice()},registerDevice(e,t,o){a.registerDevice(e,t,o).then(s=>{a.setSession("mt_device_registered",1)})},updateDevice(e,t,o){a.updateDevice(e,t,o).then(s=>{a.setSession("mt_device_registered_auth",1)})},checkAppVersion(){this.$q.capacitor&&(this.$q.platform.is.android&&this.DataStore.app_version_android>0?this.DataStore.app_version_android>this.DataStore.app_version&&this.$router.replace("/update-app"):this.$q.platform.is.ios&&this.DataStore.app_version_ios>0&&this.DataStore.app_version_ios>this.DataStore.app_version&&this.$router.replace("/update-app"))},subsribeDevice(){let e=u.getUser();e&&!this.DataStore.push_off&&D.subscribeTo({topic:e.merchant_uuid}).then(t=>{this.DataStore.push_notifications=!0}).catch(t=>{this.DataStore.push_notifications=!1,a.notify("dark","Error subscribing topics"+JSON.stringify(t),"warning",this.$q)})}}});function U(e,t,o,s,n,B){const f=d("NotiButton"),m=d("TabsMenu"),_=d("router-view");return S(),k(T,{view:"lHh Lpr lFf"},{default:r(()=>[i(w,{class:h({"bg-mydark text-white":e.$q.dark.mode,"bg-grey-1 text-dark":!e.$q.dark.mode})},{default:r(()=>[i(C,null,{default:r(()=>[i(y,{modelValue:e.online,"onUpdate:modelValue":[t[0]||(t[0]=g=>e.online=g),e.setOnline],color:"primary",label:e.$t("Online")},null,8,["modelValue","label","onUpdate:modelValue"]),i(q),i(f),i(A,{round:"",color:"grey",icon:"search",flat:"",onClick:e.searchPage},null,8,["onClick"])]),_:1})]),_:1},8,["class"]),i(Q,{bordered:"",class:"bg-white text-dark modified-footer"},{default:r(()=>[i(m)]),_:1}),i(I,{class:h({"bg-mydark text-white":e.$q.dark.mode,"bg-grey-1 text-dark":!e.$q.dark.mode})},{default:r(()=>[i(_)]),_:1},8,["class"])]),_:1})}var J=v(P,[["render",U]]);export{J as default};
