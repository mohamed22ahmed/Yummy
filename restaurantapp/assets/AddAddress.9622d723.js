import{_ as q,ay as _,u as C,A as l,m as f,n as h,a0 as g,d as s,q as i,$ as b,F as V,X as Q,Y as u,a2 as y,p as D,as as v,ap as p,at as c,az as k}from"./index.f6661a24.js";import{Q as M}from"./QToolbarTitle.0f4dda99.js";import{Q as P}from"./QToolbar.7bb603c7.js";import{Q as z}from"./QHeader.ba9c2ff9.js";import{Q as n}from"./QSpace.7af5fd36.js";import{Q as T}from"./QSelect.4e3956e1.js";import{Q as w}from"./QBtnToggle.b6d48c98.js";import{Q as B}from"./QFooter.4f4f9530.js";import{Q as E}from"./QForm.4e86ee71.js";import{Q as F}from"./QPage.78315ab4.js";import{u as L}from"./CartStore.4102b575.js";import"./QResizeObserver.dc10e4c2.js";import"./QChip.5b52e54d.js";import"./QItemLabel.0d3c2221.js";import"./QMenu.c4f03f28.js";import"./selection.ef67fb9c.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";const O={name:"AddAddress",components:{SearchAddress:_(()=>k(()=>import("./SearchAddress.3f590a05.js"),["assets/SearchAddress.3f590a05.js","assets/index.f6661a24.js","assets/index.1593f83d.css","assets/QItemLabel.0d3c2221.js","assets/QSelect.4e3956e1.js","assets/QChip.5b52e54d.js","assets/QMenu.c4f03f28.js","assets/selection.ef67fb9c.js","assets/rtl.276c3f1b.js","assets/format.de7e9769.js"])),MapsComponents:_(()=>k(()=>import("./MapsComponents.c3f5635c.js"),["assets/MapsComponents.c3f5635c.js","assets/index.f6661a24.js","assets/index.1593f83d.css","assets/index.4f152a18.js"]))},setup(e){const t=C(),r=L();return{DataStore:t,CartStore:r}},mounted(){this.CartStore.posAttributes()},computed:{hasAddress(){return Object.keys(this.data).length>0}},data(){return{data:[],center:{lat:34.04703,lng:-118.24686},marker_position:{},dialog:!1,loading:!1,formatted_address:"",address1:"",location_name:"",delivery_options:"Leave it at my door",delivery_instructions:"",address_label:"Home"}},watch:{DataStore:{immediate:!0,deep:!0,handler(e,t){console.log(e.loading),Object.keys(e.maps_config).length>0?(this.maps_config=e.maps_config,this.setMarkerPosition(this.maps_config.default_lat,this.maps_config.default_lng),this.checkSavedLocation()):e.loading==!1}}},methods:{setMarkerPosition(e,t){this.marker_position=[{id:0,lat:parseFloat(e),lng:parseFloat(t),label:l.getIcon("customer"),icon:null,draggable:!0}]},afterSelectaddress(e){this.data=e,this.setMarkerPosition(e.latitude,e.longitude),this.formatted_address=e.address.formatted_address,this.address1=e.address.address1},afterSelectmap(e,t){this.$q.loading.show({spinnerSize:30,spinnerColor:"primary"}),l.fetchDataByTokenPost("reverseGeocoding","lat="+e+"&lng="+t).then(r=>{this.data=r.details.data,this.setMarkerPosition(r.details.data.latitude,r.details.data.longitude),this.formatted_address=r.details.data.address.formatted_address,this.address1=r.details.data.address.address1}).catch(r=>{}).then(r=>{this.$q.loading.hide()})},checkSavedLocation(){console.log("checkSavedLocation");let e=this.DataStore.place_data;Object.keys(e).length>0&&(this.data=e,this.formatted_address=e.address.formatted_address,this.address1=e.address.address1,this.location_name=e.location_name,this.delivery_options=e.delivery_options,this.delivery_instructions=e.delivery_instructions,this.address_label=e.address_label,this.setMarkerPosition(e.latitude,e.longitude))},onSubmit(){console.log("onSubmit"),l.empty(this.formatted_address)&&l.notify("dark",this.$t("Enter your location or select on the map"),"error",this.$q),this.loading=!0,l.fetchDataByTokenPost("saveCartAddress",{client_id:this.CartStore.customer_id,place_id:this.data.place_id,formatted_address:this.formatted_address,address1:this.address1,latitude:this.data.latitude,longitude:this.data.longitude,location_name:this.location_name,delivery_options:l.empty(this.delivery_options)?"":l.empty(this.delivery_options.value)?this.delivery_options:this.delivery_options.value,delivery_instructions:this.delivery_instructions,address_label:this.address_label}).then(e=>{this.data.location_name=this.location_name,this.data.delivery_options=this.delivery_options,this.data.delivery_instructions=this.delivery_instructions,this.data.address_label=this.address_label,this.DataStore.place_data=this.data,this.$router.back()}).catch(e=>{l.notify("red-5",e,"error_outline",this.$q)}).then(e=>{this.loading=!1})}}},U={class:"q-pt-sm q-pb-md"},I={class:"text-subtitle2"},N={class:"text-caption"},j={class:"text-weight-bold q-mb-sm"},x={key:0,class:"border-grey radius8"};function R(e,t,r,d,o,m){const S=f("SearchAddress"),A=f("MapsComponents");return h(),g(V,null,[s(z,{class:b({"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode}),reveal:""},{default:i(()=>[s(P,null,{default:i(()=>[s(M,{class:"text-weight-bold"},{default:i(()=>[Q(u(e.$t("Delivery address")),1)]),_:1}),s(y,{onClick:t[0]||(t[0]=a=>e.$router.back()),color:"white",square:"",unelevated:"","text-color":"grey",icon:"las la-times",dense:"","no-caps":"",size:"sm",class:"border-grey radius8"})]),_:1})]),_:1},8,["class"]),s(F,{class:b([{"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode},"q-pl-md q-pr-md"])},{default:i(()=>[s(S,{ref:"search_address",onAfterSelectaddress:m.afterSelectaddress,placeholder:e.$t("Enter your street and house number")},null,8,["onAfterSelectaddress","placeholder"]),s(n,{class:"q-pa-xs"}),d.DataStore.getMapsConfig?(h(),D(A,{key:0,ref:"mapRef",class:"maps",size:"fit",keys:d.DataStore.getMapsConfig.key,provider:d.DataStore.getMapsConfig.provider,zoom:d.DataStore.getMapsConfig.zoom,center:o.center,markers:o.marker_position,onAfterSelectmap:m.afterSelectmap},null,8,["keys","provider","zoom","center","markers","onAfterSelectmap"])):v("",!0),p("div",U,[p("div",I,u(o.address1),1),p("div",N,u(o.formatted_address),1)]),s(E,{onSubmit:m.onSubmit},{default:i(()=>[s(c,{outlined:"",modelValue:o.formatted_address,"onUpdate:modelValue":t[1]||(t[1]=a=>o.formatted_address=a),label:e.$t("Street name"),"stack-label":"",color:"grey-5","lazy-rules":"",rules:[a=>a&&a.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"]),s(c,{outlined:"",modelValue:o.address1,"onUpdate:modelValue":t[2]||(t[2]=a=>o.address1=a),label:e.$t("Street number"),"stack-label":"",color:"grey-5","lazy-rules":"",rules:[a=>a&&a.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"]),s(c,{outlined:"",modelValue:o.location_name,"onUpdate:modelValue":t[3]||(t[3]=a=>o.location_name=a),label:e.$t("Aparment, suite or floor"),"stack-label":"",color:"grey-5"},null,8,["modelValue","label"]),s(n,{class:"q-pa-sm"}),s(T,{outlined:"",modelValue:o.delivery_options,"onUpdate:modelValue":t[4]||(t[4]=a=>o.delivery_options=a),options:d.CartStore.getDeliveryOption,label:e.$t("Delivery options")},null,8,["modelValue","options","label"]),s(n,{class:"q-pa-sm"}),s(c,{modelValue:o.delivery_instructions,"onUpdate:modelValue":t[5]||(t[5]=a=>o.delivery_instructions=a),outlined:"",autogrow:"","stack-label":"",label:e.$t("Add delivery instructions"),hint:e.$t("eg. ring the bell after dropoff, leave next to the porch, call upon arrival, etc")},null,8,["modelValue","label","hint"]),s(n,{class:"q-pa-md"}),p("div",j,u(e.$t("Address label")),1),d.CartStore.getAddresslabel?(h(),g("div",x,[s(w,{modelValue:o.address_label,"onUpdate:modelValue":t[6]||(t[6]=a=>o.address_label=a),"toggle-color":"green",unelevated:"","no-caps":"",options:d.CartStore.getAddresslabel,spread:"",padding:"10px"},null,8,["modelValue","options"])])):v("",!0),s(n,{class:"q-pa-md"}),s(B,null,{default:i(()=>[s(y,{type:"submit",color:"primary","text-color":"white",label:e.$t("Save address"),unelevated:"",class:"full-width",size:"lg","no-caps":"",loading:o.loading,disable:!m.hasAddress},null,8,["label","loading","disable"])]),_:1})]),_:1},8,["onSubmit"])]),_:1},8,["class"])],64)}var ne=q(O,[["render",R]]);export{ne as default};
