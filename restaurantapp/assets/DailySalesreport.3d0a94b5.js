import{_ as C,ay as g,u as x,A as r,m as y,n as l,a0 as u,d as e,q as i,F as k,$ as v,a1 as D,p as P,as as T,ap as d,Y as s,a2 as b,az as $,a4 as A,a5 as B,X as c}from"./index.f6661a24.js";import{Q as p}from"./QItemLabel.0d3c2221.js";import{Q as E}from"./QList.16ddb51a.js";import{Q as F}from"./QInfiniteScroll.770dc11e.js";import{Q as I}from"./QSpace.7af5fd36.js";import{Q as O}from"./QPageSticky.199ae08d.js";import{Q as V}from"./QPageScroller.14e8a1ba.js";import{Q as R}from"./QPage.78315ab4.js";import{Q as z}from"./QPullToRefresh.a19885b1.js";import{P as N}from"./PrintTemplate.1e180354.js";import{A as m}from"./AppBluetooth.bdfa691f.js";import"./use-page-sticky.25bfa08e.js";import"./TouchPan.ca911d69.js";import"./touch.9135741d.js";import"./selection.ef67fb9c.js";import"./format.de7e9769.js";const j={name:"InvoiceList",components:{TableSkeleton:g(()=>$(()=>import("./TableSkeleton.a40b3052.js"),["assets/TableSkeleton.a40b3052.js","assets/QSkeleton.e9a2b7df.js","assets/index.f6661a24.js","assets/index.1593f83d.css","assets/QItemLabel.0d3c2221.js","assets/QList.16ddb51a.js"])),TableSummary:g(()=>$(()=>import("./TableSummary.747b0962.js"),["assets/TableSummary.747b0962.js","assets/QSkeleton.e9a2b7df.js","assets/index.f6661a24.js","assets/index.1593f83d.css","assets/swiper.min.f241f74a.js","assets/swiper.min.b39a1361.css"])),FilterDates:g(()=>$(()=>import("./FilterDates.3d118432.js"),["assets/FilterDates.3d118432.js","assets/QToolbarTitle.0f4dda99.js","assets/index.f6661a24.js","assets/index.1593f83d.css","assets/QSpace.7af5fd36.js","assets/QToolbar.7bb603c7.js","assets/QDate.b5ca4044.js","assets/use-render-cache.3aae9b27.js","assets/date.6d02ab88.js","assets/format.de7e9769.js","assets/QPopupProxy.98b4d203.js","assets/QMenu.c4f03f28.js","assets/selection.ef67fb9c.js","assets/QForm.4e86ee71.js","assets/ClosePopup.6296f014.js"])),PrinterList:g(()=>$(()=>import("./PrinterList.7567177e.js"),["assets/PrinterList.7567177e.js","assets/index.f6661a24.js","assets/index.1593f83d.css","assets/QToolbarTitle.0f4dda99.js","assets/QSpace.7af5fd36.js","assets/QToolbar.7bb603c7.js","assets/QList.16ddb51a.js","assets/QFooter.4f4f9530.js","assets/QResizeObserver.dc10e4c2.js","assets/ClosePopup.6296f014.js","assets/UserStore.3896d23d.js"]))},setup(){return{DataStore:x()}},created(){this.Summary()},computed:{hasData(){return Object.keys(this.data).length>0}},data(){return{loading:!1,data:[],page:0,status:[],is_refresh:void 0,handle:void 0,date_start:"",date_end:"",printer_details:[],restaurant_name:"",loading_summary:!1}},methods:{refresh(t){this.resetPagination(),this.Summary(),this.is_refresh=t},afterFilter(t){this.date_start=t.date_start,this.date_end=t.date_end,this.resetPagination()},List(t,a){this.loading=!0,r.fetchDataByTokenPost("dailyReportSales","&page="+t+"&date_start="+this.date_start+"&date_end="+this.date_end).then(n=>{n.code==1?(this.page=t,this.data.push(n.details.data)):n.code==3&&(this.data_done=!0,r.empty(this.$refs.nscroll)||this.$refs.nscroll.stop())}).catch(n=>{this.data_done=!0,r.empty(this.$refs.nscroll)||this.$refs.nscroll.stop()}).then(n=>{a(),this.loading=!1,r.empty(this.is_refresh)||this.is_refresh()})},resetPagination(){this.page=0,this.data=[],this.$refs.nscroll.reset(),this.$refs.nscroll.resume(),this.$refs.nscroll.trigger()},Summary(){this.loading_summary=!0,r.fetchDataByTokenPost("getDailySummary").then(t=>{this.data_summary=t.details.data}).catch(t=>{}).then(t=>{this.loading_summary=!1})},showPrinter(){this.$q.capacitor?this.DataStore.osVersion>=12?m.CheckBTConnectPermissionOnly().then(t=>{this.EnabledBT()}).catch(t=>{this.$router.push("/settings/location-enabled")}).then(t=>{}):m.CheckLocationOnly().then(t=>{this.$refs.printer.dialog=!0}).catch(t=>{this.$router.push("/settings/location-enabled")}).then(t=>{}):this.$refs.printer.dialog=!0},afterSelectprinter(t){this.printer_details=t,t.printer_model=="feieyun"?this.FPprint(t):this.$q.capacitor?this.CheckBT():r.notify("dark",this.$t("Bluetooth Printers works only in actual device"),"error",this.$q)},FPprint(t){this.$refs.printer.dialog=!1,r.showLoadingBox(this.$t("Printing..."),this.$q),r.fetchDataByTokenPost("FPprintdailysales","printer_id="+t.printer_id+"&date_start="+this.date_start+"&date_end="+this.date_end).then(a=>{r.notify("green",a.msg,"check",this.$q)}).catch(a=>{r.notify("dark",a,"error",this.$q)}).then(a=>{r.hideLoadingBox(this.$q)})},CheckBT(){m.Enabled().then(t=>{this.BondAndConnect()}).catch(t=>{r.notify("dark",t,"error",this.$q)}).then(t=>{})},BondAndConnect(){this.$refs.printer.dialog=!1,r.showLoadingBox(this.$t("Connecting..."),this.$q),m.Connect(this.printer_details.printer_uuid,this.printer_details.printer_model).then(t=>{this.Print()}).catch(t=>{r.notify("dark",t,"error",this.$q)}).then(t=>{r.hideLoadingBox(this.$q)})},Print(){this.$refs.printer.dialog=!1,this.$q.loading.show({spinnerSize:30,spinnerColor:"primary"}),r.fetchDataByTokenPost("GetDailysales","date_start="+this.date_start+"&date_end="+this.date_end).then(t=>{let a=N.DailySales(this.printer_details.paper_width,t.details.restaurant_name,t.details.range,t.details.data);console.log("TEMPLATE ==>"),console.log(a.tpl_all),console.log(a.tpl_data),Object.keys(a).length>0&&(this.printer_details.printer_model=="sunmi"?this.printData(a.tpl_all):Object.entries(a.tpl_data).forEach(([n,f])=>{r.empty(f)||(n>0?setTimeout(()=>{console.log(f),this.printData(f)},2e3):(console.log(f),this.printData(f)))}))}).catch(t=>{r.notify("dark",t,"error",this.$q)}).then(t=>{this.$q.loading.hide()})},printData(t){r.showLoadingBox(this.$t("Printing..."),this.$q),m.Print(this.printer_details.printer_uuid,t,this.printer_details.printer_model,this.printer_details.service_id,this.printer_details.characteristics).then(a=>{}).catch(a=>{r.notify("dark",a,"error",this.$q)}).then(a=>{r.hideLoadingBox(this.$q)})}}},G={class:"flex flex-center text-center"},M={class:"radius8 bg-green-10 text-white q-pa-xs text-center q-pl-sm q-pr-sm"},X={class:"font14 text-weight-bold"},Y={key:0,class:"full-width text-center flex flex-center",style:{"min-height":"calc(50vh)"}},H={class:"text-grey q-ma-none"},J={class:"column q-gutter-y-sm"};function K(t,a,n,f,_,h){const L=y("TableSummary"),S=y("TableSkeleton"),w=y("FilterDates"),Q=y("PrinterList");return l(),u(k,null,[e(z,{onRefresh:h.refresh},{default:i(()=>[e(R,{class:v([{"bg-mydark text-white":t.$q.dark.mode,"bg-grey-1 text-dark":!t.$q.dark.mode},"q-pr-md q-pl-md q-pt-md"])},{default:i(()=>[e(L,{ref:"table_summary",loading:_.loading_summary,data:t.data_summary,set_slide:2.5},null,8,["loading","data","set_slide"]),e(F,{ref:"nscroll",onLoad:h.List},{default:i(()=>[e(E,{separator:"",class:v(["bg-whitex",{"bg-grey600 text-white":t.$q.dark.mode,"bg-white":!t.$q.dark.mode}])},{default:i(()=>[(l(!0),u(k,null,D(_.data,q=>(l(),u(k,{key:q},[(l(!0),u(k,null,D(q,o=>(l(),P(A,{key:o,clickable:"",to:{path:"/orderview",query:{order_uuid:o.order_uuid}}},{default:i(()=>[e(B,{avatar:"",top:""},{default:i(()=>[d("div",G,[d("div",null,[d("div",M,[d("div",X," #"+s(o.order_id),1)])])])]),_:2},1024),e(B,{top:""},{default:i(()=>[e(p,{caption:"",class:"font12"},{default:i(()=>[c(s(o.date_created),1)]),_:2},1024),e(p,null,{default:i(()=>[c(s(o.service_name)+" - "+s(o.payment_name),1)]),_:2},1024),e(p,{caption:""},{default:i(()=>[c(s(t.$t("Total Sales"))+" : "+s(o.sub_total),1)]),_:2},1024),e(p,{caption:""},{default:i(()=>[c(s(t.$t("Delivery Fee"))+" : "+s(o.delivery_fee),1)]),_:2},1024),e(p,{caption:""},{default:i(()=>[c(s(t.$t("Tax"))+" : "+s(o.tax_total),1)]),_:2},1024),e(p,{caption:""},{default:i(()=>[c(s(t.$t("Tip"))+" : "+s(o.courier_tip),1)]),_:2},1024),e(p,{caption:""},{default:i(()=>[c(s(t.$t("Total"))+" : "+s(o.total),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["to"]))),128))],64))),128))]),_:1},8,["class"])]),loading:i(()=>[_.page<=0?(l(),P(S,{key:0,rows:10})):_.data.length>1?(l(),P(S,{key:1,rows:1})):T("",!0)]),_:1},8,["onLoad"]),!h.hasData&&!_.loading?(l(),u("div",Y,[d("p",H,s(t.$t("No available data")),1)])):T("",!0),e(I,{class:"q-pa-md"}),e(O,{position:"bottom-right",offset:[18,18]},{default:i(()=>[d("div",J,[d("div",null,[e(b,{icon:"o_date_range",round:"",size:"md",color:t.$q.dark.mode?"grey600":"green","text-color":t.$q.dark.mode?"grey300":"white",unelevated:"",onClick:a[0]||(a[0]=q=>this.$refs.filter_date.dialog=!0)},null,8,["color","text-color"])]),d("div",null,[e(b,{icon:"las la-print",round:"",size:"md",color:t.$q.dark.mode?"grey600":"mygrey","text-color":t.$q.dark.mode?"grey300":"dark",unelevated:"",onClick:h.showPrinter,disable:!h.hasData},null,8,["color","text-color","onClick","disable"])])])]),_:1}),e(V,{position:"bottom-right","scroll-offset":150,offset:[18,18]},{default:i(()=>[e(b,{fab:"",icon:"keyboard_arrow_up",color:t.$q.dark.mode?"grey600":"mygrey","text-color":t.$q.dark.mode?"grey300":"dark",dense:"",padding:"3px"},null,8,["color","text-color"])]),_:1})]),_:1},8,["class"])]),_:1},8,["onRefresh"]),e(w,{ref:"filter_date",onAfterFilter:h.afterFilter},null,8,["onAfterFilter"]),e(Q,{ref:"printer",onAfterSelectprinter:h.afterSelectprinter},null,8,["onAfterSelectprinter"])],64)}var ft=C(j,[["render",K]]);export{ft as default};
