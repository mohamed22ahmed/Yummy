import{_ as S,ay as x,u as q,A as p,m as P,n as s,a0 as n,d as i,q as r,F as m,$ as C,a1 as b,p as f,ap as y,Y as c,as as u,a2 as O,az as A,X as h,a4 as L,a5 as k,b9 as j}from"./index.f6661a24.js";import{Q as D}from"./QBadge.04d2c306.js";import{Q as z}from"./QTab.ac26d4d4.js";import{Q as I}from"./QTabs.dbf6b89c.js";import{Q as T}from"./QSpace.7af5fd36.js";import{Q as v}from"./QItemLabel.0d3c2221.js";import{Q as w}from"./QChip.5b52e54d.js";import{Q as U}from"./QList.16ddb51a.js";import{Q as $}from"./QInnerLoading.c6ed50f8.js";import{Q as B}from"./QSpinnerDots.25105ce0.js";import{Q as E}from"./QInfiniteScroll.770dc11e.js";import{Q as R}from"./QPageScroller.14e8a1ba.js";import{Q as V}from"./QPage.78315ab4.js";import{Q as N}from"./QPullToRefresh.a19885b1.js";import{u as F}from"./UserStore.3896d23d.js";import{u as H}from"./AccessStore.ca0ffc27.js";import{u as W}from"./OrderStore.c0aa6efc.js";import"./QResizeObserver.dc10e4c2.js";import"./rtl.276c3f1b.js";import"./use-page-sticky.25bfa08e.js";import"./TouchPan.ca911d69.js";import"./touch.9135741d.js";import"./selection.ef67fb9c.js";import"./format.de7e9769.js";const X={name:"OrdersList",components:{OrderPreview:x(()=>A(()=>import("./OrderPreview.c018e3fa.js"),["assets/OrderPreview.c018e3fa.js","assets/index.f6661a24.js","assets/index.1593f83d.css","assets/QToolbarTitle.0f4dda99.js","assets/QSpace.7af5fd36.js","assets/QToolbar.7bb603c7.js","assets/QImg.b7890c8b.js","assets/QItemLabel.0d3c2221.js","assets/QList.16ddb51a.js","assets/OrderStore.c0aa6efc.js","assets/PrintTemplate.1e180354.js","assets/AppBluetooth.bdfa691f.js"]))},data(){return{tab:"",tab_menu:[{label:this.$t("New Orders"),value:"new_order",permission:"orders.new"},{label:this.$t("Orders Processing"),value:"order_processing",permission:"orders.processing"},{label:this.$t("Orders Ready"),value:"order_ready",permission:"orders.ready"},{label:this.$t("Completed"),value:"completed_today",permission:"orders.completed"},{label:this.$t("Scheduled"),value:"scheduled",permission:"orders.scheduled"},{label:this.$t("All"),value:"all",permission:"orders.history"}],loading:!1,data:[],page:0,limit:10,status_list:{},item_details:{},order_items:[],settings_tabs:[],order_group_buttons:[],order_buttons:[],services_list:{},is_refresh:void 0,data_done:!1}},setup(t){const _=q(),o=F(),d=H(),e=W();return{DataStore:_,UserStore:o,AccessStore:d,OrderStore:e}},created(){this.tab=this.DataStore.order_tab,this.OrderStore.getCountOrder()},computed:{hasData(){return Object.keys(this.data).length>0}},watch:{tab(t,_){this.DataStore.order_tab=t,p.empty(this.$refs.nscroll)||this.resetPagination()},UserStore:{immediate:!0,deep:!0,handler(t,_){Object.keys(t.data_push_receive).length>0&&(console.log("LAST ORDER WATCH"),console.log(t.data_push_receive),t.data_push_receive.notification_type=="order_update"&&this.resetPagination())}}},methods:{refresh(t){this.resetPagination(),this.is_refresh=t},orderList(t,_){this.loading=!0,p.fetchDataByTokenPost("OrderList","filter_by="+this.tab+"&limit="+this.limit+"&page="+t).then(o=>{o.code==1?(this.page=t,this.data.push(o.details.data),Object.keys(o.details.status_list).length>0&&Object.entries(o.details.status_list).forEach(([d,e])=>{this.status_list[e.status]=e}),Object.keys(o.details.item_details).length>0&&Object.entries(o.details.item_details).forEach(([d,e])=>{this.item_details[d]=e}),Object.keys(o.details.services_list).length>0&&Object.entries(o.details.services_list).forEach(([d,e])=>{this.services_list[d]=e}),this.settings_tabs=o.details.settings_tabs,this.order_group_buttons=o.details.order_group_buttons,this.order_buttons=o.details.order_buttons):o.code==3&&(this.data_done=!0,console.log("end 3"),p.empty(this.$refs.nscroll)||this.$refs.nscroll.stop())}).catch(o=>{this.data_done=!0,p.empty(this.$refs.nscroll)||this.$refs.nscroll.stop()}).then(o=>{_(),this.loading=!1,p.empty(this.is_refresh)||this.is_refresh()})},resetPagination(){this.page=0,this.data=[],this.status_list={},this.item_details={},p.empty(this.$refs.nscroll)||(this.$refs.nscroll.reset(),this.$refs.nscroll.resume(),this.$refs.nscroll.trigger()),this.OrderStore.getCountOrder()},showPreview(t){this.order_items=t,this.$refs.order_preview.dialog=!0},afterUpdatestatus(){this.resetPagination()}}},Y={key:0,class:"blob green q-mb-xs"},G={key:1,class:"blob red"},J={key:1,class:"row justify-center q-my-md"},K={key:0,class:"row justify-center q-my-sm"},M={class:"font12 text-grey"},Z={key:1,style:{height:"calc(70vh)"},class:"flex flex-center"},ee={class:"full-width text-center"},te={class:"font16 text-weight-bold"},se={class:"text-grey font12"};function re(t,_,o,d,e,g){const Q=P("OrderPreview");return s(),n(m,null,[i(N,{onRefresh:g.refresh},{default:r(()=>[i(V,{class:C(["q-pr-md q-pl-md",{"bg-mydark text-white":t.$q.dark.mode,"bg-grey-1 text-dark":!t.$q.dark.mode}])},{default:r(()=>[i(I,{modelValue:e.tab,"onUpdate:modelValue":_[0]||(_[0]=l=>e.tab=l),dense:"","no-caps":"","active-color":"primary","indicator-color":t.$q.dark.mode?"mydark":"grey-1",align:"justify","narrow-indicator":"",shrink:"","switch-indicator":"false",class:"text-grey",stretch:""},{default:r(()=>[(s(!0),n(m,null,b(e.tab_menu,l=>(s(),n(m,{key:l},[d.AccessStore.hasAccess(l.permission)?(s(),f(z,{key:0,name:l.value,"no-caps":"",class:"no-wrap q-pa-none"},{default:r(()=>[i(O,{label:l.label,unelevated:"","no-caps":"",color:e.tab==l.value?"primary":t.$q.dark.mode?"grey600":"mygrey","text-color":e.tab==l.value?"white":t.$q.dark.mode?"grey300":"dark",class:"radius28 q-mr-sm"},{default:r(()=>[d.OrderStore.foundCountOrder(l.value)?(s(),f(D,{key:0,color:"green-12",floating:"",style:{right:"-2px"}},{default:r(()=>[h(c(d.OrderStore.foundCountOrder(l.value)),1)]),_:2},1024)):u("",!0)]),_:2},1032,["label","color","text-color"])]),_:2},1032,["name"])):u("",!0)],64))),128))]),_:1},8,["modelValue","indicator-color"]),i(T,{class:"q-pa-xs"}),i(E,{ref:"nscroll",onLoad:g.orderList,offset:250},{loading:r(()=>[e.page<=0?(s(),f($,{key:0,showing:!0,color:"primary",size:"md"})):(s(),n("div",J,[i(B,{color:"primary",size:"40px"})]))]),default:r(()=>[i(U,{separator:""},{default:r(()=>[(s(!0),n(m,null,b(e.data,l=>(s(),n(m,{key:l},[(s(!0),n(m,null,b(l,a=>(s(),f(L,{key:a,clickable:"",onClick:oe=>g.showPreview(a)},{default:r(()=>[a.is_view=="0"||a.is_critical==!0?(s(),f(k,{key:0,avatar:"",style:{"min-width":"12px","padding-right":"5px"}},{default:r(()=>[a.is_view=="0"?(s(),n("div",Y)):u("",!0),a.is_critical==!0?(s(),n("div",G)):u("",!0)]),_:2},1024)):u("",!0),i(k,null,{default:r(()=>[i(v,{class:"text-weight-medium"},{default:r(()=>[h(c(a.order_id),1)]),_:2},1024),i(v,{caption:""},{default:r(()=>[h(c(a.description),1)]),_:2},1024),i(v,{caption:"",class:"font11"},{default:r(()=>[h(c(a.date_created),1)]),_:2},1024)]),_:2},1024),i(k,{side:""},{default:r(()=>[e.services_list[a.order_type]?(s(),f(w,{key:0,color:t.$q.dark.mode?"grey600":"mygrey","text-color":t.$q.dark.mode?"grey300":"dark",size:"sm",class:"q-ma-none"},{default:r(()=>[h(c(e.services_list[a.order_type].service_name),1)]),_:2},1032,["color","text-color"])):u("",!0),e.status_list[a.status_raw]?(s(),f(w,{key:1,size:"xs",color:"primary","text-color":"white",style:j(`color:${e.status_list[a.status_raw].font_color_hex} !important; background-color:${e.status_list[a.status_raw].background_color_hex} !important; `)},{default:r(()=>[h(c(a.status),1)]),_:2},1032,["style"])):u("",!0),i(w,{size:"xs",color:"mygrey","text-color":"dark"},{default:r(()=>[h(c(a.payment_status_name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))],64))),128))]),_:1})]),_:1},8,["onLoad"]),e.loading?u("",!0):(s(),n(m,{key:0},[g.hasData?(s(),n(m,{key:0},[e.data_done&&e.page>=2?(s(),n("div",K,[y("p",M,c(t.$t("end of results")),1)])):u("",!0)],64)):(s(),n("div",Z,[y("div",ee,[y("div",te,c(t.$t("No Orders")),1),y("p",se,c(t.$t("If there is order it will show here")),1)])]))],64)),i(R,{position:"bottom-right","scroll-offset":150,offset:[18,18]},{default:r(()=>[i(O,{fab:"",icon:"keyboard_arrow_up",color:t.$q.dark.mode?"grey600":"mygrey","text-color":t.$q.dark.mode?"grey300":"dark",dense:"",padding:"3px"},null,8,["color","text-color"])]),_:1})]),_:1},8,["class"])]),_:1},8,["onRefresh"]),i(Q,{ref:"order_preview",data:e.order_items,items_details:e.item_details,settings_tabs:e.settings_tabs,order_group_buttons:e.order_group_buttons,order_buttons:e.order_buttons,onAfterUpdatestatus:g.afterUpdatestatus},null,8,["data","items_details","settings_tabs","order_group_buttons","order_buttons","onAfterUpdatestatus"])],64)}var Ce=S(X,[["render",re]]);export{Ce as default};
