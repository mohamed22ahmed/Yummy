import{_ as Q,u as C,ay as q,A as s,b5 as $,m as V,n as a,a0 as f,d as l,q as n,$ as g,F as y,a2 as m,X as v,Y as k,p as u,as as b,Z as D,at as d,ac as P,a3 as U,a4 as L,a5 as T,ar as E,ap as A,az as w,a8 as I}from"./index.f6661a24.js";import{Q as F}from"./QToolbarTitle.0f4dda99.js";import{Q as N}from"./QToolbar.7bb603c7.js";import{Q as O}from"./QHeader.ba9c2ff9.js";import{Q as z}from"./QInnerLoading.c6ed50f8.js";import{Q as c}from"./QSelect.4e3956e1.js";import{Q as j}from"./QItemLabel.0d3c2221.js";import{Q as R}from"./QList.16ddb51a.js";import{Q as M}from"./QFooter.4f4f9530.js";import{Q as Y}from"./QForm.4e86ee71.js";import{Q as x}from"./QPage.78315ab4.js";import{u as K}from"./UserStore.3896d23d.js";import{A as p}from"./AppBluetooth.bdfa691f.js";import{P as W}from"./PrintTemplate.1e180354.js";import"./QResizeObserver.dc10e4c2.js";import"./QChip.5b52e54d.js";import"./QMenu.c4f03f28.js";import"./selection.ef67fb9c.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";const H={data(){return{loading:!1,loading_get:!1,printer_id:0,printer_name:"",printer_bt_name:"",printer_uuid:"",printer_device_name:"",printer_model:"bluetooth",paper_width:"58",auto_print:!1,paper_type:[{label:"58mm",value:"58"},{label:"80mm",value:"80"}],printer_user:"",printer_ukey:"",printer_sn:"",printer_key:"",osVersion:0,services_list:[],service_id:"",characteristics_list:[],characteristics:""}},setup(){const e=C(),i=K();return{DataStore:e,UserStore:i}},components:{BTprinterList:q(()=>w(()=>import("./BTprinterList.38f1eb44.js"),["assets/BTprinterList.38f1eb44.js","assets/QCircularProgress.24399868.js","assets/index.f6661a24.js","assets/index.1593f83d.css","assets/format.de7e9769.js","assets/QToolbarTitle.0f4dda99.js","assets/QSpace.7af5fd36.js","assets/QToolbar.7bb603c7.js","assets/QList.16ddb51a.js","assets/QFooter.4f4f9530.js","assets/QResizeObserver.dc10e4c2.js","assets/AppBluetooth.bdfa691f.js"])),ConfirmDialog:q(()=>w(()=>import("./ConfirmDialog.5cba1a11.js"),["assets/ConfirmDialog.5cba1a11.js","assets/QToolbarTitle.0f4dda99.js","assets/index.f6661a24.js","assets/index.1593f83d.css","assets/QToolbar.7bb603c7.js"]))},created(){this.printer_id=this.$route.query.id,this.printer_id>0&&this.getPrinter(),this.$q.capacitor&&this.getDevice()},computed:{hasPrinter(){if(this.printer_model=="feieyun"){if(!s.empty(this.printer_sn))return!0}else if(!s.empty(this.printer_uuid))return!0;return!1},hasPrinter2(){if(this.printer_model=="feieyun"){if(!s.empty(this.printer_sn)&&parseInt(this.printer_id)>0)return!0}else if(!s.empty(this.printer_uuid))return!0;return!1},isEdit(){return parseInt(this.printer_id)>0}},methods:{async getDevice(){const e=await $.getInfo();this.osVersion=e.osVersion,this.initBT()},initBT(){this.osVersion>=12?p.CheckBTScanPermission().then(e=>{}).catch(e=>{s.notify("dark",e.message,"error",this.$q)}).then(e=>{}):p.CheckLocationOnly().then(e=>{}).catch(e=>{this.$router.push("/settings/location-enabled")}).then(e=>{})},onSubmit(){this.loading=!0,s.fetchDataByToken("SavePrinter",{printer_id:this.printer_id,printer_name:this.printer_name,printer_bt_name:this.printer_bt_name,printer_uuid:this.printer_uuid,printer_model:this.printer_model,paper_width:this.paper_width,auto_print:this.auto_print,paper_width:this.paper_width,device_uuid:this.UserStore.device_uuid,printer_user:this.printer_user,printer_ukey:this.printer_ukey,printer_sn:this.printer_sn,printer_key:this.printer_key,service_id:this.service_id,characteristics:this.characteristics}).then(e=>{s.notify(this.$q.dark.mode?"grey600":"light-green",e.msg,"check_circle",this.$q),this.UserStore.getAutoPrinter(),this.$router.replace("/settings/printers")}).catch(e=>{s.notify("dark",e,"error",this.$q)}).then(e=>{this.loading=!1})},getPrinter(){this.loading_get=!0,s.fetchDataByTokenPost("PrinterDetails","printer_id="+this.printer_id).then(e=>{this.printer_name=e.details.printer_name,this.printer_bt_name=e.details.printer_bt_name,this.printer_model=e.details.printer_model,this.paper_width=e.details.paper_width,this.auto_print=e.details.auto_print,this.printer_uuid=e.details.printer_uuid,this.printer_device_name=e.details.printer_name,this.printer_user=e.details.printer_user,this.printer_ukey=e.details.printer_ukey,this.printer_sn=e.details.printer_sn,this.printer_key=e.details.printer_key,this.service_id=e.details.service_id,this.characteristics=e.details.characteristics}).catch(e=>{s.notify("dark",e,"error",this.$q)}).then(e=>{this.loading_get=!1})},searchBT(){this.printer_model=="feieyun"||(this.$q.capacitor?this.$refs.btprinter_list.dialog=!0:s.notify("dark","Bluetooth printer only works in mobile device","error",this.$q))},afterSelectprinter(e,i,_){this.printer_device_name=e.name,this.printer_name=e.name,this.printer_bt_name=e.name,this.printer_uuid=e.address,this.services_list=[],Object.keys(i).length>0&&Object.entries(i).forEach(([h,r])=>{r.length,this.services_list.push({label:r,value:r})}),this.characteristics_list=[],Object.keys(_).length>0&&Object.entries(_).forEach(([h,r])=>{r.characteristic.length,r.properties.includes("Write")===!0&&(this.characteristics=r.characteristic),r.properties.includes("Write")===!0&&(this.service_id=r.service),this.characteristics_list.push({label:r.characteristic,value:r.characteristic})})},confirmDelete(){this.$refs.confirm_dialog.dialog=!0},afterConfirm(){this.$refs.confirm_dialog.dialog=!1,s.showLoadingBox("",this.$q),s.fetchDataByTokenPost("deletePrinter","printer_id="+this.printer_id).then(e=>{this.$router.replace("/settings/printers")}).catch(e=>{s.notify("dark",e,"error",this.$q)}).then(e=>{s.hideLoadingBox(this.$q)})},PrintTest(){p.Enabled().then(e=>{this.printer_model=="feieyun"?this.FPtestprint():this.Connect()}).catch(e=>{s.notify("dark",e.message,"error",this.$q)}).then(e=>{})},Connect(){s.showLoadingBox("Connecting...",this.$q),p.Connect(this.printer_uuid,this.printer_model).then(e=>{this.Print()}).catch(e=>{s.notify("dark",e,"error",this.$q)}).then(e=>{s.hideLoadingBox(this.$q)})},Print(){let e=W.SampleTemplate(this.paper_width);console.log("TEMPLATE ==>"),console.log(e),s.showLoadingBox("Printing...",this.$q),p.Print(this.printer_uuid,e,this.printer_model,this.service_id,this.characteristics).then(i=>{}).catch(i=>{s.notify("dark",i,"error",this.$q)}).then(i=>{s.hideLoadingBox(this.$q)})},FPtestprint(){s.showLoadingBox("Printing...",this.$q),s.fetchDataByTokenPost("FPtestprint","printer_id="+this.printer_id).then(e=>{s.notify(this.$q.dark.mode?"grey600":"light-green",e.msg,"check",this.$q)}).catch(e=>{s.notify("dark",e,"error",this.$q)}).then(e=>{s.hideLoadingBox(this.$q)})}}};function X(e,i,_,h,r,o){const S=V("BTprinterList"),B=V("ConfirmDialog");return a(),f(y,null,[l(O,{class:g({"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode})},{default:n(()=>[l(N,null,{default:n(()=>[l(m,{onClick:i[0]||(i[0]=t=>e.$router.back()),flat:"",round:"",dense:"",icon:"las la-angle-left",color:e.$q.dark.mode?"white":"dark"},null,8,["color"]),l(F,{class:"text-weight-bold"},{default:n(()=>[v(k(e.$t("Printers")),1)]),_:1}),o.isEdit&&!r.loading_get?(a(),u(m,{key:0,round:"",color:"mygrey","text-color":"dark",icon:"las la-trash",size:"sm",unelevated:"",onClick:o.confirmDelete},null,8,["onClick"])):b("",!0)]),_:1}),l(D)]),_:1},8,["class"]),l(x,{class:g([{"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode},"q-pa-md"])},{default:n(()=>[r.loading_get?(a(),u(z,{key:0,showing:!0,color:"primary",size:"md"})):(a(),u(Y,{key:1,onSubmit:o.onSubmit},{default:n(()=>[l(c,{outlined:"",modelValue:r.printer_model,"onUpdate:modelValue":i[1]||(i[1]=t=>r.printer_model=t),label:e.$t("Printer Model"),color:"grey-5","stack-label":"",behavior:"dialog","transition-show":"fade","transition-hide":"fade",options:h.DataStore.printer_list,rules:[t=>t&&t.length>0||this.$t("This field is required")],"emit-value":"","map-options":""},null,8,["modelValue","label","options","rules"]),r.printer_model=="feieyun"?(a(),f(y,{key:0},[l(d,{modelValue:r.printer_name,"onUpdate:modelValue":i[2]||(i[2]=t=>r.printer_name=t),label:e.$t("Name"),outlined:"","stack-label":"",color:"grey-5",rules:[t=>t&&t.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"]),l(d,{modelValue:r.printer_user,"onUpdate:modelValue":i[3]||(i[3]=t=>r.printer_user=t),label:e.$t("USER"),outlined:"","stack-label":"",color:"grey-5",rules:[t=>t&&t.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"]),l(d,{modelValue:r.printer_ukey,"onUpdate:modelValue":i[4]||(i[4]=t=>r.printer_ukey=t),label:e.$t("UKEY"),outlined:"","stack-label":"",color:"grey-5",rules:[t=>t&&t.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"]),l(d,{modelValue:r.printer_sn,"onUpdate:modelValue":i[5]||(i[5]=t=>r.printer_sn=t),label:e.$t("SN"),outlined:"","stack-label":"",color:"grey-5",rules:[t=>t&&t.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"]),l(d,{modelValue:r.printer_key,"onUpdate:modelValue":i[6]||(i[6]=t=>r.printer_key=t),label:"KEY",outlined:"","stack-label":"",color:"grey-5",rules:[t=>t&&t.length>0||this.$t("This field is required")]},null,8,["modelValue","rules"])],64)):(a(),u(d,{key:1,modelValue:r.printer_device_name,"onUpdate:modelValue":i[7]||(i[7]=t=>r.printer_device_name=t),label:e.$t("Search printer"),outlined:"","stack-label":"",color:"grey-5",rules:[t=>t&&t.length>0||this.$t("This field is required")],readonly:""},{append:n(()=>[l(P,{name:"search",color:"dark",class:"cursor-pointer",onClick:o.searchBT},null,8,["onClick"])]),_:1},8,["modelValue","label","rules"])),r.printer_model!="feieyun"?(a(),f(y,{key:2},[l(d,{modelValue:r.printer_name,"onUpdate:modelValue":i[8]||(i[8]=t=>r.printer_name=t),label:e.$t("Name"),outlined:"","stack-label":"",color:"grey-5",rules:[t=>t&&t.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"]),l(c,{outlined:"",modelValue:r.service_id,"onUpdate:modelValue":i[9]||(i[9]=t=>r.service_id=t),label:e.$t("Service ID"),color:"grey-5","stack-label":"",behavior:"dialog","transition-show":"fade","transition-hide":"fade",options:r.services_list,rules:[t=>t&&t.length>0||this.$t("This field is required")],"emit-value":"","map-options":""},null,8,["modelValue","label","options","rules"]),l(c,{outlined:"",modelValue:r.characteristics,"onUpdate:modelValue":i[10]||(i[10]=t=>r.characteristics=t),label:e.$t("Characteristics"),color:"grey-5","stack-label":"",behavior:"dialog","transition-show":"fade","transition-hide":"fade",options:r.characteristics_list,rules:[t=>t&&t.length>0||this.$t("This field is required")],"emit-value":"","map-options":""},null,8,["modelValue","label","options","rules"])],64)):b("",!0),l(c,{outlined:"",modelValue:r.paper_width,"onUpdate:modelValue":i[11]||(i[11]=t=>r.paper_width=t),label:e.$t("Paper width"),color:"grey-5","stack-label":"",behavior:"dialog","transition-show":"fade","transition-hide":"fade",options:r.paper_type,rules:[t=>t&&t.length>0||this.$t("This field is required")],"emit-value":"","map-options":""},null,8,["modelValue","label","options","rules"]),l(R,null,{default:n(()=>[U((a(),u(L,{tag:"label"},{default:n(()=>[l(T,null,{default:n(()=>[l(j,null,{default:n(()=>[v(k(e.$t("Print automatically")),1)]),_:1})]),_:1}),l(T,{avatar:""},{default:n(()=>[l(E,{color:"primary",modelValue:r.auto_print,"onUpdate:modelValue":i[12]||(i[12]=t=>r.auto_print=t)},null,8,["modelValue"])]),_:1})]),_:1})),[[I]])]),_:1}),l(M,{class:g(["q-pa-md",{"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode}])},{default:n(()=>[o.hasPrinter2?(a(),u(m,{key:0,"no-caps":"",unelevated:"",color:"mygrey","text-color":"grey",class:"full-width q-mb-md",size:"lg",onClick:o.PrintTest},{default:n(()=>[l(P,{left:"",name:"printer"}),A("div",null,k(e.$t("Print Test")),1)]),_:1},8,["onClick"])):b("",!0),l(m,{type:"submit",color:"primary","text-color":"white",label:o.isEdit?this.$t("Update"):this.$t("Save Printer"),unelevated:"",class:"full-width",size:"lg","no-caps":"",loading:r.loading,disable:!o.hasPrinter},null,8,["label","loading","disable"])]),_:1},8,["class"])]),_:1},8,["onSubmit"])),l(S,{ref:"btprinter_list",onAfterSelectprinter:o.afterSelectprinter},null,8,["onAfterSelectprinter"]),l(B,{ref:"confirm_dialog",data:h.DataStore.data_dialog,onAfterConfirm:o.afterConfirm},null,8,["data","onAfterConfirm"])]),_:1},8,["class"])],64)}var ge=Q(H,[["render",X]]);export{ge as default};
