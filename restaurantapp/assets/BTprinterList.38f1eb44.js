import{Q as _}from"./QCircularProgress.24399868.js";import{Q as k}from"./QToolbarTitle.0f4dda99.js";import{Q as f}from"./QSpace.7af5fd36.js";import{_ as S,A as d,n as c,p as h,q as r,d as a,b7 as b,as as v,X as m,Y as u,a2 as g,a0 as y,F as Q,a1 as w,a4 as B,a5 as T,aQ as q,ap as x}from"./index.f6661a24.js";import{Q as C}from"./QToolbar.7bb603c7.js";import{Q as D}from"./QList.16ddb51a.js";import{Q as A}from"./QFooter.4f4f9530.js";import{A as n}from"./AppBluetooth.bdfa691f.js";import"./format.de7e9769.js";import"./QResizeObserver.dc10e4c2.js";const V={name:"BTprinterList",data(){return{dialog:!1,loading:!1,data:[],new_data:[],device_list:[],paired_data:[]}},setup(){return{}},watch:{paired_data(e,t){console.log("PAIRED DATA=>"),console.log(JSON.stringify(e)),Object.keys(e).length>0&&Object.entries(e).forEach(([p,s])=>{this.new_data.push({name:s.name,address:s.address}),this.device_list.push(s.address)})},data(e,t){Object.keys(e).length>0&&Object.entries(e).forEach(([p,s])=>{this.device_list.includes(s.address)||this.new_data.push({name:s.name,address:s.address}),this.device_list.push(s.address)})}},methods:{whenShow(){this.device_list=[],this.data=[],this.new_data=[],this.initBT()},setPrinter(e){this.dialog=!1,this.stopScan(),d.showLoadingBox("",this.$q),n.GetServices(e.address).then(t=>{this.disconnectBT(e.address),this.$emit("afterSelectprinter",e,t.services,t.characteristics)}).catch(t=>{d.notify("dark",t,"error",this.$q)}).then(t=>{d.hideLoadingBox(this.$q)})},disconnectBT(e){n.Disconnect(e).then(t=>{}).catch(t=>{}).then(t=>{})},initBT(){n.Enabled().then(e=>{this.retrieveDevice(),setTimeout(()=>{this.Scan()},100)}).catch(e=>{d.notify("dark",e.message,"error",this.$q)}).then(e=>{})},stopScan(){n.StopScan().then(e=>{this.dialog=!1}).catch(e=>{this.dialog=!1}).then(e=>{})},Scan(){this.loading=!0,n.Scan().then(e=>{this.data=e}).catch(e=>{this.data=[],d.notify("dark",e.message,"error",this.$q)}).then(e=>{this.loading=!1})},retrieveDevice(){n.retrieveDevice().then(e=>{this.paired_data=e}).catch(e=>{this.paired_data=[]}).then(e=>{})}}},$=x("div",{class:"col"},null,-1);function L(e,t,p,s,o,l){return c(),h(q,{modelValue:o.dialog,"onUpdate:modelValue":t[1]||(t[1]=i=>o.dialog=i),position:"bottom",onShow:l.whenShow,onHide:l.stopScan,persistent:""},{default:r(()=>[a(b,{class:"rounded-borders-top"},{default:r(()=>[a(C,{class:"text-primary top-toolbar q-pl-md",dense:""},{default:r(()=>[a(k,{class:"text-dark text-weight-bold",style:{overflow:"inherit"}},{default:r(()=>[o.loading?(c(),h(_,{key:0,indeterminate:"",size:"20px",thickness:.22,rounded:"",color:"primary","track-color":"grey-3",class:"q-mr-sm"},null,8,["thickness"])):v("",!0),m(" "+u(e.$t("Bluetooth Printer")),1)]),_:1}),a(f),a(g,{onClick:t[0]||(t[0]=i=>o.dialog=!1),color:"white",square:"",unelevated:"","text-color":"grey",icon:"las la-times",dense:"","no-caps":"",size:"sm",class:"border-grey radius8"})]),_:1}),a(D,{separator:""},{default:r(()=>[(c(!0),y(Q,null,w(o.new_data,i=>(c(),h(B,{key:i,clickable:"",onClick:P=>l.setPrinter(i)},{default:r(()=>[a(T,null,{default:r(()=>[m(u(i.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}),a(f,{class:"q-pa-xl"}),a(A,{class:"bg-white border-grey-top q-pa-sm row"},{default:r(()=>[$,a(g,{flat:"",label:e.$t("Cancel"),color:"dark",onClick:l.stopScan,"no-caps":"",class:"col"},null,8,["label","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onShow","onHide"])}var R=S(V,[["render",L]]);export{R as default};
