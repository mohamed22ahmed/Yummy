import{_ as T,ay as V,u as U,A as s,m as S,n as m,p as c,q as l,d as e,a2 as k,a0 as g,X as h,Y as u,F as b,as as y,Z as M,$ as q,ap as v,ac as F,at as I,a4 as p,a5 as r,a6 as _,az as A}from"./index.f6661a24.js";import{Q as B}from"./QToolbarTitle.0f4dda99.js";import{Q as O}from"./QToolbar.7bb603c7.js";import{Q as z}from"./QHeader.ba9c2ff9.js";import{Q as L}from"./QInnerLoading.c6ed50f8.js";import{Q as C}from"./QImg.b7890c8b.js";import{Q as j}from"./QSpace.7af5fd36.js";import{Q}from"./QSelect.4e3956e1.js";import{Q as N}from"./QList.16ddb51a.js";import{Q as R}from"./QFooter.4f4f9530.js";import{Q as $}from"./QForm.4e86ee71.js";import{Q as G}from"./QPage.78315ab4.js";import{Q as x}from"./QPullToRefresh.a19885b1.js";import{u as H}from"./MenuStore.420c66e5.js";import{A as D}from"./AppCamera.4fe7ee93.js";import{u as J}from"./AccessStore.ca0ffc27.js";import"./QResizeObserver.dc10e4c2.js";import"./QChip.5b52e54d.js";import"./QItemLabel.0d3c2221.js";import"./QMenu.c4f03f28.js";import"./selection.ef67fb9c.js";import"./rtl.276c3f1b.js";import"./format.de7e9769.js";import"./TouchPan.ca911d69.js";import"./touch.9135741d.js";const X={name:"ManageItems",components:{ConfirmDialog:V(()=>A(()=>import("./ConfirmDialog.5cba1a11.js"),["assets/ConfirmDialog.5cba1a11.js","assets/QToolbarTitle.0f4dda99.js","assets/index.f6661a24.js","assets/index.1593f83d.css","assets/QToolbar.7bb603c7.js"])),UploaderFile:V(()=>A(()=>import("./UploaderFile.36c0f73c.js"),["assets/UploaderFile.36c0f73c.js","assets/QUploader.d12c38b5.js","assets/index.f6661a24.js","assets/index.1593f83d.css","assets/QCircularProgress.24399868.js","assets/format.de7e9769.js"])),ItemTranslation:V(()=>A(()=>import("./ItemTranslation.1087e138.js"),["assets/ItemTranslation.1087e138.js","assets/index.f6661a24.js","assets/index.1593f83d.css","assets/QSpace.7af5fd36.js","assets/QExpansionItem.f7624880.js","assets/QItemLabel.0d3c2221.js","assets/QSlideTransition.07e7f5c6.js","assets/QList.16ddb51a.js"]))},data(){return{loading_get:!1,loading:!1,id:"",item_name:"",item_short_description:"",item_description:"",item_price:"",item_unit:"",category_selected:[],category_value:[],status:"publish",item_featured:[],item_featured_value:[],upload_enabled:!1,featured_filename:"",featured_url:"",upload_path:"",featured_data:"",fields:[{name:"name",title:this.$t("Enter name"),type:"text"},{name:"description",title:this.$t("Enter description"),type:"textarea"}],translation_data:[],translation:[],price_range:"",price_list:[],total_addon:""}},setup(){const t=U(),a=H(),f=J();return{DataStore:t,MenuStore:a,AccessStore:f}},computed:{isEdit(){return!s.empty(this.id)},hasPhoto(){return!s.empty(this.featured_filename)},hasData(){return Object.keys(this.featured_data).length>0}},created(){this.MenuStore.getCategoryList(),this.id=this.$route.query.item_uuid,s.empty(this.id)||this.getItem()},methods:{refresh(t){s.empty(this.id)?t():this.getItem(t)},getItem(t){this.loading_get=!0,s.fetchDataByTokenPost("getItem","id="+this.id).then(a=>{this.item_name=a.details.item_name,this.item_short_description=a.details.item_short_description,this.item_description=a.details.item_description,this.item_price=a.details.item_price,this.item_unit=a.details.item_unit,this.category_selected=a.details.category_selected,this.item_featured=a.details.item_featured,this.status=a.details.status,this.featured_filename=a.details.photo,this.featured_url=a.details.photo_url,this.upload_path=a.details.path,this.translation=a.details.translation,this.price_range=a.details.price_range,this.price_list=a.details.price_list,this.total_addon=a.details.total_addon}).catch(a=>{s.notify("dark",a,"error",this.$q)}).then(a=>{this.loading_get=!1,s.empty(t)||t()})},onSubmit(){this.loading=!0;const t=[],a=[];Object.keys(this.category_selected).length>0&&Object.entries(this.category_selected).forEach(([d,i])=>{t.push(i.value)}),Object.keys(this.item_featured).length>0&&Object.entries(this.item_featured).forEach(([d,i])=>{a.push(i.value)});let f="";s.empty(this.item_unit)||(f=this.item_unit.value?this.item_unit.value:this.item_unit),s.fetchDataByToken("createItem",{id:this.id,item_name:this.item_name,item_short_description:this.item_short_description,item_description:this.item_description,item_price:this.item_price,item_unit:f,category_selected:t,item_featured:a,status:this.status.value?this.status.value:this.status,featured_filename:this.featured_filename,upload_path:this.upload_path,file_data:this.hadFeaturedData()?this.featured_data.data:"",image_type:this.hadFeaturedData()?this.featured_data.format:"",translation_data:this.translation_data}).then(d=>{s.notify(this.$q.dark.mode?"grey600":"light-green",d.msg,"check_circle",this.$q),this.$router.push("/menu?refresh=1")}).catch(d=>{s.notify("dark",d,"error",this.$q)}).then(d=>{this.loading=!1})},takePhoto(){this.$q.capacitor?D.isCameraEnabled().then(t=>{D.isFileAccessEnabled().then(a=>{D.getPhoto(1).then(f=>{this.featured_data=f}).catch(f=>{this.featured_data=[]})}).catch(a=>{s.notify("dark",a,"error",this.$q)})}).catch(t=>{s.notify("dark",t,"error",this.$q)}):this.upload_enabled=!this.upload_enabled},afterUploadfile(t){this.featured_filename=t.filename,this.featured_url=t.url_image,this.upload_path=t.upload_path},afterInput(t){this.translation_data=t},hadFeaturedData(){return Object.keys(this.featured_data).length>0},confirmDelete(){this.$refs.confirm_dialog.dialog=!0},afterConfirm(){this.$refs.confirm_dialog.dialog=!1,s.showLoadingBox("",this.$q),s.fetchDataByTokenPost("deleteItem","id="+this.id).then(t=>{this.$router.push("/menu?refresh=1")}).catch(t=>{s.notify("dark",t,"error",this.$q)}).then(t=>{s.hideLoadingBox(this.$q)})}}},Y={class:"row q-gutter-sm"},Z={class:"col"},K={class:"font12 line-normal"},W={class:"q-gutter-md"};function ee(t,a,f,d,i,n){const E=S("UploaderFile"),w=S("ItemTranslation"),P=S("ConfirmDialog");return m(),c(x,{onRefresh:n.refresh},{default:l(()=>[e(z,{class:q({"bg-mydark text-white":t.$q.dark.mode,"bg-white text-dark":!t.$q.dark.mode})},{default:l(()=>[e(O,null,{default:l(()=>[e(k,{onClick:a[0]||(a[0]=o=>t.$router.back()),flat:"",round:"",dense:"",icon:"las la-angle-left",color:t.$q.dark.mode?"white":"dark"},null,8,["color"]),e(B,{class:"text-weight-bold"},{default:l(()=>[n.isEdit?(m(),g(b,{key:0},[h(u(t.$t("Edit Items")),1)],64)):(m(),g(b,{key:1},[h(u(t.$t("Add Items")),1)],64))]),_:1}),d.AccessStore.hasAccess("food.item_delete")?(m(),g(b,{key:0},[n.isEdit&&!i.loading_get?(m(),c(k,{key:0,round:"",color:t.$q.dark.mode?"grey600":"mygrey","text-color":t.$q.dark.mode?"grey300":"dark",icon:"las la-trash",size:"sm",unelevated:"",onClick:n.confirmDelete},null,8,["color","text-color","onClick"])):y("",!0)],64)):y("",!0)]),_:1}),e(M)]),_:1},8,["class"]),e(G,{class:q([{"bg-mydark text-white":t.$q.dark.mode,"bg-white text-dark":!t.$q.dark.mode},"q-pa-md"])},{default:l(()=>[i.loading_get?(m(),c(L,{key:0,showing:!0,color:"primary",size:"md"})):(m(),c($,{key:1,onSubmit:n.onSubmit},{default:l(()=>[v("div",Y,[n.hasData?(m(),c(C,{key:0,src:i.featured_data.path,"spinner-color":"primary","spinner-size":"sm",fit:"cover",style:{height:"70px"},class:"col-3 radius8"},null,8,["src"])):n.hasPhoto?(m(),c(C,{key:1,src:this.featured_url,"spinner-color":"white",fit:"cover",style:{height:"70px"},class:"col-3 radius8"},null,8,["src"])):(m(),g("div",{key:2,class:q(["col-3 row items-center justify-center radius8",{"bg-grey600 ":t.$q.dark.mode,"bg-mygrey ":!t.$q.dark.mode}]),style:{height:"70px"}},[e(F,{name:"las la-image",class:"text-grey",size:"xl"})],2)),v("div",Z,[v("div",K,u(t.$t("Items with quality photos are often more popular. Maximum 2 MB"))+". "+u(t.$t("Accepted types: PNG. JPG")),1),e(k,{label:t.$t("Change Photo"),flat:"",color:"primary","no-caps":"",class:"q-pl-none q-pr-none",onClick:n.takePhoto},null,8,["label","onClick"])])]),i.upload_enabled?(m(),c(E,{key:0,ref:"uploader_file",onAfterUploadfile:n.afterUploadfile},null,8,["onAfterUploadfile"])):y("",!0),e(j,{class:"q-pa-xs"}),v("div",W,[e(I,{outlined:"",modelValue:i.item_name,"onUpdate:modelValue":a[1]||(a[1]=o=>i.item_name=o),label:t.$t("Name"),"stack-label":"",color:"grey-5","lazy-rules":"",rules:[o=>o&&o.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"]),e(I,{type:"textarea",outlined:"",modelValue:i.item_short_description,"onUpdate:modelValue":a[2]||(a[2]=o=>i.item_short_description=o),label:t.$t("Short Description"),"stack-label":"",color:"grey-5"},null,8,["modelValue","label"]),e(I,{type:"textarea",outlined:"",modelValue:i.item_description,"onUpdate:modelValue":a[3]||(a[3]=o=>i.item_description=o),label:t.$t("Long Description"),"stack-label":"",color:"grey-5"},null,8,["modelValue","label"]),n.isEdit?y("",!0):(m(),g(b,{key:0},[e(I,{type:"number",outlined:"",modelValue:i.item_price,"onUpdate:modelValue":a[4]||(a[4]=o=>i.item_price=o),label:t.$t("Price"),"stack-label":"",color:"grey-5","lazy-rules":""},null,8,["modelValue","label"]),e(Q,{outlined:"",modelValue:i.item_unit,"onUpdate:modelValue":a[5]||(a[5]=o=>i.item_unit=o),label:t.$t("Unit"),color:"grey-5",options:d.MenuStore.unit,"stack-label":"",behavior:"dialog","transition-show":"fade","transition-hide":"fade",loading:d.MenuStore.loading_category},null,8,["modelValue","label","options","loading"])],64)),e(Q,{outlined:"",modelValue:i.category_selected,"onUpdate:modelValue":a[6]||(a[6]=o=>i.category_selected=o),label:t.$t("Category"),color:"grey-5",options:d.MenuStore.category_list,multiple:"",behavior:"dialog","transition-show":"fade","transition-hide":"fade",loading:d.MenuStore.loading_category,rules:[o=>o&&o.length>0||this.$t("This field is required")],"options-html":""},null,8,["modelValue","label","options","loading","rules"]),e(Q,{outlined:"",modelValue:i.item_featured,"onUpdate:modelValue":a[7]||(a[7]=o=>i.item_featured=o),label:t.$t("Featured"),color:"grey-5",options:d.MenuStore.item_featured,multiple:"",behavior:"dialog","transition-show":"fade","transition-hide":"fade",loading:d.MenuStore.loading_category},null,8,["modelValue","label","options","loading"]),n.isEdit?(m(),c(N,{key:1,separator:""},{default:l(()=>[e(p,{clickable:"",to:{path:"/item/pricelist",query:{item_uuid:i.id}}},{default:l(()=>[e(r,null,{default:l(()=>[h(u(t.$t("Price")),1)]),_:1}),e(r,{side:""},{default:l(()=>[h(u(i.price_range),1)]),_:1}),e(r,{avatar:""},{default:l(()=>[e(_,{rounded:"","text-color":"dark",icon:"las la-angle-right"})]),_:1})]),_:1},8,["to"]),e(p,{clickable:"",to:{path:"/item/addonlist",query:{item_uuid:i.id}}},{default:l(()=>[e(r,null,{default:l(()=>[h(u(t.$t("Addon")),1)]),_:1}),e(r,{side:""},{default:l(()=>[h(u(i.total_addon),1)]),_:1}),e(r,{avatar:""},{default:l(()=>[e(_,{rounded:"","text-color":"dark",icon:"las la-angle-right"})]),_:1})]),_:1},8,["to"]),e(p,{clickable:"",to:{path:"/item/attributes",query:{item_uuid:i.id}}},{default:l(()=>[e(r,null,{default:l(()=>[h(u(t.$t("Attributes")),1)]),_:1}),e(r,{side:""}),e(r,{avatar:""},{default:l(()=>[e(_,{rounded:"","text-color":"dark",icon:"las la-angle-right"})]),_:1})]),_:1},8,["to"]),e(p,{clickable:"",to:{path:"/item/availability",query:{item_uuid:i.id}}},{default:l(()=>[e(r,null,{default:l(()=>[h(u(t.$t("Availability")),1)]),_:1}),e(r,{side:""}),e(r,{avatar:""},{default:l(()=>[e(_,{rounded:"","text-color":"dark",icon:"las la-angle-right"})]),_:1})]),_:1},8,["to"]),e(p,{clickable:"",to:{path:"/item/inventory",query:{item_uuid:i.id}}},{default:l(()=>[e(r,null,{default:l(()=>[h(u(t.$t("Item inventory")),1)]),_:1}),e(r,{side:""}),e(r,{avatar:""},{default:l(()=>[e(_,{rounded:"","text-color":"dark",icon:"las la-angle-right"})]),_:1})]),_:1},8,["to"]),e(p,{clickable:"",to:{path:"/item/promotionlist",query:{item_uuid:i.id}}},{default:l(()=>[e(r,null,{default:l(()=>[h(u(t.$t("Sales Promotion")),1)]),_:1}),e(r,{side:""}),e(r,{avatar:""},{default:l(()=>[e(_,{rounded:"","text-color":"dark",icon:"las la-angle-right"})]),_:1})]),_:1},8,["to"]),e(p,{clickable:"",to:{path:"/item/gallery",query:{item_uuid:i.id}}},{default:l(()=>[e(r,null,{default:l(()=>[h(u(t.$t("Item gallery")),1)]),_:1}),e(r,{side:""}),e(r,{avatar:""},{default:l(()=>[e(_,{rounded:"","text-color":"dark",icon:"las la-angle-right"})]),_:1})]),_:1},8,["to"]),e(p,{clickable:"",to:{path:"/item/seo",query:{item_uuid:i.id}}},{default:l(()=>[e(r,null,{default:l(()=>[h(u(t.$t("Item SEO")),1)]),_:1}),e(r,{side:""}),e(r,{avatar:""},{default:l(()=>[e(_,{rounded:"","text-color":"dark",icon:"las la-angle-right"})]),_:1})]),_:1},8,["to"])]),_:1})):y("",!0),e(Q,{outlined:"",modelValue:i.status,"onUpdate:modelValue":a[8]||(a[8]=o=>i.status=o),label:t.$t("Status"),color:"grey-5",options:d.DataStore.status_list,"stack-label":"",behavior:"dialog","transition-show":"fade","transition-hide":"fade"},null,8,["modelValue","label","options"]),e(w,{ref:"item_translation",fields:i.fields,update:n.isEdit,data:i.translation,onAfterInput:n.afterInput},null,8,["fields","update","data","onAfterInput"])]),e(R,{class:q(["q-pl-md q-pr-md q-pb-xs",{"bg-mydark ":t.$q.dark.mode,"bg-white ":!t.$q.dark.mode}])},{default:l(()=>[e(k,{type:"submit",color:"primary","text-color":"white",label:t.$t("Submit"),unelevated:"",class:"full-width radius8",size:"lg","no-caps":"",loading:i.loading},null,8,["label","loading"])]),_:1},8,["class"])]),_:1},8,["onSubmit"])),e(P,{ref:"confirm_dialog",data:d.DataStore.data_dialog,onAfterConfirm:n.afterConfirm},null,8,["data","onAfterConfirm"])]),_:1},8,["class"])]),_:1},8,["onRefresh"])}var Se=T(X,[["render",ee]]);export{Se as default};
