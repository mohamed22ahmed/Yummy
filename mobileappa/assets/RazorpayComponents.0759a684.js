import{Q as y}from"./QSpace.5a38bd33.js";import{_ as p,m as r,p as _,q as u,s,f as i,X as c,a8 as f,S as d,Y as h,b1 as g,bD as w,a7 as P,aA as z}from"./index.4c3eb750.js";import{Q as $}from"./QToolbar.45531803.js";import{l as m}from"./index.4f152a18.js";const b={name:"RazorpayComponents",props:["title","label","payment_code","payment_credentials"],data(){return{show_modal:!1,data:[],loading:!1,credentials:[],orders:[],jwt_data:[],force_amount:0,force_currency:""}},methods:{showPaymentForm(){this.show_modal=!0,this.setCredentials()},close(){this.show_modal=!1},closePayment(){this.$emit("afterCancelPayment")},setCredentials(){typeof this.payment_credentials[this.payment_code]!="undefined"&&this.payment_credentials[this.payment_code]!==null&&(this.credentials=this.payment_credentials[this.payment_code])},onSubmit(){const a={payment_code:this.payment_code,merchant_id:this.credentials.merchant_id,merchant_type:this.credentials.merchant_type};this.loading=!0,r.RazorpayCreateCustomer(a).then(t=>{this.close(),this.$emit("afterAddpayment")}).catch(t=>{r.notify("dark",t,"error",this.$q)}).then(t=>{this.loading=!1})},PaymentRender(a){this.data=a;const t={cart_uuid:a.cart_uuid,order_uuid:a.order_uuid,payment_code:a.payment_code,merchant_id:this.credentials.merchant_id,merchant_type:this.credentials.merchant_type};r.showLoadingBox("Getting payment information..<br/>don't close this window",this.$q),r.RazorpayCreateOrder(t).then(e=>{this.orders=e.details,this.initRazorPay()}).catch(e=>{r.notify("dark",e,"error",this.$q)}).then(e=>{r.hideLoadingBox(this.$q)})},initRazorPay(){m("https://checkout.razorpay.com/v1/checkout.js").then(()=>{this.initPayment()}).catch(()=>{r.notify("negative","failed loading script","error_outline",this.$q)})},initPayment(){try{const a={key:this.credentials.attr2,amount:this.orders.amount,currency:this.orders.currency,name:this.orders.name,description:this.orders.description,order_id:this.orders.order_id,customer_id:this.orders.customer_id,handler:e=>{this.verifyPayment(e)},theme:{color:"#3399cc"},modal:{ondismiss:e=>{this.closePayment()}}},t=new Razorpay(a);t.on("payment.failed",e=>{}),t.open()}catch(a){r.notify("dark",a,"error",this.$q)}},verifyPayment(a){this.setCredentials();var t={cart_uuid:this.data.cart_uuid,order_uuid:this.data.order_uuid,payment_code:this.data.payment_code,merchant_id:this.credentials.merchant_id,merchant_type:this.credentials.merchant_type,razorpay_payment_id:a.razorpay_payment_id,razorpay_order_id:a.razorpay_order_id,razorpay_signature:a.razorpay_signature};r.showLoadingBox("Processing payment..<br/>don't close this window",this.$q),r.RazorpayVerifyPayment(t).then(e=>{this.$emit("afterPayment",e.details)}).catch(e=>{r.notify("dark",e,"error",this.$q)}).then(e=>{r.hideLoadingBox(this.$q)})},Dopayment(a,t){this.jwt_data=a,this.force_amount=t.amount,this.force_currency=t.currency_code,this.setCredentials(),r.showLoadingBox(this.$t("Processing payment")+"<br/>"+this.$t("don't close this window"),this.$q),r.fetchDataByTokenPostPayment("Razorpaycreateneworder",{data:a}).then(e=>{this.orders=e.details,this.RazorPayinit()}).catch(e=>{this.$emit("afterCancelPayment",e)}).then(e=>{r.hideLoadingBox(this.$q)})},RazorPayinit(){m("https://checkout.razorpay.com/v1/checkout.js").then(()=>{this.Paymentinit()}).catch(()=>{r.notify("negative","failed loading script","error_outline",this.$q)})},Paymentinit(){try{let t={key:this.credentials.attr2,amount:this.orders.amount,currency:this.orders.currency,name:this.orders.name,description:this.orders.description,order_id:this.orders.order_id,customer_id:this.orders.customer_id,handler:e=>{this.processPayment(e)},theme:{color:"#3399cc"},modal:{ondismiss:e=>{this.closePayment()}}};var a=new Razorpay(t);a.on("payment.failed",e=>{}),this.$emit("closeLoader"),a.open()}catch(t){this.$emit("afterCancelPayment",t.message)}},processPayment(a){r.showLoadingBox(this.$t("Processing payment")+"<br/>"+this.$t("don't close this window"),this.$q),r.fetchDataByTokenPostPayment("Razorpayprocesspayment",{data:this.jwt_data,razorpay_payment_id:a.razorpay_payment_id,razorpay_order_id:a.razorpay_order_id,razorpay_signature:a.razorpay_signature}).then(t=>{this.$emit("afterSuccessfulpayment",t.details)}).catch(t=>{this.$emit("afterCancelPayment",t)}).then(t=>{r.hideLoadingBox(this.$q)})}}},q={class:"text-weight-bold no-margin"},x={class:"q-ma-sm"},C={class:"font12"};function k(a,t,e,v,o,l){return _(),u(z,{modelValue:o.show_modal,"onUpdate:modelValue":t[2]||(t[2]=n=>o.show_modal=n),persistent:"","transition-show":"fade","transition-hide":"fade"},{default:s(()=>[i(P,{style:{width:"500px","max-width":"80vw"}},{default:s(()=>[i($,{class:"text-primary top-toolbar q-pl-md",dense:""},{default:s(()=>[i(y),i(c,{onClick:t[0]||(t[0]=n=>o.show_modal=!1),color:"white",square:"",unelevated:"","text-color":"grey",icon:"las la-times",dense:"","no-caps":"",size:"sm",class:"border-grey radius8"})]),_:1}),i(f,{class:"q-pa-md"},{default:s(()=>[d("h5",q,h(e.title),1),d("div",x,[d("p",C,h(e.label.notes),1)])]),_:1}),i(g,{spaced:""}),i(w,null,{default:s(()=>[i(c,{label:e.label.submit,loading:o.loading,onClick:t[1]||(t[1]=n=>l.onSubmit()),unelevated:"","no-caps":"",color:"primary text-white",class:"full-width text-weight-bold",size:"lg"},null,8,["label","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var S=p(b,[["render",k]]);export{S as default};
