import{Q as P}from"./QToolbarTitle.eef0f00f.js";import{Q as k}from"./QSpace.5a38bd33.js";import{_ as w,R as S,m as l,p as m,q as u,s as t,f as a,a6 as Q,a5 as n,Y as i,X as h,a8 as v,S as p,aX as q,az as $,U as C,V,a9 as A,aa as z,ab as D,aE as f,ac as g,F as B,a7 as I,aA as L}from"./index.4c3eb750.js";import{Q as U}from"./QToolbar.45531803.js";import{Q as N}from"./QForm.ce1b13be.js";import{Q as _}from"./QItemLabel.cc035d74.js";import{Q as T}from"./QList.5b181e45.js";import{u as E}from"./PromoStore.17dab00f.js";const F={name:"PromoList",props:["merchant_id","enabled_voucher"],data(){return{promo_code:"",show_modal:!1,loading_apply:!1,loading:!1}},setup(){const o=E(),e=S();return{PromoStore:o,DataStorePersisted:e}},updated(){this.promo_code=""},created(){this.PromoStore.loadPromo(this.merchant_id)},methods:{showModal(o){this.show_modal=o},usePromo(o){this.loading=!0;const e={cart_uuid:l.getStorage("cart_uuid"),promo_id:o.promo_id,promo_type:o.promo_type,currency_code:this.DataStorePersisted.getUseCurrency()};l.applyPromo(e).then(s=>{this.show_modal=!1,this.PromoStore.loadPromo(this.merchant_id),this.$emit("afterApplypromo")}).catch(s=>{l.notify("dark",s,"error",this.$q)}).then(s=>{this.loading=!1})},removePromo(o){this.loading=!0;const e={cart_uuid:l.getStorage("cart_uuid"),promo_id:o.promo_id,promo_type:o.promo_type};l.removePromo(e).then(s=>{this.show_modal=!1,this.promo_selected=[],this.PromoStore.loadPromo(this.merchant_id),this.$emit("afterRemovepromo")}).catch(s=>{l.notify("dark",s,"error",this.$q)}).then(s=>{this.loading=!1})},onApplyPromocode(){this.loading_apply=!0;const o={cart_uuid:l.getStorage("cart_uuid"),promo_code:this.promo_code};l.applyPromoCode(o).then(e=>{this.show_modal=!1,this.promo_code="",this.PromoStore.loadPromo(this.merchant_id),this.$emit("afterApplypromo")}).catch(e=>{l.notify("dark",e,"error",this.$q)}).then(e=>{this.loading_apply=!1})}}},R={class:"row items-center q-col-gutter-sm"},x={class:"col b"},M={class:"col-4"},X={class:"text-weight-bold q-ma-none q-pt-md"};function Y(o,e,s,y,d,c){return m(),u(L,{modelValue:d.show_modal,"onUpdate:modelValue":e[2]||(e[2]=r=>d.show_modal=r),position:"bottom"},{default:t(()=>[a(I,null,{default:t(()=>[a(U,{class:"text-primary top-toolbar q-pl-md",dense:""},{default:t(()=>[a(P,{class:Q(["text-weight-bold",{"text-white":o.$q.dark.mode,"text-dark":!o.$q.dark.mode}])},{default:t(()=>[n(i(o.$t("Add a promo")),1)]),_:1},8,["class"]),a(k),a(h,{onClick:e[0]||(e[0]=r=>d.show_modal=!1),color:"white",square:"",unelevated:"","text-color":"grey",icon:"las la-times",dense:"","no-caps":"",size:"sm",class:"border-grey radius8"})]),_:1}),s.enabled_voucher==1?(m(),u(v,{key:0},{default:t(()=>[a(N,{onSubmit:c.onApplyPromocode},{default:t(()=>[p("div",R,[p("div",x,[a(q,{modelValue:d.promo_code,"onUpdate:modelValue":e[1]||(e[1]=r=>d.promo_code=r),label:o.$t("Enter promo code"),outlined:"","lazy-rules":"","bg-color":o.$q.dark.mode?"grey600":"input","label-color":o.$q.dark.mode?"grey300":"grey",borderless:"",class:"input-borderless"},null,8,["modelValue","label","bg-color","label-color"])]),p("div",M,[a(h,{loading:d.loading_apply,type:"submit",unelevated:"",color:"primary","text-color":"white","no-caps":"",class:"full-width",label:o.$t("Apply"),size:"lg"},null,8,["loading","label"])])])]),_:1},8,["onSubmit"]),p("h6",X,i(o.$t("Available promotions")),1)]),_:1})):$("",!0),a(T,{separator:""},{default:t(()=>[(m(!0),C(B,null,V(y.PromoStore.data[s.merchant_id],r=>A((m(),u(D,{key:r.promo_id,clickable:"",class:"q-mb-sm",onClick:f(b=>c.usePromo(r),["stop"])},{default:t(()=>[a(g,null,{default:t(()=>[a(_,null,{default:t(()=>[n(i(r.title),1)]),_:2},1024),a(_,{caption:"",class:"font11"},{default:t(()=>[n(i(r.sub_title),1)]),_:2},1024),a(_,{caption:"",class:"font11"},{default:t(()=>[n(i(r.valid_to),1)]),_:2},1024)]),_:2},1024),a(g,{side:""},{default:t(()=>[a(h,{onClick:f(b=>c.usePromo(r),["stop"]),loading:d.loading,flat:"",color:o.$q.dark.mode?"secondary":"blue","no-caps":"",label:o.$t("Use now"),dense:"",size:"md"},null,8,["onClick","loading","color","label"])]),_:2},1024)]),_:2},1032,["onClick"])),[[z]])),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])}var oo=w(F,[["render",Y]]);export{oo as default};
