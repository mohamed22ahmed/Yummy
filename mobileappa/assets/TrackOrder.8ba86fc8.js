import{m as h,_ as M,l as O,Q as N,av as H,n as P,p as s,U as c,q as m,s as a,a6 as y,az as d,f as o,F as _,X as q,a5 as R,Y as p,S as k,ab as X,ac as w,ad as Y,t as V}from"./index.4c3eb750.js";import{Q as j}from"./QToolbarTitle.eef0f00f.js";import{Q as G}from"./QToolbar.45531803.js";import{Q as J}from"./QHeader.d51d9950.js";import{Q as K}from"./QInnerLoading.488297dd.js";import{Q as T}from"./QLinearProgress.a759e3ee.js";import{Q as u,a as z}from"./QStepper.4e541993.js";import{Q as W}from"./QImg.721b5b7a.js";import{Q as A}from"./QItemLabel.cc035d74.js";import{Q as Z}from"./QList.5b181e45.js";import{Q as U}from"./QFooter.bd11e2a3.js";import{Q as $}from"./QPage.959871c7.js";import{s as v,a as x,d as E,f as Q,b as C,c as B,q as ee,w as re,o as oe,l as te,g as se,e as ae}from"./FirebaseChat.bc197042.js";import"./QResizeObserver.4d611c44.js";import"./QSlideTransition.1b723af0.js";import"./use-panel.c764e2a6.js";import"./touch.9135741d.js";import"./selection.1ed6461a.js";import"./use-render-cache.3aae9b27.js";const ie={async createChatOrder(e,t,b,i){return await new Promise(async function(n,f){try{const l={lastUpdated:v(),dateCreated:v(),orderID:e,orderUuid:t,participants:[b,i],isTyping:{[`${b}`]:!1,[`${i}`]:!1}};await x(E(Q,C.chats,t),l),n(t)}catch(l){f(l)}})},async createChat(e,t){return await new Promise(async function(i,r){try{const n=B(Q,C.chats),f=ee(n,re("participants","array-contains",t),oe("lastUpdated","desc"),te(1));let l="";if((await se(f)).forEach(S=>{(S.data().participants||null).includes(e)===!0&&(l=S.id)}),!h.empty(l))i(l);else{const F=(await ae(B(Q,C.chats),{lastUpdated:v()})).id,D=E(Q,C.chats,F);let I={lastUpdated:v(),dateCreated:v(),participants:[t,e],isTyping:{[`${t}`]:!1,[`${e}`]:!1}};x(D,I).then(()=>{i(F)}).catch(L=>{r(L)})}}catch(n){r(n)}})}},ne={name:"TrackOrder",components:{MapsComponents:O(()=>V(()=>import("./MapsComponents.48bedb97.js"),["assets/MapsComponents.48bedb97.js","assets/index.4c3eb750.js","assets/index.4784a50d.css","assets/index.4f152a18.js"])),ComponentsRealtime:O(()=>V(()=>import("./ComponentsRealtime.4673ec21.js"),["assets/ComponentsRealtime.4673ec21.js","assets/index.4f152a18.js","assets/index.4c3eb750.js","assets/index.4784a50d.css"]))},data(){return{order_progress:-1,order_details:!0,loading:!1,order_uuid:"",lat:"",lng:"",merchant_info:[],order_info:[],items:[],meta:[],items_count:0,order_status:"",order_status_details:"",instructions:[],map_marker:{},map_center:{},loading_chat:!1,user_uuid:""}},setup(){return{DataStore:N()}},mounted(){this.order_uuid=this.$route.query.order_uuid;let e=H.getUser();this.user_uuid=e.client_uuid,this.getOrder()},computed:{hasMarkers(){return Object.keys(this.map_marker).length>0}},methods:{getOrder(){this.loading=!0,h.getOrder(this.order_uuid).then(e=>{this.merchant_info=e.details.merchant_info,this.order_info=e.details.order_info,this.items=e.details.items,this.meta=e.details.meta,this.items_count=e.details.items_count,this.order_progress=e.details.progress.order_progress,this.order_status=e.details.progress.order_status,this.order_status_details=e.details.progress.order_status_details,this.instructions=e.details.instructions,this.order_info.order_type==="delivery"?(this.map_center={lat:parseFloat(this.merchant_info.latitude),lng:parseFloat(this.merchant_info.longitude)},this.map_marker=[{lat:parseFloat(this.merchant_info.latitude),lng:parseFloat(this.merchant_info.longitude),label:h.getIcon("merchant"),icon:"marker_icon_merchant",draggable:!1},{lat:parseFloat(this.meta.latitude),lng:parseFloat(this.meta.longitude),label:h.getIcon("customer"),icon:"marker_icon_destination",draggable:!1}]):(this.map_marker=[{lat:parseFloat(this.merchant_info.latitude),lng:parseFloat(this.merchant_info.longitude),label:h.getIcon("merchant"),icon:"marker_icon_merchant",draggable:!1}],this.map_center={lat:parseFloat(this.merchant_info.latitude),lng:parseFloat(this.merchant_info.longitude)})}).catch(e=>{h.notify("red-5",e,"error_outline",this.$q)}).then(e=>{this.loading=!1})},afterReceive(e){if(e.order_id!==this.order_info.order_id)return!1;e.order_progress===0?(this.order_progress=e.order_progress,this.order_status=e.order_status,this.order_status_details=e.order_status_details):e.order_progress===-1||(this.order_progress=e.order_progress,this.order_status=e.order_status,this.order_status_details=e.order_status_details)},async createChat(){this.loading_chat=!0,ie.createChatOrder(this.order_info.order_id,this.order_uuid,this.merchant_info.merchant_uuid,this.user_uuid).then(e=>{this.$router.push({path:"/account/chat/conversation",query:{doc_id:e}})}).catch(e=>{h.notify("dark",e,"error",this.$q)}).then(e=>{this.loading_chat=!1})}}},le={class:"col-12"},de={key:0,class:"absolute-top-left full-width q-pa-sm",style:{"z-index":"999"}},ce={class:"flex"},me={class:"bg-white radius8 q-pl-sm q-pr-sm"};function pe(e,t,b,i,r,n){const f=P("MapsComponents"),l=P("ComponentsRealtime");return s(),c(_,null,[e.$q.platform.is.ios?(s(),m(J,{key:0,class:y({"bg-mydark text-white":e.$q.dark.mode,"bg-white text-black":!e.$q.dark.mode})},{default:a(()=>[o(G,null,{default:a(()=>[o(q,{onClick:t[0]||(t[0]=g=>e.$router.back()),flat:"",round:"",dense:"",icon:"close",class:"q-mr-sm",color:e.$q.dark.mode?"white":"dark"},null,8,["color"]),o(j,{class:"text-weight-bold"},{default:a(()=>[R(p(e.$t("Order #"))+p(r.order_info.order_id),1)]),_:1})]),_:1})]),_:1},8,["class"])):d("",!0),o($,{class:y(["row items-stretch",{"bg-mydark ":e.$q.dark.mode,"bg-grey-1 ":!e.$q.dark.mode}])},{default:a(()=>[r.loading?(s(),m(K,{key:0,showing:!0,size:"md",color:"primary"})):(s(),c(_,{key:1},[k("div",le,[e.$q.platform.is.ios?d("",!0):(s(),c("div",de,[k("div",ce,[o(q,{onClick:t[1]||(t[1]=g=>e.$router.back()),round:"",dense:"",icon:"close",class:"q-mr-sm",color:e.$q.dark.mode?"white":"dark",unelevated:"",size:"sm"},null,8,["color"]),k("div",me,p(e.$t("Order #"))+p(r.order_info.order_id),1)])])),!r.loading&&n.hasMarkers?(s(),c(_,{key:1},[i.DataStore.hasMapConfig?(s(),m(f,{key:0,ref:"mapRef",class:"maps",size:"fit",keys:i.DataStore.maps_config.key,provider:i.DataStore.maps_config.provider,zoom:i.DataStore.maps_config.zoom,center:r.map_center,markers:r.map_marker,onAfterSelectmap:e.afterSelectmap},null,8,["keys","provider","zoom","center","markers","onAfterSelectmap"])):d("",!0)],64)):d("",!0)]),o(U,{reveal:"",class:"bg-white q-pl-md q-pr-md q-pt-md text-dark",style:{"border-top-right-radius":"15px","border-top-left-radius":"15px",bottom:"10px"}},{default:a(()=>[r.order_info.order_type=="delivery"?(s(),c(_,{key:0},[r.order_progress>0?(s(),c(_,{key:0},[r.order_progress<=3?(s(),m(T,{key:0,indeterminate:"",color:"secondary"})):d("",!0)],64)):d("",!0)],64)):(s(),c(_,{key:1},[r.order_progress>0?(s(),c(_,{key:0},[r.order_progress<=2?(s(),m(T,{key:0,indeterminate:"",color:"warning"})):d("",!0)],64)):d("",!0)],64)),k("h5",{class:y(["text-weight-bold q-mt-sm q-mb-none",{"text-white":e.$q.dark.mode,"text-dark":!e.$q.dark.mode}])},p(r.order_status),3),k("p",{class:y(["no-margin font11",{"text-white":e.$q.dark.mode,"text-dark":!e.$q.dark.mode}])},p(r.order_status_details),3),r.order_info.order_type=="delivery"?(s(),m(z,{key:2,modelValue:r.order_progress,"onUpdate:modelValue":t[2]||(t[2]=g=>r.order_progress=g),ref:"stepper",color:"primary",animated:"",flat:"",class:y(["no-padding tracking-steps",{"bg-mydark text-white":e.$q.dark.mode,"bg-white text-black":!e.$q.dark.mode}])},{default:a(()=>[o(u,{name:1,title:"",icon:"east","active-icon":"east","done-icon":"east","active-color":"primary","done-color":r.order_progress>1?"primary":"negative",done:r.order_progress>1||r.order_progress<=0},null,8,["done-color","done"]),o(u,{name:2,title:"",icon:"local_dining","active-icon":"local_dining","done-icon":"local_dining","active-color":"primary","done-color":r.order_progress>1?"primary":"negative",done:r.order_progress>2||r.order_progress<=0},null,8,["done-color","done"]),o(u,{name:3,title:"",icon:"drive_eta","active-icon":"drive_eta","done-icon":"drive_eta","active-color":"primary","done-color":r.order_progress>1?"primary":"negative",done:r.order_progress>3||r.order_progress<=0},null,8,["done-color","done"]),o(u,{name:4,title:"",icon:"home","active-icon":"home","done-icon":"check_circle","active-color":"primary","done-color":r.order_progress>1?"primary":"negative",done:r.order_progress>=4||r.order_progress<=0},null,8,["done-color","done"])]),_:1},8,["modelValue","class"])):(s(),m(z,{key:3,modelValue:r.order_progress,"onUpdate:modelValue":t[3]||(t[3]=g=>r.order_progress=g),ref:"stepper",color:"primary",animated:"",flat:"",class:"no-padding tracking-steps"},{default:a(()=>[o(u,{name:1,title:"",icon:"east","active-icon":"east","done-icon":"east","active-color":"primary","done-color":r.order_progress>1?"primary":"negative",done:r.order_progress>1||r.order_progress<=0},null,8,["done-color","done"]),o(u,{name:2,title:"",icon:"local_dining","active-icon":"local_dining","done-icon":"local_dining","active-color":"primary","done-color":r.order_progress>1?"primary":"negative",done:r.order_progress>2||r.order_progress<=0},null,8,["done-color","done"]),o(u,{name:3,title:"",icon:"shopping_basket","active-icon":"shopping_basket","done-icon":"check_circle","active-color":"primary","done-color":r.order_progress>1?"primary":"negative",done:r.order_progress>=3||r.order_progress<=0},null,8,["done-color","done"])]),_:1},8,["modelValue"])),o(Z,{class:"q-mb-sm q-mt-sm"},{default:a(()=>[o(X,{clickable:""},{default:a(()=>[o(w,{avatar:""},{default:a(()=>[o(Y,null,{default:a(()=>[o(W,{src:r.merchant_info.url_logo,fit:e.contain,style:{height:"50px","max-width":"50px"},class:"no-margin",loading:"lazy"},null,8,["src","fit"])]),_:1})]),_:1}),o(w,null,{default:a(()=>[o(A,{lines:"1",class:"text-weight-bold"},{default:a(()=>[R(p(r.merchant_info.restaurant_name),1)]),_:1}),o(A,{caption:"",lines:"2",class:"font11"},{default:a(()=>[R(p(r.merchant_info.merchant_address),1)]),_:1})]),_:1}),o(w,{side:""},{default:a(()=>[o(q,{square:"",color:"secondary",unelevated:"","text-color":"white",icon:"las la-phone",dense:"",class:"radius8",href:"tel:"+r.merchant_info.contact_phone},null,8,["href"])]),_:1}),i.DataStore.chat_enabled?(s(),m(w,{key:0,side:""},{default:a(()=>[o(q,{square:"",color:"blue",unelevated:"","text-color":"white",icon:"o_chat",dense:"",class:"radius8",onClick:n.createChat,loading:r.loading_chat},null,8,["onClick","loading"])]),_:1})):d("",!0)]),_:1})]),_:1})]),_:1})],64))]),_:1},8,["class"]),o(l,{ref:"realtime",getevent:"tracking",onAfterReceive:n.afterReceive},null,8,["onAfterReceive"])],64)}var Ve=M(ne,[["render",pe]]);export{Ve as default};
