import{_ as w,l as v,t as b,av as q,m as n,n as k,p as i,q as p,s as h,f as o,aX as D,as as _,a9 as U,X as Q,a8 as V,U as u,a5 as B,Y as f,S as T,az as m,a0 as x,F as O,a7 as R,aA as E}from"./index.4c3eb750.js";import{Q as I}from"./QSpace.5a38bd33.js";import{Q as N}from"./QToolbar.45531803.js";import{C as z}from"./ClosePopup.d9033651.js";import{c as S,f as g,b as y,q as A,w as L,o as P,l as F,g as X,e as j,s as C,d as H,a as Y}from"./FirebaseChat.bc197042.js";const $={name:"ChatSearch",components:{ChatUserList:v(()=>b(()=>import("./ChatUserList.134d287f.js"),["assets/ChatUserList.134d287f.js","assets/QItemLabel.cc035d74.js","assets/index.4c3eb750.js","assets/index.4784a50d.css","assets/QList.5b181e45.js"]))},data(){return{dialog:!1,search:"",is_search:!1,awaitingSearch:!1,search_type:["merchant","admin"],data:[],loading:!0,suggested_data:[],main_user_uuid:""}},mounted(){let e=q.getUser();this.main_user_uuid=e.client_uuid,this.getSuggestedUser()},computed:{hasSearch(){return!n.empty(this.search)},hasData(){return Object.keys(this.data).length>0},getData(){return this.data}},watch:{search(e,a){if(!this.awaitingSearch){if(n.empty(e))return!1;setTimeout(()=>{n.fetchDataChats("searchChats",{search:this.search,search_type:this.search_type}).then(r=>{this.data=r.details}).catch(r=>{this.data=[]}).then(r=>{this.awaitingSearch=!1})},1e3),this.awaitingSearch=!0}}},methods:{whenClear(){this.data=[]},getSuggestedUser(){this.loading=!0,n.fetchDataChats("suggestedUser",{search_type:this.search_type}).then(e=>{this.suggested_data=e.details}).catch(e=>{this.suggested_data=[]}).then(e=>{this.loading=!1})},async onChatuser(e){try{const a=S(g,y.chats),r=A(a,L("participants","array-contains",e),P("lastUpdated","desc"),F(1));let l="";(await X(r)).forEach(s=>{(s.data().participants||null).includes(this.main_user_uuid)===!0&&(l=s.id)}),n.empty(l)?this.createConversation(e):this.loadConversation(l)}catch(a){n.notify("dark",a,"error",this.$q)}},async createConversation(e){try{const r=(await j(S(g,y.chats),{lastUpdated:C()})).id,l=H(g,y.chats,r);let t=this.main_user_uuid,s={lastUpdated:C(),dateCreated:C(),participants:[e,t],isTyping:{[`${e}`]:!1,[`${t}`]:!1}};Y(l,s).then(()=>{this.loadConversation(r)}).catch(d=>{n.notify("dark",d,"error",this.$q)})}catch(a){n.notify("dark",a,"error",this.$q)}},loadConversation(e){this.$router.push({path:"/account/chat/conversation",query:{doc_id:e}})}}},G={key:0,class:"text-body2 text-weight-regular q-mb-md"},J={class:"text-weight-bold"},K={key:1,class:"text-center q-pa-xl"},M={key:0,class:"text-body2 text-center q-pa-xl"};function W(e,a,r,l,t,s){const d=k("ChatUserList");return i(),p(E,{modelValue:t.dialog,"onUpdate:modelValue":a[1]||(a[1]=c=>t.dialog=c),persistent:"",maximized:!0,"transition-show":"fade","transition-hide":"fade",onBeforeShow:a[2]||(a[2]=c=>t.search=""),onBeforeHide:a[3]||(a[3]=c=>t.data=[])},{default:h(()=>[o(R,null,{default:h(()=>[o(N,{class:"q-pl-md q-pr-md q-pt-sm"},{default:h(()=>[o(D,{outlined:"",modelValue:t.search,"onUpdate:modelValue":a[0]||(a[0]=c=>t.search=c),label:e.$t("Search restaurants"),dense:"",color:e.$q.dark.mode?"grey600":"blue","bg-color":e.$q.dark.mode?"grey300":"grey-1",class:"radius10",clearable:"","clear-icon":"close",onClear:s.whenClear},{prepend:h(()=>[o(_,{name:"search"})]),_:1},8,["modelValue","label","color","bg-color","onClear"]),o(I),U(o(Q,{flat:"",dense:"",label:e.$t("Cancel"),"no-caps":"",color:e.$q.dark.mode?"grey300":"blue"},null,8,["label","color"]),[[z]])]),_:1}),o(V,null,{default:h(()=>[s.hasSearch?(i(),u("div",G,[o(_,{name:"search",size:"2em"}),B(f(e.$t("Search for"))+" ",1),T("span",J,f(t.search),1)])):m("",!0),t.awaitingSearch?(i(),u("div",K,[o(x,{color:"primary",size:"2em"})])):m("",!0)]),_:1}),s.hasData&&!t.awaitingSearch?(i(),p(d,{key:0,data:t.data,onOnChatuser:s.onChatuser},null,8,["data","onOnChatuser"])):(i(),u(O,{key:1},[s.hasSearch&&!t.awaitingSearch?(i(),u("div",M,f(e.$t("No matching records found")),1)):m("",!0)],64)),s.hasSearch?m("",!0):(i(),p(d,{key:2,data:t.suggested_data,headerTitle:e.$t("Suggested Restaurants"),onOnChatuser:s.onChatuser},null,8,["data","headerTitle","onOnChatuser"]))]),_:1})]),_:1},8,["modelValue"])}var re=w($,[["render",W]]);export{re as default};
