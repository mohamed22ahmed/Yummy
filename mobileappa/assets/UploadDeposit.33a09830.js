import{_ as $,bB as D,av as w,m as n,p as d,U as b,f as a,s as o,a6 as y,F as T,X as m,a5 as u,Y as s,q as g,az as p,a8 as U,S as h,ab as q,ac as f,aX as _,a7 as v}from"./index.4c3eb750.js";import{Q as V}from"./QToolbarTitle.eef0f00f.js";import{Q as B}from"./QToolbar.45531803.js";import{Q as P}from"./QHeader.d51d9950.js";import{Q as C}from"./QInnerLoading.488297dd.js";import{Q as S}from"./QList.5b181e45.js";import{Q}from"./QSpace.5a38bd33.js";import{Q as z}from"./QUploader.0f1aff9c.js";import{Q as F}from"./QForm.ce1b13be.js";import{Q as A}from"./QPage.959871c7.js";import{A as k}from"./AppCamera.1658e309.js";import"./QResizeObserver.4d611c44.js";import"./QCircularProgress.ba57a6e8.js";import"./format.8ac60962.js";import"./vue-i18n.runtime.esm-bundler.b784e096.js";const j={name:"UploadDeposit",data(){return{loading:!1,loading_submit:!1,order_uuid:"",account_name:"",amount:0,reference_number:"",order_info:[],upload_api:D.api_base_url+"/interface/uploadProofPayment",photo_data:"",upload_enabled:!1,filename:"",url_image:""}},created(){this.order_uuid=this.$route.query.order_uuid,this.getBankDeposit()},computed:{hasData(){return Object.keys(this.order_info).length>0}},methods:{getToken(){return w.getToken()},getBankDeposit(){this.loading=!0,n.fetchDataByTokenPost("getBankDeposit","order_uuid="+this.order_uuid).then(e=>{this.order_info=e.details.order_info,Object.keys(e.details).length>0&&(this.account_name=e.details.data.account_name,this.amount=e.details.data.amount,this.reference_number=e.details.data.reference_number)}).catch(e=>{}).then(e=>{this.loading=!1})},takePhoto(){this.$q.capacitor?k.isCameraEnabled().then(e=>{k.isFileAccessEnabled().then(t=>{k.getPhoto(1).then(c=>{this.photo_data=c}).catch(c=>{this.photo_data=[]})}).catch(t=>{this.$q.platform.is.ios&&(this.upload_enabled=!this.upload_enabled)})}).catch(e=>{this.$q.platform.is.ios&&(this.upload_enabled=!this.upload_enabled)}):this.upload_enabled=!this.upload_enabled},afterUploaded(e){const t=JSON.parse(e.xhr.responseText);t.code===1?(this.url_image=t.details.url_image,this.filename=t.details.filename):(this.url_image="",this.filename="",n.notify("dark",t.msg,"error",this.$q))},onSubmit(){this.loading_submit=!0,n.fetchDataByTokenPost("uploadBankDeposit","order_uuid="+this.order_uuid+"&account_name="+this.account_name+"&amount="+this.amount+"&reference_number="+this.reference_number+"&filename="+this.filename+"&file_data="+this.getFileData()+"&image_type="+this.getFileType()).then(e=>{n.notify("green-5",e.msg,"check_circle",this.$q),this.$router.push("/account/allorder")}).catch(e=>{n.notify("dark",e,"error",this.$q)}).then(e=>{this.loading_submit=!1})},getFileData(){return this.hadData()?this.photo_data.data:""},getFileType(){return this.hadData()?this.photo_data.format:""},hadData(){return Object.keys(this.photo_data).length>0}}},N={key:1,class:"q-gutter-sm bg-grey-2 q-pa-sm"},I={class:"text-right"},O={key:2},R={class:"text-grey"};function E(e,t,c,L,l,i){return d(),b(T,null,[a(P,{reveal:"","reveal-offset":"50",class:y(["",{"bg-mydark text-white":e.$q.dark.mode,"bg-grey-1 text-dark":!e.$q.dark.mode}])},{default:o(()=>[a(B,null,{default:o(()=>[a(m,{onClick:t[0]||(t[0]=r=>e.$router.back()),flat:"",round:"",dense:"",icon:"las la-angle-left",class:"q-mr-sm",color:e.$q.dark.mode?"white":"dark"},null,8,["color"]),a(V,{class:"text-weight-bold"},{default:o(()=>[u(s(e.$t("Upload Proof of Payment")),1)]),_:1})]),_:1})]),_:1},8,["class"]),a(A,{class:y(["q-pl-md q-pr-md q-pb-md",{"bg-mydark text-white":e.$q.dark.mode,"bg-grey-1 text-dark":!e.$q.dark.mode,"flex flex-center":!l.loading&&!i.hasData}])},{default:o(()=>[l.loading?(d(),g(C,{key:0,showing:!0,color:"primary",size:"md","label-class":"dark",class:"transparent"})):p("",!0),!l.loading&&i.hasData?(d(),g(v,{key:1,flat:"",class:"radius8"},{default:o(()=>[a(U,{class:"q-pb-none"},{default:o(()=>[h("p",null,s(e.$t("Please enter the details of your bank deposit payment below"))+". ",1),h("p",null,s(e.$t("Failure to provide accurate information may cause delays in processing or invalidation of your payment")),1)]),_:1}),a(S,{dense:""},{default:o(()=>[a(q,null,{default:o(()=>[a(f,null,{default:o(()=>[u(s(e.$t("Order #"))+": ",1)]),_:1}),a(f,{class:"text-weight-bold"},{default:o(()=>[u(s(l.order_info.order_id),1)]),_:1})]),_:1}),a(q,null,{default:o(()=>[a(f,null,{default:o(()=>[u(s(e.$t("Amount"))+": ",1)]),_:1}),a(f,{class:"text-weight-bold"},{default:o(()=>[u(s(l.order_info.total),1)]),_:1})]),_:1})]),_:1}),a(F,{onSubmit:i.onSubmit,class:"q-pl-md q-pr-md q-pb-md"},{default:o(()=>[a(_,{modelValue:l.account_name,"onUpdate:modelValue":t[1]||(t[1]=r=>l.account_name=r),label:e.$t("Account name"),outlined:"","lazy-rules":"","bg-color":e.$q.dark.mode?"grey600":"input","label-color":e.$q.dark.mode?"grey300":"grey",borderless:"",class:"input-borderless",rules:[r=>r&&r.length>0||this.$t("This field is required")]},null,8,["modelValue","label","bg-color","label-color","rules"]),a(_,{modelValue:l.amount,"onUpdate:modelValue":t[2]||(t[2]=r=>l.amount=r),label:e.$t("Amount"),outlined:"","lazy-rules":"","bg-color":e.$q.dark.mode?"grey600":"input","label-color":e.$q.dark.mode?"grey300":"grey",borderless:"",class:"input-borderless",rules:[r=>r&&r.length>0||this.$t("This field is required")]},null,8,["modelValue","label","bg-color","label-color","rules"]),a(_,{modelValue:l.reference_number,"onUpdate:modelValue":t[3]||(t[3]=r=>l.reference_number=r),label:e.$t("Reference Number"),outlined:"","bg-color":e.$q.dark.mode?"grey600":"input","label-color":e.$q.dark.mode?"grey300":"grey",borderless:"",class:"input-borderless"},null,8,["modelValue","label","bg-color","label-color"]),a(Q,{class:"q-pa-sm"}),l.upload_enabled?p("",!0):(d(),g(m,{key:0,icon:"upload_file",flat:"",color:"grey",label:e.$t("Upload Deposit"),"no-caps":"",size:"lg",onClick:i.takePhoto},null,8,["label","onClick"])),l.upload_enabled?(d(),b("div",N,[h("div",I,[a(m,{round:"",color:"grey",icon:"close",unelevated:"",size:"sm",onClick:t[4]||(t[4]=r=>this.upload_enabled=!this.upload_enabled)})]),a(z,{url:l.upload_api,label:e.$t("Upload files"),color:e.$q.dark.mode?"grey600":"green-5","text-color":e.$q.dark.mode?"grey300":"white","no-thumbnails":"",class:"full-width q-mb-md",flat:"",accept:".jpg, image/*",bordered:"","max-files":1,"auto-upload":"","max-total-size":"1048576",onRejected:e.onRejectedFiles,headers:[{name:"Authorization",value:`token ${this.getToken()}`}],"field-name":"file",onUploaded:i.afterUploaded},null,8,["url","label","color","text-color","onRejected","headers","onUploaded"])])):p("",!0),a(Q,{class:"q-pa-sm"}),a(m,{loading:l.loading_submit,type:"submit",label:e.$t("Submit"),unelevated:"","no-caps":"",color:"primary text-white",class:"full-width text-weight-bold",size:"lg"},null,8,["loading","label"])]),_:1},8,["onSubmit"])]),_:1})):!l.loading&&!i.hasData?(d(),b("div",O,[h("p",R,s(e.$t("No data available")),1)])):p("",!0)]),_:1},8,["class"])],64)}var re=$(j,[["render",E]]);export{re as default};
