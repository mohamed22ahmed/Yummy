import{_ as B,ar as k,au as C,u as T,X as u,p as w,q as n,Z as f,ae as a,f as t,v as r,d0 as p,a1 as s,a4 as _,t as m,aj as c,ak as g,F as y,a0 as q,$ as b,bC as D,d4 as x,aP as O,a5 as E,al as U}from"./index.57d98e6b.js";import{Q as v}from"./QSpace.6257f203.js";import{Q as L,a as F}from"./QBar.3a2078ec.js";import{Q as V}from"./QImg.0d589814.js";import{C as I}from"./ClosePopup.26d225cb.js";import{A as P}from"./AppCamera.2e0dc590.js";import"./position-engine.6e2e634f.js";import"./selection.b1db311e.js";const j={name:"OrderDropoff",props:["order_uuid","merchants","data","order_meta","payment_list"],components:{OrderDetails:k(()=>C(()=>import("./OrderDetails.cc509313.js"),["assets/OrderDetails.cc509313.js","assets/QSkeleton.27b7e3fa.js","assets/index.57d98e6b.js","assets/index.945c03c3.css","assets/QItemLabel.534f2eb0.js","assets/QList.9b1deb90.js"])),OrderHelp:k(()=>C(()=>import("./OrderHelp.295f15fd.js"),["assets/OrderHelp.295f15fd.js","assets/index.57d98e6b.js","assets/index.945c03c3.css","assets/QBar.3a2078ec.js","assets/position-engine.6e2e634f.js","assets/selection.b1db311e.js","assets/QSpace.6257f203.js","assets/QItemLabel.534f2eb0.js","assets/QList.9b1deb90.js","assets/ClosePopup.26d225cb.js"])),UploaderFile:k(()=>C(()=>import("./UploaderFile.778c5550.js"),["assets/UploaderFile.778c5550.js","assets/index.57d98e6b.js","assets/index.945c03c3.css","assets/QCircularProgress.44787b73.js","assets/format.de7e9769.js"]))},setup(){return{Activity:T()}},data(){return{loading:!1,confirm_dialog:!1,confirm_dialog_drop:!1,photo_data:[],upload_enabled:!1,has_photo:!1,upload_path:"",featured_filename:"",featured_url:"",otp_code:""}},mounted(){},computed:{hasAddedProof(){if(this.Activity.settings_data.add_proof_photo){if(this.has_photo)return!0}else return!0;return!1},hasData(){return Object.keys(this.data).length>0},paymentLabel(){return(this.payment_list[this.data.payment_code]?this.payment_list[this.data.payment_code]:0)==1?this.$t("Paid online"):this.$t("Collect Cash")},isCash(){return(this.payment_list[this.data.payment_code]?this.payment_list[this.data.payment_code]:0)!=1},hasPhoto(){return!u.empty(this.featured_url)},hasPhotoData(){return Object.keys(this.photo_data).length>0}},methods:{hideDialog(){this.confirm_dialog=!1},showHelp(){this.$refs.order_help.show()},changeOrderStatus(e){this.loading=!0,u.showLoadingBox("",this.$q),u.fetchDataByToken(e,{order_uuid:this.order_uuid,featured_filename:this.featured_filename,upload_path:this.upload_path,file_data:this.hadData()?this.photo_data.data:"",image_type:this.hadData()?this.photo_data.format:"",otp_code:this.otp_code}).then(l=>{this.confirm_dialog_drop=!1,this.$emit("afterChangestatus",l.details)}).catch(l=>{u.notify("red-5",l,"error_outline",this.$q)}).then(l=>{u.hideLoadingBox(this.$q),this.loading=!1})},takePhoto(){this.$q.capacitor?P.isCameraEnabled().then(e=>{P.isFileAccessEnabled().then(l=>{P.getPhoto(1).then(o=>{this.photo_data=o,this.has_photo=!0}).catch(o=>{this.photo_data=[]})}).catch(l=>{u.notify("dark",l,"error",this.$q)})}).catch(e=>{u.notify("dark",e,"error",this.$q)}):this.upload_enabled=!this.upload_enabled},afterSubmit(e){this.loading=!0,u.showLoadingBox("",this.$q),u.fetchDataByToken("deliveryfailed",{order_uuid:this.order_uuid,reason:e}).then(l=>{this.$refs.order_help.hide(),this.$emit("afterChangestatus",[])}).catch(l=>{u.notify("red-5",l,"error_outline",this.$q)}).then(l=>{u.hideLoadingBox(this.$q),this.loading=!1})},afterUploadfile(e){this.featured_filename=e.filename,this.featured_url=e.url_image,this.upload_path=e.upload_path,this.has_photo=!0},clearPhoto(){this.upload_enabled=!1,this.has_photo=!1,this.featured_filename="",this.featured_url="",this.upload_path="",this.photo_data=[]},hadData(){return Object.keys(this.photo_data).length>0}}},H={class:"no-margin"},N={class:"row items-center"},R={class:"col text-weight-medium"},X={class:"col-5 text-right"},Z={class:"flex items-center justify-end"},G={class:"no-margin"},J={class:"text-weight-bold"},K={class:"text-weight-medium"},M=a("div",{class:"q-pa-sm"},null,-1),W={class:"no-margin"},Y={class:"row items-center"},$={class:"col"},ee={key:0,class:"col text-right text-weight-bold"},te={class:"text-center"},ae={class:"font15 text-weight-bold"},oe={class:"col text-center"},le={class:"text-weight-bold"},se={class:"font11"},re={class:"row items-center"},de={class:"col font16 text-weight-bold"},ie=a("div",{class:"col text-right"},null,-1),ne={class:"text-h7"},he={key:0,class:"row items-center"},ue={class:"col"},_e={class:"font16 text-weight-bold"},ce={class:"font14 line-normal"},fe={class:"col text-right"},me={key:2,class:"q-mt-md"},pe={class:"font16 text-weight-bold q-mb-xs"};function ge(e,l,o,A,d,i){const z=w("OrderDetails"),Q=w("UploaderFile"),S=w("OrderHelp");return n(),f(y,null,[a("div",{class:b(["bg-whitex q-pb-md",{"bg-mydark ":e.$q.dark.mode,"bg-white ":!e.$q.dark.mode}])},[t(g,{class:"no-shadow"},{default:r(()=>[t(p,null,{default:r(()=>[a("p",H,s(e.$t("Customer Details")),1),a("div",N,[a("div",R,s(o.data.full_name),1),a("div",X,[a("div",Z,[t(_,{round:"",color:"deep-orange",icon:"las la-exclamation-triangle",size:"12px",unelevated:"",flat:"",class:"q-mr-xs",onClick:i.showHelp},null,8,["onClick"]),t(_,{round:"",color:"primary",icon:"las la-map",size:"sm",unelevated:"",flat:"",class:"q-mr-xs",to:"/home/maps"}),o.order_meta[o.data.order_id]?(n(),m(_,{key:0,href:"tel:"+o.order_meta[o.data.order_id].contact_number,round:"",color:"mygreen",icon:"las la-phone-volume",size:"sm",unelevated:"",flat:""},null,8,["href"])):c("",!0)])])])]),_:1})]),_:1}),t(g,{class:b(["no-shadow card-borderedx no-border-radius",{"":e.$q.dark.mode,"card-bordered":!e.$q.dark.mode}])},{default:r(()=>[t(p,null,{default:r(()=>[a("p",G,s(e.$t("Order Details")),1),a("div",J,"Order#"+s(o.data.order_id),1),a("div",K,[o.order_meta[o.data.order_id]?(n(),f(y,{key:0},[o.order_meta[o.data.order_id].address1?(n(),f(y,{key:0},[q(s(o.order_meta[o.data.order_id].address1),1)],64)):c("",!0)],64)):c("",!0),q(" "+s(o.data.address),1)]),M,t(z,{order_uuid:o.order_uuid},null,8,["order_uuid"])]),_:1})]),_:1},8,["class"]),t(g,{class:"no-shadow no-border-radius"},{default:r(()=>[t(p,null,{default:r(()=>[a("p",W,s(e.$t("Payment")),1),a("div",Y,[a("div",$,s(i.paymentLabel),1),i.isCash?(n(),f("div",ee,s(o.data.total),1)):c("",!0)]),t(v,{class:"q-pa-lg"}),t(v,{class:"q-pa-md"}),t(_,{label:e.$t("Drop-off"),onClick:l[0]||(l[0]=h=>d.confirm_dialog=!d.confirm_dialog),color:"primary",unelevated:"",class:"fit text-weight-bold",size:"lg","no-caps":"",style:D(`background-color:${o.data.delivery_steps.status_data.bg_color} !important;color:${o.data.delivery_steps.status_data.font_color} !important;`)},null,8,["label","style"])]),_:1})]),_:1})],2),t(O,{modelValue:d.confirm_dialog,"onUpdate:modelValue":l[3]||(l[3]=h=>d.confirm_dialog=h),position:"bottom"},{default:r(()=>[t(g,null,{default:r(()=>[t(p,null,{default:r(()=>[a("div",te,[a("div",ae,s(e.$t("Do you confirm order#"))+s(o.data.order_id)+" "+s(e.$t("Drop-off"))+"? ",1)])]),_:1}),t(x,{class:"q-gutter-md"},{default:r(()=>[t(_,{color:"primary","no-caps":"",label:e.$t("Confirm Drop-off"),unelevated:"",class:"fit text-weight-bold",size:"lg",onClick:l[1]||(l[1]=h=>d.confirm_dialog_drop=!0),style:D(`background-color:${o.data.delivery_steps.status_data.bg_color} !important;color:${o.data.delivery_steps.status_data.font_color} !important;`)},null,8,["label","style"]),t(_,{color:"blue","no-caps":"",label:e.$t("Cancel"),unelevated:"",flat:"",class:"fit text-weight-bold",size:"lg",onClick:l[2]||(l[2]=h=>d.confirm_dialog=!d.confirm_dialog)},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(O,{modelValue:d.confirm_dialog_drop,"onUpdate:modelValue":l[6]||(l[6]=h=>d.confirm_dialog_drop=h),maximized:!0,"transition-show":"slide-up","transition-hide":"slide-down",onShow:i.hideDialog},{default:r(()=>[t(g,null,{default:r(()=>[t(L,{class:"transparent q-pa-sm",style:{height:"auto"}},{default:r(()=>[a("div",oe,[a("div",le,s(e.$t("Confirm Drop-off")),1),a("div",se,"Order #"+s(o.data.order_id),1)]),E((n(),m(_,{dense:"",flat:"",icon:"close"},{default:r(()=>[t(F,{class:"bg-white text-primary"},{default:r(()=>[q(s(e.$t("Close")),1)]),_:1})]),_:1})),[[I]])]),_:1}),t(v,{class:b(["q-pa-xs",{"":e.$q.dark.mode,"bg-grey-1":!e.$q.dark.mode}])},null,8,["class"]),t(p,null,{default:r(()=>[i.isCash?(n(),f(y,{key:0},[a("div",re,[a("div",de,s(e.$t("Total Payment")),1),ie]),a("div",ne,s(o.data.total),1),a("p",null,s(e.$t("Collect cash from customer")),1)],64)):c("",!0),a("div",{class:b(["q-pt-sm",{"border-top":i.isCash,"border-bottom":!i.isCash}])},[A.Activity.settings_data.add_proof_photo?(n(),f("div",he,[a("div",ue,[a("div",_e,s(e.$t("Proof of Drop-off")),1),a("p",ce,s(e.$t("Add a photo as proof of Drop-off")),1)]),a("div",fe,[a("div",null,[d.has_photo?(n(),m(_,{key:0,flat:"",label:e.$t("Delete"),color:"primary","no-caps":"",class:"q-pr-none font17",onClick:i.clearPhoto},null,8,["label","onClick"])):(n(),m(_,{key:1,label:e.$t("Add photo"),flat:"",color:"primary","no-caps":"",class:"q-pl-none q-pr-none",onClick:i.takePhoto},null,8,["label","onClick"]))]),i.hasPhoto?(n(),m(V,{key:0,src:d.featured_url,"spinner-color":"primary","spinner-size":"sm",fit:"cover",style:{height:"50px","max-width":"50px"},class:"radius8"},null,8,["src"])):i.hasPhotoData?(n(),m(V,{key:1,src:d.photo_data.path,"spinner-color":"primary","spinner-size":"sm",fit:"cover",style:{height:"50px","max-width":"50px"},class:"radius8"},null,8,["src"])):c("",!0)])])):c("",!0)],2),d.upload_enabled?(n(),f(y,{key:1},[t(v,{class:"q-pa-xs"}),t(Q,{ref:"uploader_file",path:"upload/order_proof",onAfterUploadfile:i.afterUploadfile},null,8,["onAfterUploadfile"])],64)):c("",!0),A.Activity.settings_data.enabled_delivery_otp?(n(),f("div",me,[a("div",pe,s(e.$t("Enter order OTP code")),1),t(U,{modelValue:d.otp_code,"onUpdate:modelValue":l[4]||(l[4]=h=>d.otp_code=h),type:"number",label:e.$t("OTP Code"),outlined:"",color:"grey-5",mask:"#######","lazy-rules":"",rules:[h=>h&&h.length>0||this.$t("This field is required")]},null,8,["modelValue","label","rules"])])):c("",!0)]),_:1}),t(x,{class:"fixed-bottom"},{default:r(()=>[t(_,{label:e.$t("Confirm Drop-off"),loading:d.loading,disabled:!i.hasAddedProof,onClick:l[5]||(l[5]=h=>i.changeOrderStatus("orderdelivered")),color:"primary",unelevated:"",class:"fit text-weight-bold",size:"lg","no-caps":"",style:D(`background-color:${o.data.delivery_steps.status_data.bg_color} !important;color:${o.data.delivery_steps.status_data.font_color} !important;`)},null,8,["label","loading","disabled","style"])]),_:1})]),_:1})]),_:1},8,["modelValue","onShow"]),t(S,{ref:"order_help",list_type:"orderhelplist",title:e.$t("Report an issue"),onAfterSubmit:i.afterSubmit},null,8,["title","onAfterSubmit"])],64)}var Pe=B(j,[["render",ge]]);export{Pe as default};
