import{b7 as o,X as a,be as h}from"./index.57d98e6b.js";const m=o("schedule",{state:()=>({loading:!1,date_now:"",data:[],vehicle_data:[],vehicle_maker:[],vehicle_type:[],vehicle_documents:[],timer:void 0,time_interval:6e4,$q:void 0,data_break:[],timer_break:void 0,break_status:"",can_request_break:!1}),getters:{hasData(){return Object.keys(this.data).length>0},hasBreak(){return Object.keys(this.data_break).length>0},isWorking(){let e=!1;return Object.keys(this.data).length>0&&Object.entries(this.data).forEach(([t,i])=>{i.shift_time_started!=null&&(e=!0)}),e==!0?e:!1}},actions:{clearData(){this.data=[],this.vehicle_data=[],this.vehicle_maker=[],this.vehicle_type=[],this.vehicle_documents=[]},gettShift(){let e=a.getDateNow();this.loading=!0,a.getShift({date:e}).then(t=>{this.date_now=t.details.date_now,this.data=t.details.data.list,this.data_break=t.details.data_break,this.can_request_break=t.details.can_request_break,this.vehicle_data=t.details.vehicle_data,this.vehicle_maker=t.details.vehicle_maker,this.vehicle_type=t.details.vehicle_type,this.vehicle_documents=t.details.vehicle_documents,this.runRemainingTime(),this.startTimer(),Object.keys(this.data_break).length>0&&(this.runRemainingBreak(),this.startTimerBreak())}).catch(t=>{this.data=[],this.vehicle_data=[],this.vehicle_maker=[],this.vehicle_type=[],this.vehicle_documents=[],this.data_break=[]}).then(t=>{this.loading=!1})},runRemainingTime(){Object.keys(this.data).length>0&&Object.entries(this.data).forEach(([e,t])=>{this.getTimeRemaining(t)})},startTimer(){this.stopTimer(),this.timer=setInterval(()=>{this.runRemainingTime()},this.time_interval)},stopTimer(){clearInterval(this.timer)},startTimerBreak(){this.stopTimerBreak(),this.timer_break=setInterval(()=>{this.runRemainingBreak()},this.time_interval)},stopTimerBreak(){clearInterval(this.timer_break)},hadData(){return Object.keys(this.data).length>0},refreshShift(e){let t=a.getDateNow();a.getShift({date:t}).then(i=>{this.date_now=i.details.date_now,this.data=i.details.data.list,this.data_break=i.details.data_break,this.can_request_break=i.details.can_request_break,this.vehicle_data=i.details.vehicle_data,this.vehicle_maker=i.details.vehicle_maker,this.vehicle_type=i.details.vehicle_type,this.vehicle_documents=i.details.vehicle_documents,this.runRemainingTime(),this.startTimer(),Object.keys(this.data_break).length>0&&(this.runRemainingBreak(),this.startTimerBreak())}).catch(i=>{this.data=[],this.vehicle_data=[],this.vehicle_maker=[],this.vehicle_type=[],this.vehicle_documents=[]}).then(i=>{e()})},getTimeRemaining(e){let t=a.getDateTimeNow(),i=h.fromISO(e.shift_start),d=h.fromISO(t);const s=i.diff(d,["hours","minutes"]).toObject();let _=h.fromISO(e.shift_end),u=h.fromISO(t);const l=_.diff(u,["hours","minutes"]).toObject();let r="";e.shift_status="",s.hours<=0&&s.minutes<=-1&&e.shift_time_started==null&&e.shift_time_ended==null?(e.shift_status="late",e.starting_in="",l.hours<=-1&&(e.shift_status="shift_ended")):s.hours<=0&&s.minutes<=30&&a.empty(e.shift_time_started)?(e.shift_status="ready",s.hours<=1&&(r=s.hours>0?s.hours+" hour ":"",r+=s.minutes>0?parseInt(s.minutes)+" mins":"",e.starting_in=r)):l.hours<=0&&l.minutes<=0&&!a.empty(e.shift_time_started)?e.shift_status="ended":a.empty(e.shift_time_started)?s.hours>1&&(r=s.hours>0?s.hours+" hour ":"",r+=s.minutes>0?parseInt(s.minutes)+" mins":"",e.starting_in=r):e.shift_status="started",e.shift_status=="late"&&a.notify("red-5","Reminder: You are already late in your shift","error_outline",this.$q)},runRemainingBreak(){let e=a.getDateTimeNow(),t=h.fromISO(this.data_break.break_until),i=h.fromISO(e);const n=t.diff(i,["hours","minutes"]).toObject();n.hours<=0&&n.minutes<=0?(this.break_status="break_ended",a.notify("red-5","Reminder: Your break is already ended","error_outline",this.$q)):this.break_status="break_ongoing"}}});export{m as u};
