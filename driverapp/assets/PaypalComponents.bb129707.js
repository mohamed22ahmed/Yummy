import{Q as h}from"./QSpace.6257f203.js";import{_ as b,X as i,q as P,Z as v,f as e,v as o,ak as u,a4 as c,d0 as p,ae as l,a1 as m,a2 as _,d4 as y,aP as f,a5 as q,F as x}from"./index.57d98e6b.js";import{Q as C}from"./QToolbar.5785cd51.js";import{C as k}from"./ClosePopup.26d225cb.js";import{l as Q}from"./index.4f152a18.js";let w;const V={name:"PaypalComponents",props:["title","label","payment_code","payment_credentials","reference"],data(){return{show_modal:!1,data:[],loading:!1,payment_modal:!1,client_id:""}},methods:{showPaymentForm(){this.show_modal=!0},close(){this.show_modal=!1},onSubmit(){let a=0;typeof this.payment_credentials[this.payment_code]!="undefined"&&this.payment_credentials[this.payment_code]!==null&&(a=this.payment_credentials[this.payment_code].merchant_id);const t={merchant_id:a,payment_code:this.payment_code,reference:this.reference};this.loading=!0,i.fetchDataByTokenPost("SavedPaymentProvider",t).then(s=>{this.close(),this.$emit("afterAddpayment")}).catch(s=>{i.notify("dark",s,"error",this.$q)}).then(s=>{this.loading=!1})},PaymentRender(a){this.data=a,this.payment_modal=!0,typeof this.payment_credentials[a.payment_code]!="undefined"&&this.payment_credentials[a.payment_code]!==null&&(this.client_id=this.payment_credentials[a.payment_code].attr1),this.initPaypal()},initPaypal(){Q("https://www.paypal.com/sdk/js?client-id="+this.client_id+"&currency="+this.data.currency+"&disable-funding=credit,card").then(()=>{this.renderPaypal()}).catch(()=>{i.notify("negative","failed loading script","error_outline",this.$q)})},renderPaypal(){w=paypal.Buttons({createOrder:(a,t)=>t.order.create({purchase_units:[{amount:{value:this.data.amount}}]}),onCancel:a=>{},onError:a=>{i.notify("dark",a,"error",this.$q)},onApprove:(a,t)=>t.order.capture().then(s=>{const d=s.purchase_units[0].payments.captures[0];this.CompletePaymentRequest(d.status,d.id,s.id)})}),w.render(this.$refs.paypal_button)},CompletePaymentRequest(a,t,s){let d={transaction_id:t,order_id:s,reference:this.reference};i.showLoadingBox("Processing payment..<br/>don't close this window",this.$q),i.PaymentPost("PaypalVerifyPayment",d).then(n=>{this.$emit("afterPayment",n.details)}).catch(n=>{i.notify("dark",n,"error",this.$q)}).then(n=>{i.hideLoadingBox(this.$q)})}}},B={class:"text-weight-bold no-margin"},S={class:"q-ma-sm"},$={class:"font12"},A={class:"text-weight-bold no-margin"},D={class:"q-ma-sm"},F={class:"font12"},R={ref:"paypal_button",class:"margin-auto full-width"};function z(a,t,s,d,n,g){return P(),v(x,null,[e(f,{modelValue:n.show_modal,"onUpdate:modelValue":t[2]||(t[2]=r=>n.show_modal=r),persistent:"","transition-show":"fade","transition-hide":"fade"},{default:o(()=>[e(u,{style:{width:"500px","max-width":"80vw"}},{default:o(()=>[e(C,{class:"text-primary top-toolbar q-pl-md",dense:""},{default:o(()=>[e(h),e(c,{onClick:t[0]||(t[0]=r=>n.show_modal=!1),color:"white",square:"",unelevated:"","text-color":"grey",icon:"las la-times",dense:"","no-caps":"",size:"sm",class:"border-grey radius8"})]),_:1}),e(p,{class:"q-pa-md"},{default:o(()=>[l("h5",B,m(s.title),1),l("div",S,[l("p",$,m(s.label.notes),1)])]),_:1}),e(_,{spaced:""}),e(y,null,{default:o(()=>[e(c,{label:s.label.submit,loading:n.loading,onClick:t[1]||(t[1]=r=>g.onSubmit()),unelevated:"","no-caps":"",color:"primary text-white",class:"full-width text-weight-bold",size:"lg"},null,8,["label","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(f,{modelValue:n.payment_modal,"onUpdate:modelValue":t[3]||(t[3]=r=>n.payment_modal=r),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:o(()=>[e(u,{style:{width:"500px","max-width":"80vw"}},{default:o(()=>[e(p,{class:"row items-center q-pb-none q-pa-none"},{default:o(()=>[e(h),q(e(c,{icon:"eva-close-outline",flat:"",round:"",dense:""},null,512),[[k]])]),_:1}),e(p,{class:"q-pa-md"},{default:o(()=>[l("h5",A,m(s.label.payment_title),1),l("div",D,[l("p",F,m(s.label.payment_subtitle),1)])]),_:1}),e(_,{spaced:""}),e(y,null,{default:o(()=>[l("div",R,null,512)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var U=b(V,[["render",z]]);export{U as default};
