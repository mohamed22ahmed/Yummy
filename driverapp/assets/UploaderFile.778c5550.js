import{r as q,c as y,g as ue,aM as re,ao as ne,l as ce,h as m,P as pe,R as fe,ad as ve,z as me,db as _e,w as ge,E as he,d as Fe,cY as be,dc as ye,V as ae,ah as qe,a4 as te,x as Se,cW as ze,_ as Ue,d8 as xe,ag as ke,X as we,q as Re,t as Be}from"./index.57d98e6b.js";import{Q as je}from"./QCircularProgress.44787b73.js";import{h as le}from"./format.de7e9769.js";function Q(o,s,u,l){const r=[];return o.forEach(f=>{l(f)===!0?r.push(f):s.push({failedPropValidation:u,file:f})}),r}function X(o){o&&o.dataTransfer&&(o.dataTransfer.dropEffect="copy"),ne(o)}const Ee={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Ce=["rejected"];function Pe({editable:o,dnd:s,getFileInput:u,addFilesToQueue:l}){const{props:r,emit:f,proxy:B}=ue(),U=q(null),I=y(()=>r.accept!==void 0?r.accept.split(",").map(t=>(t=t.trim(),t==="*"?"*/":(t.endsWith("/*")&&(t=t.slice(0,t.length-1)),t.toUpperCase()))):null),j=y(()=>parseInt(r.maxFiles,10)),E=y(()=>parseInt(r.maxTotalSize,10));function O(t){if(o.value)if(t!==Object(t)&&(t={target:null}),t.target!==null&&t.target.matches('input[type="file"]')===!0)t.clientX===0&&t.clientY===0&&re(t);else{const F=u();F&&F!==t.target&&F.click(t)}}function C(t){o.value&&t&&l(null,t)}function P(t,F,L,T){let i=Array.from(F||t.target.files);const v=[],z=()=>{v.length!==0&&f("rejected",v)};if(r.accept!==void 0&&I.value.indexOf("*/")===-1&&(i=Q(i,v,"accept",d=>I.value.some(g=>d.type.toUpperCase().startsWith(g)||d.name.toUpperCase().endsWith(g))),i.length===0))return z();if(r.maxFileSize!==void 0){const d=parseInt(r.maxFileSize,10);if(i=Q(i,v,"max-file-size",g=>g.size<=d),i.length===0)return z()}if(r.multiple!==!0&&i.length!==0&&(i=[i[0]]),i.forEach(d=>{d.__key=d.webkitRelativePath+d.lastModified+d.name+d.size}),T===!0){const d=L.map(g=>g.__key);i=Q(i,v,"duplicate",g=>d.includes(g.__key)===!1)}if(i.length===0)return z();if(r.maxTotalSize!==void 0){let d=T===!0?L.reduce((g,k)=>g+k.size,0):0;if(i=Q(i,v,"max-total-size",g=>(d+=g.size,d<=E.value)),i.length===0)return z()}if(typeof r.filter=="function"){const d=r.filter(i);i=Q(i,v,"filter",g=>d.includes(g))}if(r.maxFiles!==void 0){let d=T===!0?L.length:0;if(i=Q(i,v,"max-files",()=>(d++,d<=j.value)),i.length===0)return z()}if(z(),i.length!==0)return i}function e(t){X(t),s.value!==!0&&(s.value=!0)}function _(t){ne(t),(t.relatedTarget!==null||ce.is.safari!==!0?t.relatedTarget!==U.value:document.elementsFromPoint(t.clientX,t.clientY).includes(U.value)===!1)===!0&&(s.value=!1)}function S(t){X(t);const F=t.dataTransfer.files;F.length!==0&&l(null,F),s.value=!1}function p(t){if(s.value===!0)return m("div",{ref:U,class:`q-${t}__dnd absolute-full`,onDragenter:X,onDragover:X,onDragleave:_,onDrop:S})}return Object.assign(B,{pickFiles:O,addFiles:C}),{pickFiles:O,addFiles:C,onDragover:e,onDragleave:_,processFiles:P,getDndNode:p,maxFilesNumber:j,maxTotalSizeNumber:E}}function oe(o){return(o*100).toFixed(2)+"%"}const Le={...pe,...Ee,label:String,color:String,textColor:String,square:Boolean,flat:Boolean,bordered:Boolean,noThumbnails:Boolean,autoUpload:Boolean,hideUploadBtn:Boolean,disable:Boolean,readonly:Boolean},ie=[...Ce,"start","finish","added","removed"];function Te(o,s){const u=ue(),{props:l,slots:r,emit:f,proxy:B}=u,{$q:U}=B,I=fe(l,U);function j(a,c,h){if(a.__status=c,c==="idle"){a.__uploaded=0,a.__progress=0,a.__sizeLabel=le(a.size),a.__progressLabel="0.00%";return}if(c==="failed"){B.$forceUpdate();return}a.__uploaded=c==="uploaded"?a.size:h,a.__progress=c==="uploaded"?1:Math.min(.9999,a.__uploaded/a.size),a.__progressLabel=oe(a.__progress),B.$forceUpdate()}const E=y(()=>l.disable!==!0&&l.readonly!==!0),O=q(!1),C=q(null),P=q(null),e={files:q([]),queuedFiles:q([]),uploadedFiles:q([]),uploadedSize:q(0),updateFileStatus:j,isAlive:()=>ve(u)===!1},{pickFiles:_,addFiles:S,onDragover:p,onDragleave:t,processFiles:F,getDndNode:L,maxFilesNumber:T,maxTotalSizeNumber:i}=Pe({editable:E,dnd:O,getFileInput:J,addFilesToQueue:K});Object.assign(e,o({props:l,slots:r,emit:f,helpers:e,exposeApi:a=>{Object.assign(e,a)}})),e.isBusy===void 0&&(e.isBusy=q(!1));const v=q(0),z=y(()=>v.value===0?0:e.uploadedSize.value/v.value),d=y(()=>oe(z.value)),g=y(()=>le(v.value)),k=y(()=>E.value===!0&&e.isUploading.value!==!0&&(l.multiple===!0||e.queuedFiles.value.length===0)&&(l.maxFiles===void 0||e.files.value.length<T.value)&&(l.maxTotalSize===void 0||v.value<i.value)),n=y(()=>E.value===!0&&e.isBusy.value!==!0&&e.isUploading.value!==!0&&e.queuedFiles.value.length!==0);me(_e,V);const A=y(()=>"q-uploader column no-wrap"+(I.value===!0?" q-uploader--dark q-dark":"")+(l.bordered===!0?" q-uploader--bordered":"")+(l.square===!0?" q-uploader--square no-border-radius":"")+(l.flat===!0?" q-uploader--flat no-shadow":"")+(l.disable===!0?" disabled q-uploader--disable":"")+(O.value===!0?" q-uploader--dnd":"")),N=y(()=>"q-uploader__header"+(l.color!==void 0?` bg-${l.color}`:"")+(l.textColor!==void 0?` text-${l.textColor}`:""));ge(e.isUploading,(a,c)=>{c===!1&&a===!0?f("start"):c===!0&&a===!1&&f("finish")});function D(){l.disable===!1&&(e.abort(),e.uploadedSize.value=0,v.value=0,G(),e.files.value=[],e.queuedFiles.value=[],e.uploadedFiles.value=[])}function x(){l.disable===!1&&Y(["uploaded"],()=>{e.uploadedFiles.value=[]})}function W(){Y(["idle","failed"],({size:a})=>{v.value-=a,e.queuedFiles.value=[]})}function Y(a,c){if(l.disable===!0)return;const h={files:[],size:0},w=e.files.value.filter(b=>a.indexOf(b.__status)===-1?!0:(h.size+=b.size,h.files.push(b),b.__img!==void 0&&window.URL.revokeObjectURL(b.__img.src),!1));h.files.length!==0&&(e.files.value=w,c(h),f("removed",h.files))}function H(a){l.disable||(a.__status==="uploaded"?e.uploadedFiles.value=e.uploadedFiles.value.filter(c=>c.__key!==a.__key):a.__status==="uploading"?a.__abort():v.value-=a.size,e.files.value=e.files.value.filter(c=>c.__key!==a.__key?!0:(c.__img!==void 0&&window.URL.revokeObjectURL(c.__img.src),!1)),e.queuedFiles.value=e.queuedFiles.value.filter(c=>c.__key!==a.__key),f("removed",[a]))}function G(){e.files.value.forEach(a=>{a.__img!==void 0&&window.URL.revokeObjectURL(a.__img.src)})}function J(){return P.value||C.value.getElementsByClassName("q-uploader__input")[0]}function K(a,c){const h=F(a,c,e.files.value,!0),w=J();w!=null&&(w.value=""),h!==void 0&&(h.forEach(b=>{if(e.updateFileStatus(b,"idle"),v.value+=b.size,l.noThumbnails!==!0&&b.type.toUpperCase().startsWith("IMAGE")){const ee=new Image;ee.src=window.URL.createObjectURL(b),b.__img=ee}}),e.files.value=e.files.value.concat(h),e.queuedFiles.value=e.queuedFiles.value.concat(h),f("added",h),l.autoUpload===!0&&e.upload())}function Z(){n.value===!0&&e.upload()}function M(a,c,h){if(a===!0){const w={type:"a",key:c,icon:U.iconSet.uploader[c],flat:!0,dense:!0};let b;return c==="add"?(w.onClick=_,b=V):w.onClick=h,m(te,w,b)}}function V(){return m("input",{ref:P,class:"q-uploader__input overflow-hidden absolute-full",tabindex:-1,type:"file",title:"",accept:l.accept,multiple:l.multiple===!0?"multiple":void 0,capture:l.capture,onMousedown:re,onClick:_,onChange:K})}function se(){return r.header!==void 0?r.header($):[m("div",{class:"q-uploader__header-content column"},[m("div",{class:"flex flex-center no-wrap q-gutter-xs"},[M(e.queuedFiles.value.length!==0,"removeQueue",W),M(e.uploadedFiles.value.length!==0,"removeUploaded",x),e.isUploading.value===!0?m(ae,{class:"q-uploader__spinner"}):null,m("div",{class:"col column justify-center"},[l.label!==void 0?m("div",{class:"q-uploader__title"},[l.label]):null,m("div",{class:"q-uploader__subtitle"},[g.value+" / "+d.value])]),M(k.value,"add"),M(l.hideUploadBtn===!1&&n.value===!0,"upload",e.upload),M(e.isUploading.value,"clear",e.abort)])])]}function de(){return r.list!==void 0?r.list($):e.files.value.map(a=>m("div",{key:a.__key,class:"q-uploader__file relative-position"+(l.noThumbnails!==!0&&a.__img!==void 0?" q-uploader__file--img":"")+(a.__status==="failed"?" q-uploader__file--failed":a.__status==="uploaded"?" q-uploader__file--uploaded":""),style:l.noThumbnails!==!0&&a.__img!==void 0?{backgroundImage:'url("'+a.__img.src+'")'}:null},[m("div",{class:"q-uploader__file-header row flex-center no-wrap"},[a.__status==="failed"?m(qe,{class:"q-uploader__file-status",name:U.iconSet.type.negative,color:"negative"}):null,m("div",{class:"q-uploader__file-header-content col"},[m("div",{class:"q-uploader__title"},[a.name]),m("div",{class:"q-uploader__subtitle row items-center no-wrap"},[a.__sizeLabel+" / "+a.__progressLabel])]),a.__status==="uploading"?m(je,{value:a.__progress,min:0,max:1,indeterminate:a.__progress===0}):m(te,{round:!0,dense:!0,flat:!0,icon:U.iconSet.uploader[a.__status==="uploaded"?"done":"clear"],onClick:()=>{H(a)}})])]))}he(()=>{e.isUploading.value===!0&&e.abort(),e.files.value.length!==0&&G()});const $={};for(const a in e)Fe(e[a])===!0?be($,a,()=>e[a].value):$[a]=e[a];return Object.assign($,{upload:Z,reset:D,removeUploadedFiles:x,removeQueuedFiles:W,removeFile:H,pickFiles:_,addFiles:S}),ye($,{canAddFiles:()=>k.value,canUpload:()=>n.value,uploadSizeLabel:()=>g.value,uploadProgressLabel:()=>d.value}),s({...e,upload:Z,reset:D,removeUploadedFiles:x,removeQueuedFiles:W,removeFile:H,pickFiles:_,addFiles:S,canAddFiles:k,canUpload:n,uploadSizeLabel:g,uploadProgressLabel:d}),()=>{const a=[m("div",{class:N.value},se()),m("div",{class:"q-uploader__list scroll"},de()),L("uploader")];e.isBusy.value===!0&&a.push(m("div",{class:"q-uploader__overlay absolute-full flex flex-center"},[m(ae)]));const c={ref:C,class:A.value};return k.value===!0&&Object.assign(c,{onDragover:p,onDragleave:t}),m("div",c,a)}}const Oe=()=>!0;function Ae(o){const s={};return o.forEach(u=>{s[u]=Oe}),s}const Ie=Ae(ie);var Ne=({name:o,props:s,emits:u,injectPlugin:l})=>Se({name:o,props:{...Le,...s},emits:ze(u)===!0?{...Ie,...u}:[...ie,...u],setup(r,{expose:f}){return Te(l,f)}});function R(o){return typeof o=="function"?o:()=>o}const De="QUploader",$e={url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>o=>o.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},Qe=["factoryFailed","uploaded","failed","uploading"];function Me({props:o,emit:s,helpers:u}){const l=q([]),r=q([]),f=q(0),B=y(()=>({url:R(o.url),method:R(o.method),headers:R(o.headers),formFields:R(o.formFields),fieldName:R(o.fieldName),withCredentials:R(o.withCredentials),sendRaw:R(o.sendRaw),batch:R(o.batch)})),U=y(()=>f.value>0),I=y(()=>r.value.length!==0);let j;function E(){l.value.forEach(e=>{e.abort()}),r.value.length!==0&&(j=!0)}function O(){const e=u.queuedFiles.value.slice(0);u.queuedFiles.value=[],B.value.batch(e)?C(e):e.forEach(_=>{C([_])})}function C(e){if(f.value++,typeof o.factory!="function"){P(e,{});return}const _=o.factory(e);if(!_)s("factoryFailed",new Error("QUploader: factory() does not return properly"),e),f.value--;else if(typeof _.catch=="function"&&typeof _.then=="function"){r.value.push(_);const S=p=>{u.isAlive()===!0&&(r.value=r.value.filter(t=>t!==_),r.value.length===0&&(j=!1),u.queuedFiles.value=u.queuedFiles.value.concat(e),e.forEach(t=>{u.updateFileStatus(t,"failed")}),s("factoryFailed",p,e),f.value--)};_.then(p=>{j===!0?S(new Error("Aborted")):u.isAlive()===!0&&(r.value=r.value.filter(t=>t!==_),P(e,p))}).catch(S)}else P(e,_||{})}function P(e,_){const S=new FormData,p=new XMLHttpRequest,t=(n,A)=>_[n]!==void 0?R(_[n])(A):B.value[n](A),F=t("url",e);if(!F){console.error("q-uploader: invalid or no URL specified"),f.value--;return}const L=t("formFields",e);L!==void 0&&L.forEach(n=>{S.append(n.name,n.value)});let T=0,i=0,v=0,z=0,d;p.upload.addEventListener("progress",n=>{if(d===!0)return;const A=Math.min(z,n.loaded);u.uploadedSize.value+=A-v,v=A;let N=v-i;for(let D=T;N>0&&D<e.length;D++){const x=e[D];if(N>x.size)N-=x.size,T++,i+=x.size,u.updateFileStatus(x,"uploading",x.size);else{u.updateFileStatus(x,"uploading",N);return}}},!1),p.onreadystatechange=()=>{p.readyState<4||(p.status&&p.status<400?(u.uploadedFiles.value=u.uploadedFiles.value.concat(e),e.forEach(n=>{u.updateFileStatus(n,"uploaded")}),s("uploaded",{files:e,xhr:p})):(d=!0,u.uploadedSize.value-=v,u.queuedFiles.value=u.queuedFiles.value.concat(e),e.forEach(n=>{u.updateFileStatus(n,"failed")}),s("failed",{files:e,xhr:p})),f.value--,l.value=l.value.filter(n=>n!==p))},p.open(t("method",e),F),t("withCredentials",e)===!0&&(p.withCredentials=!0);const g=t("headers",e);g!==void 0&&g.forEach(n=>{p.setRequestHeader(n.name,n.value)});const k=t("sendRaw",e);e.forEach(n=>{u.updateFileStatus(n,"uploading",0),k!==!0&&S.append(t("fieldName",n),n,n.name),n.xhr=p,n.__abort=()=>{p.abort()},z+=n.size}),s("uploading",{files:e,xhr:p}),l.value.push(p),k===!0?p.send(new Blob(e)):p.send(S)}return{isUploading:U,isBusy:I,abort:E,upload:O}}var We={name:De,props:$e,emits:Qe,injectPlugin:Me},Xe=Ne(We);const He={name:"UploaderFile",props:["path"],data(){return{upload_api:xe.api_base_url+"/updateAvatar",url_image:"",filename:"",upload_path:""}},methods:{getToken(){return ke.getToken()},afterUploaded(o){const s=JSON.parse(o.xhr.responseText);s.code===1?(this.url_image=s.details.url_image,this.filename=s.details.filename,this.upload_path=s.details.upload_path,this.$emit("afterUploadfile",{url_image:this.url_image,filename:this.filename,upload_path:this.upload_path})):(this.url_image="",this.filename="",this.upload_path="",we.notify("dark",s.msg,"error",this.$q))}}};function Ye(o,s,u,l,r,f){return Re(),Be(Xe,{url:r.upload_api,label:o.$t("Upload files"),color:o.$q.dark.mode?"grey600":"mygrey","text-color":o.$q.dark.mode?"grey300":"grey","no-thumbnails":"",class:"full-width q-mb-md",flat:"",accept:".jpg, image/*",bordered:"","max-files":1,"auto-upload":"","max-total-size":"1048576",onRejected:o.onRejectedFiles,headers:[{name:"Authorization",value:`token ${this.getToken()}`}],"field-name":"file",onUploaded:f.afterUploaded,"form-fields":[{name:"upload_path",value:u.path}]},null,8,["url","label","color","text-color","onRejected","headers","onUploaded","form-fields"])}var Ze=Ue(He,[["render",Ye]]);export{Ze as default};
