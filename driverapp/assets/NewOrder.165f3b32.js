import{x as Z,i as se,y as x,c as Q,ab as ne,h as c,ah as re,A as O,d5 as G,P as ie,R as de,z as ce,g as ue,_ as me,ar as E,d6 as fe,d7 as _e,r as i,u as ve,o as ge,a as pe,w as he,p as L,q,Z as B,f as a,v as l,$ as S,F as P,d8 as ye,X as s,a0 as w,a1 as d,a4 as T,ae as n,t as M,a2 as be,V as ke,aa as qe,bC as N,a7 as j,a8 as we,aj as K,aP as Qe,ak as Se,d0 as U,a5 as De,au as H}from"./index.57d98e6b.js";import{Q as Ce}from"./QToolbarTitle.f2460359.js";import{Q as Ae}from"./QToolbar.5785cd51.js";import{Q as xe}from"./QHeader.8d398719.js";import{Q as Le}from"./QLinearProgress.0c632578.js";import{Q as Be}from"./QSlideItem.6eaab49f.js";import{Q as Pe}from"./QList.9b1deb90.js";import{Q as Te}from"./QSpace.6257f203.js";import{Q as Oe}from"./QPage.76c085e2.js";import{C as Ie}from"./ClosePopup.26d225cb.js";import{u as Re}from"./use-quasar.fc71e057.js";import"./QResizeObserver.1c6d7ccc.js";import"./TouchPan.8da352e0.js";import"./selection.b1db311e.js";import"./use-render-cache.3aae9b27.js";var X=Z({name:"QTimelineEntry",props:{heading:Boolean,tag:{type:String,default:"h3"},side:{type:String,default:"right",validator:e=>["left","right"].includes(e)},icon:String,avatar:String,color:String,title:String,subtitle:String,body:String},setup(e,{slots:u}){const _=se(G,x);if(_===x)return console.error("QTimelineEntry needs to be child of QTimeline"),x;const t=Q(()=>`q-timeline__entry q-timeline__entry--${e.side}`+(e.icon!==void 0||e.avatar!==void 0?" q-timeline__entry--icon":"")),f=Q(()=>`q-timeline__dot text-${e.color||_.color}`),p=Q(()=>_.layout==="comfortable"&&_.side==="left");return()=>{const v=ne(u.default,[]);if(e.body!==void 0&&v.unshift(e.body),e.heading===!0){const g=[c("div"),c("div"),c(e.tag,{class:"q-timeline__heading-title"},v)];return c("div",{class:"q-timeline__heading"},p.value===!0?g.reverse():g)}let r;e.icon!==void 0?r=[c(re,{class:"row items-center justify-center",name:e.icon})]:e.avatar!==void 0&&(r=[c("img",{class:"q-timeline__dot-img",src:e.avatar})]);const y=[c("div",{class:"q-timeline__subtitle"},[c("span",{},O(u.subtitle,[e.subtitle]))]),c("div",{class:f.value},r),c("div",{class:"q-timeline__content"},[c("h6",{class:"q-timeline__title"},O(u.title,[e.title]))].concat(v))];return c("li",{class:t.value},p.value===!0?y.reverse():y)}}}),Ve=Z({name:"QTimeline",props:{...ie,color:{type:String,default:"primary"},side:{type:String,default:"right",validator:e=>["left","right"].includes(e)},layout:{type:String,default:"dense",validator:e=>["dense","comfortable","loose"].includes(e)}},setup(e,{slots:u}){const _=ue(),t=de(e,_.proxy.$q);ce(G,e);const f=Q(()=>`q-timeline q-timeline--${e.layout} q-timeline--${e.layout}--${e.side}`+(t.value===!0?" q-timeline--dark":""));return()=>c("ul",{class:f.value},O(u.default))}});const Fe={name:"NewOrder",components:{MapComponents:E(()=>H(()=>import("./MapComponents.9175391e.js"),["assets/MapComponents.9175391e.js","assets/index.57d98e6b.js","assets/index.945c03c3.css","assets/index.4f152a18.js"])),DeclineReason:E(()=>H(()=>import("./DeclineReason.ead224af.js"),["assets/DeclineReason.ead224af.js","assets/index.57d98e6b.js","assets/index.945c03c3.css","assets/QBar.3a2078ec.js","assets/position-engine.6e2e634f.js","assets/selection.b1db311e.js","assets/QSpace.6257f203.js","assets/QItemLabel.534f2eb0.js","assets/QList.9b1deb90.js","assets/ClosePopup.26d225cb.js"]))},setup(){const e=fe(),u=_e(),_=i(null),t=i([]),f=i(""),p=i(!1),v=i(!1),r=i([]),y=i([]),g=i(!1),J=ye.title,D=i([]),I=i({}),m=Re(),R=i(""),C=i(null),V=i([]),h=i(45),F=i(.7),$=i(void 0);f.value=u.query.order_uuid;const b=ve();(()=>{try{s.empty(b.maps_config)||(D.value={lat:parseFloat(b.maps_config.default_lat),lng:parseFloat(b.maps_config.default_lng)})}catch(o){console.debug(o)}})(),(()=>{s.showLoadingBox("",m),p.value=!0,s.orderPreview({order_uuid:f.value}).then(o=>{r.value=o.details,V.value=r.value.status_data,I.value=[{id:0,lat:parseFloat(r.value.pickup.latitude),lng:parseFloat(r.value.pickup.longitude),label:s.getIcon("merchant"),icon:"marker_icon_merchant",draggable:!1},{id:1,lat:parseFloat(r.value.dropoff.latitude),lng:parseFloat(r.value.dropoff.longitude),label:s.getIcon("customer"),icon:"marker_icon_destination",draggable:!1}],D.value={lat:parseFloat(r.value.pickup.latitude),lng:parseFloat(r.value.pickup.longitude)}}).catch(o=>{console.debug(o),e.replace("/order/404")}).then(o=>{p.value=!1,s.hideLoadingBox(m)})})();const W=Q(()=>!!Object.keys(r.value).length),z=o=>{s.showLoadingBox("",m),v.value=!0,s.acceptOrder({order_uuid:f.value}).then(k=>{console.debug(k),e.replace("/home/deliveries")}).catch(k=>{console.log("here error"),o.reset(),s.notify("red-5",k,"error_outline",m)}).then(k=>{s.hideLoadingBox(m),v.value=!1})},Y=o=>{z(o)},ee=()=>{g.value=!1,C.value.reason="",C.value.dialog=!0},te=o=>{R.value=o,ae()},ae=()=>{s.showLoadingBox("",m),s.declineOrder({order_uuid:f.value,reason:R.value}).then(o=>{console.debug(o),e.replace("/home/deliveries")}).catch(o=>{s.notify("red-5",o,"error_outline",m)}).then(()=>{s.hideLoadingBox(m)})};ge(()=>{b.settings_data.enabled_acceptance&&(h.value=parseInt(b.settings_data.time_acceptance),oe())}),pe(()=>{A()}),he(h,(o,k)=>{h.value<0&&(A(),le())});const oe=()=>{A(),$.value=setInterval(()=>{h.value=h.value-1,F.value=h.value/100},1e3)},A=()=>{clearInterval($.value)},le=()=>{s.showLoadingBox("",m),s.fetchDataByTokenPost("timeoutAcceptOrder","order_uuid="+f.value).then(o=>{e.replace("/home")}).catch(o=>{s.notify("dark",o,"error_outline",m)}).then(()=>{s.hideLoadingBox(m)})};return{mapRef:_,hasData:W,loading:p,data:r,maps_config:y,dialog_confirm:g,title:J,map_center:D,map_markers:I,cmapsMarker:t,acceptOrder:z,onLeft:Y,accept_loading:v,showDeclineReason:ee,decline_reason:C,afterSubmit:te,status_data:V,Activity:b,remaining:h,progress:F}}},$e={class:"delivery-details q-mt-md q-pl-md q-pr-md"},ze={class:"font12"},Ee={class:"details"},Me={class:"text-weight-medium"},Ne={class:"font11 line-normal"},je={class:"details"},Ke={class:"text-weight-medium"},Ue={class:"font11 line-normal"},He={class:"accept-section"},Xe={class:"row items-center q-gutter-sm q-pa-md"},Ze={class:"col"},Ge={class:"col-4 q-pl-sm"},Je=n("p",{class:"line-normal no-margin"},"Order total",-1),We={class:"text-h7 text-green"},Ye={class:"text-h6 font18"},et={class:"font14"};function tt(e,u,_,t,f,p){const v=L("MapComponents"),r=L("q-card-sections"),y=L("DeclineReason");return q(),B(P,null,[a(xe,{class:S(["bg-whitex text-dark",{"bg-mydark text-white":e.$q.dark.mode,"bg-white text-black":!e.$q.dark.mode}])},{default:l(()=>[a(Ae,null,{default:l(()=>[a(Ce,{class:S(["text-grey-10x",{"text-white":e.$q.dark.mode,"text-grey-10":!e.$q.dark.mode}])},{default:l(()=>[w(d(e.$t("New Order #"))+d(t.data.order_id),1)]),_:1},8,["class"]),a(T,{onClick:u[0]||(u[0]=g=>t.dialog_confirm=!0),flat:"",dense:"",label:e.$t("Decline"),"no-caps":"",color:"blue"},null,8,["label"])]),_:1})]),_:1},8,["class"]),a(Oe,{class:S({"bg-mydark text-white":e.$q.dark.mode,"bg-grey-1 text-dark":!e.$q.dark.mode})},{default:l(()=>[t.loading?K("",!0):(q(),B(P,{key:0},[t.hasData?(q(),B(P,{key:0},[n("div",{class:S(["map small",{"bg-mydark":e.$q.dark.mode,"bg-grey-1":!e.$q.dark.mode}]),style:{overflow:"hidden"}},[a(v,{class:"maps",keys:t.Activity.maps_config.key,provider:t.Activity.maps_config.provider,zoom:t.Activity.maps_config.zoom,center:t.map_center,markers:t.map_markers},null,8,["keys","provider","zoom","center","markers"])],2),n("div",$e,[n("p",ze,d(e.$t("Delivery Details")),1),a(Ve,null,{default:l(()=>[a(X,{icon:"las la-warehouse"},{subtitle:l(()=>[w(d(e.$t("Pickup")),1)]),default:l(()=>[n("div",Ee,[n("div",Me,d(t.data.pickup.restaurant_name),1),n("p",Ne,d(t.data.pickup.address),1)])]),_:1}),a(X,{icon:"las la-user-circle"},{subtitle:l(()=>[w(d(e.$t("Drop-off")),1)]),default:l(()=>[n("div",je,[n("div",Ke,d(t.data.dropoff.customer_name),1),n("p",Ue,d(t.data.dropoff.address),1)])]),_:1})]),_:1})]),n("div",He,[t.Activity.settings_data.enabled_acceptance?(q(),M(Le,{key:0,value:t.progress,class:"q-mt-md",color:"orange-5"},null,8,["value"])):(q(),M(be,{key:1})),n("div",Xe,[n("div",Ze,[a(Pe,{bordered:"",separator:"",class:"radius8"},{default:l(()=>[a(Be,{onLeft:t.onLeft,"left-color":"light-green",class:"radius8"},{left:l(()=>[a(ke,{color:"primary",size:"2em"}),w(" "+d(e.$t("Accepting Orders")),1)]),default:l(()=>[a(qe,{class:"text-white text-weight-bold btn-11",style:N(`background-color:${t.status_data.bg_color} !important;color:${t.status_data.font_color} !important;`)},{default:l(()=>[a(j,{class:"text-center font17"},{default:l(()=>[w(d(e.$t("Accept")),1)]),_:1}),a(j,{avatar:""},{default:l(()=>[a(we,{"text-color":"white",style:N(`color:${t.status_data.font_color} !important;`),icon:"las la-angle-double-right"},null,8,["style"])]),_:1})]),_:1},8,["style"])]),_:1},8,["onLeft"])]),_:1})]),n("div",Ge,[Je,n("div",We,d(t.data.total),1)])])])],64)):K("",!0)],64)),a(Qe,{modelValue:t.dialog_confirm,"onUpdate:modelValue":u[1]||(u[1]=g=>t.dialog_confirm=g),persistent:""},{default:l(()=>[a(Se,null,{default:l(()=>[a(U,{class:"row items-center q-pb-none"},{default:l(()=>[n("div",Ye,d(e.$t("Decline")),1),a(Te),De(a(T,{icon:"close",size:"sm",flat:"",round:"",dense:""},null,512),[[Ie]])]),_:1}),a(U,null,{default:l(()=>[n("p",et,d(e.$t("Are you sure you want to decline this order"))+"? ",1)]),_:1}),a(r,null,{default:l(()=>[a(T,{onClick:t.showDeclineReason,label:e.$t("Decline"),color:"red",unelevated:"",class:"fit text-weight-bold font17","no-caps":""},null,8,["onClick","label"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["class"]),a(y,{ref:"decline_reason",onAfterSubmit:t.afterSubmit},null,8,["onAfterSubmit"])],64)}var yt=me(Fe,[["render",tt]]);export{yt as default};
