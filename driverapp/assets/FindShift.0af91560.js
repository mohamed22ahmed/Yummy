import{_ as L,ar as q,u as V,X as l,p as w,q as o,Z as h,t as p,v as a,$ as b,aj as S,f as t,aP as F,F as y,a4 as _,a0 as f,a1 as s,a2 as E,ae as m,V as C,a3 as $,ak as I,aa as k,a7 as c,d4 as O,au as A}from"./index.57d98e6b.js";import{Q as x}from"./QToolbarTitle.f2460359.js";import{Q as D}from"./QToolbar.5785cd51.js";import{Q as N}from"./QHeader.8d398719.js";import{Q as v}from"./QItemLabel.534f2eb0.js";import{Q}from"./QList.9b1deb90.js";import{Q as R}from"./QInfiniteScroll.0033dd1c.js";import{Q as j}from"./QPage.76c085e2.js";import{Q as H}from"./QPullToRefresh.b207fbbb.js";import{Q as P}from"./QSpace.6257f203.js";import{u as M}from"./ScheduleStore.6d5970b3.js";import"./QResizeObserver.1c6d7ccc.js";import"./TouchPan.8da352e0.js";import"./selection.b1db311e.js";import"./format.de7e9769.js";const U={name:"FindShift",components:{CalendarHalf:q(()=>A(()=>import("./CalendarHalf.dad16ee0.js"),["assets/CalendarHalf.dad16ee0.js","assets/index.57d98e6b.js","assets/index.945c03c3.css","assets/swiper.min.49a5a6c9.js","assets/swiper.min.b39a1361.css"])),FilterByzone:q(()=>A(()=>import("./FilterByzone.e7fd6784.js"),["assets/FilterByzone.e7fd6784.js","assets/index.57d98e6b.js","assets/index.945c03c3.css","assets/QToolbarTitle.f2460359.js","assets/QSpace.6257f203.js","assets/QToolbar.5785cd51.js","assets/QItemLabel.534f2eb0.js","assets/QList.9b1deb90.js","assets/QFooter.9a53d96e.js","assets/QResizeObserver.1c6d7ccc.js"])),ConfirmDialog:q(()=>A(()=>import("./ConfirmDialog.bcf33884.js"),["assets/ConfirmDialog.bcf33884.js","assets/QToolbarTitle.f2460359.js","assets/index.57d98e6b.js","assets/index.945c03c3.css","assets/QToolbar.5785cd51.js"]))},setup(){const e=V(),r=M();return{Activity:e,Schedule:r}},data(){return{data:[],loading:!1,loading_myshift:!1,page:0,today_date:"",total:0,month_label:"",zone_ids:[],shift_modal:!1,shift_data:[],current_shift_data:[],total_shift:0,data_dialog:{title:this.$t("Delete Confirmation"),subtitle:this.$t("Are you sure you want to permanently delete the selected item?"),cancel:this.$t("Cancel"),confirm:this.$t("Delete")},schedule_id:"",is_home:!1,is_refresh:void 0}},created(){this.$route.fullPath=="/home/find_schedule"?(this.is_home=!0,this.Activity.setTitle(this.$t("Shifts"))):this.is_home=!1,this.today_date=l.getDateNow(this.Activity.timezone),this.currentShift()},computed:{hasData(){return Object.keys(this.data).length>0},hasShift(){return Object.keys(this.current_shift_data).length>0}},methods:{currentShift(){this.loading_myshift=!0,l.fetchDataByTokenPost("currentShift","date="+this.today_date).then(e=>{this.current_shift_data=e.details.data,this.total_shift=e.details.total_shift}).catch(e=>{this.current_shift_data=[]}).then(e=>{this.loading_myshift=!1})},showFilter(){this.$refs.filter_zone.showModal(!0)},afterApplyfilter(e){console.log("afterApply"),console.log(e),this.zone_ids=e,this.resetPagination()},afterSelectdate(e){console.log("afterSelectdate=>"+e),this.setAvailableShift(e)},setAvailableShift(e){this.today_date=e,this.refresh()},getAvailableShift(e,r){this.loading=!0,l.fetchDataByTokenPost2("getAvailableShift",{page:e,date:this.today_date,zone_ids:this.zone_ids}).then(u=>{this.page=e,this.total=u.details.count,this.month_label=u.details.month_label,this.data.push(u.details.data),this.is_home&&this.Activity.setTitle(this.$t("Shifts - ")+this.month_label)}).catch(u=>{console.log(u),Object.keys(u).length>0&&this.is_home&&this.Activity.setTitle(this.$t("Shifts - ")+this.month_label),l.empty(this.$refs.nscroll)||this.$refs.nscroll.stop()}).then(u=>{r&&r(),l.empty(this.is_refresh)||this.is_refresh(),this.loading=!1})},resetPagination(){this.page=0,this.data=[],this.total=0,this.$refs.nscroll.reset(),this.$refs.nscroll.resume(),this.$refs.nscroll.trigger()},refresh(e){this.resetPagination(),this.is_refresh=e,this.currentShift()},shiftDetails(e){this.shift_data=e,this.shift_modal=!0},takeShift(){this.shift_modal=!1,l.showLoadingBox("",this.$q),l.fetchDataByTokenPost("takeShift","shift_uuid="+this.shift_data.shift_uuid).then(e=>{l.notify("green-5",e.msg,"check_circle",this.$q),this.currentShift(),this.resetPagination(),this.Schedule.data=[]}).catch(e=>{l.notify("red-5",e,"error_outline",this.$q)}).then(e=>{l.hideLoadingBox(this.$q)})},deleteShift(e){this.schedule_id=e,this.$refs.confirm_dialog.dialog=!0},afterConfirm(){this.$refs.confirm_dialog.dialog=!1,l.showLoadingBox("",this.$q),l.fetchDataByTokenPost("deleteSchedule","schedule_id="+this.schedule_id).then(e=>{l.notify("green-5",e.msg,"check_circle",this.$q),this.currentShift(),this.resetPagination(),this.Schedule.data=[]}).catch(e=>{l.notify("red-5",e,"error_outline",this.$q)}).then(e=>{l.hideLoadingBox(this.$q)})},endShift(e){l.showLoadingBox("",this.$q),l.endShift({schedule_uuid:e}).then(r=>{this.currentShift(),this.resetPagination(),this.Schedule.data=[]}).catch(r=>{l.notify("red-5",r,"error_outline",this.$q)}).then(r=>{l.hideLoadingBox(this.$q)})}}},X={class:"q-pl-sm q-pr-sm q-pt-xs"},Z={key:0,class:"flex flex-center full-width"},G={class:"text-weight-medium font15"},J={key:0,class:"text-green"},K={key:1,class:"text-blue"},W={class:"text-weight-medium font15"},Y={key:2,class:"text-center flex flex-center",style:{"min-height":"calc(50vh)"}},ee={class:"fit"},te={class:"font16 text-weight-bold"},ae={class:"font11"},se={key:0,class:"flex flex-center full-width q-pa-xl",style:{"min-height":"calc(30vh)"}},ie={key:1,class:"text-center q-mt-md"};function le(e,r,u,oe,i,d){const z=w("CalendarHalf"),B=w("FilterByzone"),T=w("ConfirmDialog");return o(),h(y,null,[i.is_home?S("",!0):(o(),p(N,{key:0,class:b({"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode})},{default:a(()=>[t(D,null,{default:a(()=>[t(_,{onClick:r[0]||(r[0]=n=>e.$router.back()),flat:"",round:"",dense:"",icon:"las la-angle-left",color:e.$q.dark.mode?"white":"dark"},null,8,["color"]),t(x,{class:"text-weight-bold"},{default:a(()=>[f(s(e.$t("Shifts"))+" - "+s(i.month_label),1)]),_:1}),t(_,{flat:"",round:"",dense:"",icon:"las la-filter",color:"text-dark",onClick:d.showFilter},null,8,["onClick"])]),_:1}),t(E)]),_:1},8,["class"])),t(H,{onRefresh:d.refresh},{default:a(()=>[t(j,{class:b({"bg-mydark text-white":e.$q.dark.mode,"bg-white text-dark":!e.$q.dark.mode})},{default:a(()=>[t(R,{ref:"nscroll",onLoad:d.getAvailableShift,offset:250},{default:a(()=>[m("div",X,[t(z,{ref:"calendar",onAfterSelectdate:d.afterSelectdate,today_date:i.today_date},null,8,["onAfterSelectdate","today_date"])]),i.loading_myshift?(o(),h("div",Z,[t(C,{color:"primary",size:"2em"})])):S("",!0),d.hasShift&&!i.loading_myshift?(o(),h(y,{key:1},[m("div",{class:b(["q-pa-sm q-pl-md q-pr-md",{"bg-mydark text-white":e.$q.dark.mode,"bg-grey-1 text-black":!e.$q.dark.mode}])},[m("div",G,s(e.$t("Current shift"))+" ("+s(i.total_shift)+") ",1)],2),t(Q,{separator:""},{default:a(()=>[(o(!0),h(y,null,$(i.current_shift_data,n=>(o(),p(k,{key:n},{default:a(()=>[t(c,null,{default:a(()=>[t(v,null,{default:a(()=>[f(s(n.zone_name),1)]),_:2},1024),t(v,{caption:"",lines:"2"},{default:a(()=>[f(s(n.time_start)+" - "+s(n.time_end),1)]),_:2},1024)]),_:2},1024),t(c,{side:""},{default:a(()=>[n.shift_status=="on_going"?(o(),h("div",J,s(e.$t("Ongoing")),1)):n.shift_status=="ended"?(o(),h("div",K,s(e.$t("shift ended ")),1)):(o(),p(_,{key:2,onClick:g=>d.deleteShift(n.schedule_id),label:e.$t("Delete"),unelevated:"",color:"red",class:"text-weight-bold","no-caps":"",style:{"min-width":"95px"}},null,8,["onClick","label"])),n.can_end_shift?(o(),p(_,{key:3,onClick:g=>d.endShift(n.schedule_id),label:e.$t("End shift"),unelevated:"",color:"red",class:"text-weight-bold","no-caps":"",style:{"min-width":"95px"}},null,8,["onClick","label"])):S("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1})],64)):S("",!0),m("div",{class:b(["q-pa-sm q-pl-md q-pr-md",{"bg-mydark text-white":e.$q.dark.mode,"bg-grey-1 text-black":!e.$q.dark.mode}])},[m("div",W,s(e.$t("Available shift"))+" ("+s(i.total)+") ",1)],2),!d.hasData&&!i.loading?(o(),h("div",Y,[m("div",ee,[m("div",te,s(e.$t("No available shift")),1),m("p",ae,s(e.$t("Pull down the page to refresh")),1)])])):(o(),p(Q,{key:3,separator:""},{default:a(()=>[(o(!0),h(y,null,$(i.data,n=>(o(),h(y,{key:n},[(o(!0),h(y,null,$(n,g=>(o(),p(k,{key:g},{default:a(()=>[t(c,null,{default:a(()=>[t(v,null,{default:a(()=>[f(s(g.zone_name),1)]),_:2},1024),t(v,{caption:"",lines:"2"},{default:a(()=>[f(s(g.time_start)+" - "+s(g.time_end),1)]),_:2},1024)]),_:2},1024),t(c,{side:""},{default:a(()=>[t(_,{onClick:re=>d.shiftDetails(g),label:e.$t("Take Shift"),unelevated:"",color:"primary",class:"text-weight-bold","no-caps":""},null,8,["onClick","label"])]),_:2},1024)]),_:2},1024))),128))],64))),128))]),_:1}))]),loading:a(()=>[i.page<=0?(o(),h("div",se,[t(C,{color:"primary",size:"2em"})])):(o(),h("div",ie,[t(C,{color:"primary",size:"2em"})]))]),_:1},8,["onLoad"])]),_:1},8,["class"])]),_:1},8,["onRefresh"]),t(B,{ref:"filter_zone",onAfterApplyfilter:d.afterApplyfilter},null,8,["onAfterApplyfilter"]),t(T,{ref:"confirm_dialog",data:i.data_dialog,onAfterConfirm:d.afterConfirm},null,8,["data","onAfterConfirm"]),t(F,{modelValue:i.shift_modal,"onUpdate:modelValue":r[3]||(r[3]=n=>i.shift_modal=n),persistent:"","transition-show":"fade","transition-hide":"fade"},{default:a(()=>[t(I,{style:{width:"700px","max-width":"80vw"}},{default:a(()=>[t(D,{class:"text-primary top-toolbar q-pl-md",dense:""},{default:a(()=>[t(x,{class:"text-dark text-weight-bold"},{default:a(()=>[f(s(e.$t("Take shift")),1)]),_:1}),t(P),t(_,{onClick:r[1]||(r[1]=n=>i.shift_modal=!1),color:"white",square:"",unelevated:"","text-color":"grey",icon:"las la-times",dense:"","no-caps":"",size:"sm",class:"border-grey radius8"})]),_:1}),t(Q,{dense:""},{default:a(()=>[t(k,null,{default:a(()=>[t(c,null,{default:a(()=>[f(s(e.$t("Date"))+" :",1)]),_:1}),t(c,{side:""},{default:a(()=>[f(s(i.shift_data.date_shift),1)]),_:1})]),_:1}),t(k,null,{default:a(()=>[t(c,null,{default:a(()=>[f(s(e.$t("Area"))+" :",1)]),_:1}),t(c,{side:""},{default:a(()=>[f(s(i.shift_data.zone_name),1)]),_:1})]),_:1}),t(k,null,{default:a(()=>[t(c,null,{default:a(()=>[f(s(e.$t("Time"))+" :",1)]),_:1}),t(c,{side:""},{default:a(()=>[f(s(i.shift_data.time_start)+" - "+s(i.shift_data.time_end),1)]),_:1})]),_:1})]),_:1}),t(P,{class:"q-pa-sm"}),t(O,{class:"row items-center q-pt-sm q-pb-sm"},{default:a(()=>[t(_,{label:e.$t("Cancel"),outline:"",color:e.$q.dark.mode?"grey600":"grey","text-color":e.$q.dark.mode?"grey300":"dark","no-caps":"",class:"radius8 col",onClick:r[2]||(r[2]=n=>i.shift_modal=!1)},null,8,["label","color","text-color"]),t(_,{label:e.$t("Create"),color:"primary","text-color":"white","no-caps":"",class:"radius8 col",unelevated:"",onClick:d.takeShift},null,8,["label","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}var qe=L(U,[["render",le]]);export{qe as default};
